---
ID: "10fc34f1-3206-4bc0-8ce4-716f616e0449"
Parent: "4efe74c8-53fb-4a08-a60b-d093b5333239"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: /sitecore/media library/Feature/Experience Accelerator/Composites/OnPageEditing/Scripts/onPageEditing
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/10FC34F132064BC08CE4716F616E0449.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "10fc34f1-3206-4bc0-8ce4-716f616e0449"
  Value: dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAoewogICAgICAgICAgICAgICAgX19wcm90b19fOiBbXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICAgICAgICAgIGQuX19wcm90b19fID0gYjsKICAgICAgICAgICAgfSkgfHwKICAgICAgICBmdW5jdGlvbiAoZCwgYikgewogICAgICAgICAgICBmb3IgKHZhciBwIGluIGIpCiAgICAgICAgICAgICAgICBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07CiAgICAgICAgfTsKICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgogICAgICAgIGZ1bmN0aW9uIF9fKCkgewogICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gZDsKICAgICAgICB9CiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwogICAgfTsKfSkoKTsKdmFyIFNYQTsKKGZ1bmN0aW9uIChTWEEpIHsKICAgIHZhciBDb21tb247CiAgICAoZnVuY3Rpb24gKENvbW1vbikgewogICAgICAgIHZhciBQcm94eU9yZGVyOwogICAgICAgIChmdW5jdGlvbiAoUHJveHlPcmRlcikgewogICAgICAgICAgICBQcm94eU9yZGVyW1Byb3h5T3JkZXJbIkJlZm9yZSJdID0gMF0gPSAiQmVmb3JlIjsKICAgICAgICAgICAgUHJveHlPcmRlcltQcm94eU9yZGVyWyJBZnRlciJdID0gMV0gPSAiQWZ0ZXIiOwogICAgICAgIH0pKFByb3h5T3JkZXIgPSBDb21tb24uUHJveHlPcmRlciB8fCAoQ29tbW9uLlByb3h5T3JkZXIgPSB7fSkpOwogICAgICAgIHZhciBIdG1sSGVscGVycyA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEh0bWxIZWxwZXJzKCkge30KICAgICAgICAgICAgSHRtbEhlbHBlcnMuYWRkUHJveHkgPSBmdW5jdGlvbiAob3BlcmFuZCwgZnVuY3Rpb25OYW1lLCBwcm94eUZuLCBvcmRlcikgewogICAgICAgICAgICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgICBvcmRlciA9IFByb3h5T3JkZXIuQmVmb3JlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcGVyYW5kID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3JkZXIgPT09IFByb3h5T3JkZXIuQmVmb3JlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZFByb3h5QmVmb3JlVG9GdW5jdGlvbihvcGVyYW5kLCBmdW5jdGlvbk5hbWUsIHByb3h5Rm4pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZFByb3h5QWZ0ZXJUb0Z1bmN0aW9uKG9wZXJhbmQsIGZ1bmN0aW9uTmFtZSwgcHJveHlGbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3JkZXIgPT09IFByb3h5T3JkZXIuQmVmb3JlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZFByb3h5QmVmb3JlVG9PYmplY3Qob3BlcmFuZCwgZnVuY3Rpb25OYW1lLCBwcm94eUZuKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGRQcm94eUFmdGVyVG9PYmplY3Qob3BlcmFuZCwgZnVuY3Rpb25OYW1lLCBwcm94eUZuKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIEh0bWxIZWxwZXJzLnBhcnNlUXVlcnkgPSBmdW5jdGlvbiAocXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IHt9OwogICAgICAgICAgICAgICAgdmFyIGEgPSAocXVlcnlTdHJpbmdbMF0gPT09ICI/IiA/IHF1ZXJ5U3RyaW5nLnN1YnN0cigxKSA6IHF1ZXJ5U3RyaW5nKS5zcGxpdCgiJiIpOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhW2ldLnNwbGl0KCI9Iik7CiAgICAgICAgICAgICAgICAgICAgcXVlcnlbZGVjb2RlVVJJQ29tcG9uZW50KGJbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudChiWzFdIHx8ICIiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgSHRtbEhlbHBlcnMudG9RdWVyeSA9IGZ1bmN0aW9uIChxdWVyeVN0cmluZ09iamVjdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHF1ZXJ5U3RyaW5nT2JqZWN0KS5tYXAoZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZXkgKyAnPScgKyBxdWVyeVN0cmluZ09iamVjdFtrZXldOwogICAgICAgICAgICAgICAgfSkuam9pbignJicpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBIdG1sSGVscGVycy5hZGRQcm94eUJlZm9yZVRvRnVuY3Rpb24gPSBmdW5jdGlvbiAoZm4sIGZ1bmN0aW9uTmFtZSwgcHJveHlGbikgewogICAgICAgICAgICAgICAgdmFyIHByb3hpZWQgPSBmbi5wcm90b3R5cGVbZnVuY3Rpb25OYW1lXTsKICAgICAgICAgICAgICAgIGZuLnByb3RvdHlwZVtmdW5jdGlvbk5hbWVdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5Rm4oYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICBIdG1sSGVscGVycy5sb2dFcnJvcihlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBwcm94aWVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIEh0bWxIZWxwZXJzLmFkZFByb3h5QmVmb3JlVG9PYmplY3QgPSBmdW5jdGlvbiAob2JqLCBmdW5jdGlvbk5hbWUsIHByb3h5Rm4pIHsKICAgICAgICAgICAgICAgIHZhciBwcm94aWVkID0gb2JqW2Z1bmN0aW9uTmFtZV07CiAgICAgICAgICAgICAgICBvYmpbZnVuY3Rpb25OYW1lXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBwcm94eUZuKGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgSHRtbEhlbHBlcnMubG9nRXJyb3IoZXJyb3IpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcHJveGllZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9OwogICAgICAgICAgICBIdG1sSGVscGVycy5hZGRQcm94eUFmdGVyVG9GdW5jdGlvbiA9IGZ1bmN0aW9uIChmbiwgZnVuY3Rpb25OYW1lLCBwcm94eUZuKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJveGllZCA9IGZuLnByb3RvdHlwZVtmdW5jdGlvbk5hbWVdOwogICAgICAgICAgICAgICAgZm4ucHJvdG90eXBlW2Z1bmN0aW9uTmFtZV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHByb3hpZWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBwcm94eUZuKGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dFcnJvcihlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9OwogICAgICAgICAgICBIdG1sSGVscGVycy5hZGRQcm94eUFmdGVyVG9PYmplY3QgPSBmdW5jdGlvbiAob2JqLCBmdW5jdGlvbk5hbWUsIHByb3h5Rm4pIHsKICAgICAgICAgICAgICAgIHZhciBwcm94aWVkID0gb2JqW2Z1bmN0aW9uTmFtZV07CiAgICAgICAgICAgICAgICBvYmpbZnVuY3Rpb25OYW1lXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcHJveGllZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5Rm4oYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ0Vycm9yKGVycm9yKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIEh0bWxIZWxwZXJzLmxvZ0Vycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiW1NYQV0gQW4gZXJyb3Igb2NjdXJyZWQgaW4gdGhlIHByb3h5IGZ1bmN0aW9uLiIpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gSHRtbEhlbHBlcnM7CiAgICAgICAgfSgpKTsKICAgICAgICBDb21tb24uSHRtbEhlbHBlcnMgPSBIdG1sSGVscGVyczsKICAgIH0pKENvbW1vbiA9IFNYQS5Db21tb24gfHwgKFNYQS5Db21tb24gPSB7fSkpOwp9KShTWEEgfHwgKFNYQSA9IHt9KSk7CihmdW5jdGlvbiAoU1hBKSB7CiAgICB2YXIgRmVhdHVyZTsKICAgIChmdW5jdGlvbiAoRmVhdHVyZSkgewogICAgICAgIHZhciBDb21wb3NpdGVzOwogICAgICAgIChmdW5jdGlvbiAoQ29tcG9zaXRlcykgewogICAgICAgICAgICB2YXIgUmVuZGVyaW5nID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFJlbmRlcmluZyhyYXdSZW5kZXJpbmcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJhd1JlbmRlcmluZyA9IHJhd1JlbmRlcmluZzsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gcmF3UmVuZGVyaW5nWyJAcGgiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVuaXF1ZUlkID0gcmF3UmVuZGVyaW5nWyJAdWlkIl07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gU1hBLkNvbW1vbi5IdG1sSGVscGVycy5wYXJzZVF1ZXJ5KHJhd1JlbmRlcmluZ1siQHBhciJdKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmR5bmFtaWNQbGFjZWhvbGRlcklkID0gdGhpcy5wYXJhbWV0ZXJzWyJEeW5hbWljUGxhY2Vob2xkZXJJZCJdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgUmVuZGVyaW5nLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRyb2xJZCA9IHRoaXMudW5pcXVlSWQucmVwbGFjZSgvWy17fV0vZywgIiIpOwogICAgICAgICAgICAgICAgICAgIFNpdGVjb3JlLkxheW91dERlZmluaXRpb24ucmVtb3ZlKGNvbnRyb2xJZCk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgUmVuZGVyaW5nLnByb3RvdHlwZS5tYXJrQXNNb2RpZmllZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbW9kaWZpZWRGbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxheW91dERlZmluaXRpb24gPSBTaXRlY29yZS5MYXlvdXREZWZpbml0aW9uLmdldExheW91dERlZmluaXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudERldmljZSA9IFNpdGVjb3JlLkxheW91dERlZmluaXRpb24uZ2V0RGV2aWNlKGxheW91dERlZmluaXRpb24pOwogICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudERldmljZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIGFsbERldmljZXMgPSBsYXlvdXREZWZpbml0aW9uLnIuZDsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBtID0gMDsgbSA8IGFsbERldmljZXMubGVuZ3RoOyBtKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbERldmljZXNbbV1bIkBpZCJdID09IGN1cnJlbnREZXZpY2VbIkBpZCJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IGFsbERldmljZXNbbV0uci5sZW5ndGg7IG4rKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGxEZXZpY2VzW21dLnJbbl1bIkB1aWQiXSA9PSB0aGlzLnVuaXF1ZUlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJpbmdQYXJhbWV0ZXJzID0gYWxsRGV2aWNlc1ttXS5yW25dWyJAcGFyIl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJzT2JqZWN0ID0gU1hBLkNvbW1vbi5IdG1sSGVscGVycy5wYXJzZVF1ZXJ5KHJlbmRlcmluZ1BhcmFtZXRlcnMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzT2JqZWN0WyJvblBhZ2VFZGl0aW5nT2ZDb21wb3NpdGVzU3RhdGUiXSA9IHRoaXMudW5pcXVlSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbERldmljZXNbbV0ucltuXVsiQHBhciJdID0gU1hBLkNvbW1vbi5IdG1sSGVscGVycy50b1F1ZXJ5KHBhcmFtZXRlcnNPYmplY3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEZsYWcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGlmaWVkRmxhZykgewogICAgICAgICAgICAgICAgICAgICAgICBTaXRlY29yZS5MYXlvdXREZWZpbml0aW9uLnNldExheW91dERlZmluaXRpb24obGF5b3V0RGVmaW5pdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBSZW5kZXJpbmc7CiAgICAgICAgICAgIH0oKSk7CiAgICAgICAgICAgIENvbXBvc2l0ZXMuUmVuZGVyaW5nID0gUmVuZGVyaW5nOwogICAgICAgICAgICB2YXIgQ29udGV4dCA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBDb250ZXh0KCkge30KICAgICAgICAgICAgICAgIENvbnRleHQub25QYWdlRWRpdGluZ0VuYWJsZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFNpdGVjb3JlLlBhZ2VNb2Rlcy5QYWdlRWRpdG9yLm9uUGFnZUVkaXRpbmdPZkNvbXBvc2l0ZXMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNpdGVjb3JlLlBhZ2VNb2Rlcy5QYWdlRWRpdG9yLm9uUGFnZUVkaXRpbmdPZkNvbXBvc2l0ZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIENvbnRleHQ7CiAgICAgICAgICAgIH0oKSk7CiAgICAgICAgICAgIENvbXBvc2l0ZXMuQ29udGV4dCA9IENvbnRleHQ7CiAgICAgICAgICAgIHZhciBPblBhZ2VFZGl0aW5nU2VydmljZSA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBPblBhZ2VFZGl0aW5nU2VydmljZSgpIHt9CiAgICAgICAgICAgICAgICBPblBhZ2VFZGl0aW5nU2VydmljZS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIHZhciBvcmlnaW5hbFJlbmRlcmluZyA9IFNpdGVjb3JlLlBhZ2VNb2Rlcy5DaHJvbWVUeXBlcy5SZW5kZXJpbmcucHJvdG90eXBlOwogICAgICAgICAgICAgICAgICAgIFNYQS5Db21tb24uSHRtbEhlbHBlcnMuYWRkUHJveHkob3JpZ2luYWxSZW5kZXJpbmcsICJkZWxldGVDb250cm9sIiwgZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMub25SZW5kZXJpbmdSZW1vdmUoYXJncyk7CiAgICAgICAgICAgICAgICAgICAgfSwgU1hBLkNvbW1vbi5Qcm94eU9yZGVyLkJlZm9yZSk7CiAgICAgICAgICAgICAgICAgICAgU1hBLkNvbW1vbi5IdG1sSGVscGVycy5hZGRQcm94eShvcmlnaW5hbFJlbmRlcmluZywgImRlbGV0ZUNvbnRyb2wiLCBmdW5jdGlvbiAoYXJncykgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5vblJlbmRlcmluZ1JlbW92ZU1hcmtBc01vZGlmaWVkKGFyZ3MpOwogICAgICAgICAgICAgICAgICAgIH0sIFNYQS5Db21tb24uUHJveHlPcmRlci5CZWZvcmUpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIE9uUGFnZUVkaXRpbmdTZXJ2aWNlLnByb3RvdHlwZS5nZXRSZW1vdmVkUmVuZGVyaW5nID0gZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlbW92ZWRSZW5kZXJpbmdJZCA9IGRhdGEuX29yaWdpbmFsRE9NRWxlbWVudFswXS5pZC5yZXBsYWNlKCJyXyIsICIiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVuZGVyaW5nID0gbmV3IFJlbmRlcmluZyhTaXRlY29yZS5MYXlvdXREZWZpbml0aW9uLmdldFJlbmRlcmluZyhyZW1vdmVkUmVuZGVyaW5nSWQpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyaW5nOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIE9uUGFnZUVkaXRpbmdTZXJ2aWNlLnByb3RvdHlwZS5nZXRBbGxSZW5kZXJpbmdzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciByYXdSZW5kZXJpbmdzID0gU2l0ZWNvcmUuTGF5b3V0RGVmaW5pdGlvbi5nZXRSZW5kZXJpbmdzKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFsbFJlbmRlcmluZ3MgPSAkeGEubWFwKHJhd1JlbmRlcmluZ3MsIGZ1bmN0aW9uIChyYXcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZW5kZXJpbmcocmF3KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWxsUmVuZGVyaW5nczsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBPblBhZ2VFZGl0aW5nU2VydmljZS5wcm90b3R5cGUub25SZW5kZXJpbmdSZW1vdmUgPSBmdW5jdGlvbiAoYXJncykgewogICAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJpbmcgPSB0aGlzLmdldFJlbW92ZWRSZW5kZXJpbmcoYXJncyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFsbFJlbmRlcmluZ3MgPSB0aGlzLmdldEFsbFJlbmRlcmluZ3MoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgcGF0dGVybiA9ICIvIiArIHJlbmRlcmluZy5wbGFjZWhvbGRlciArICIvc2VjdGlvbi0oW3RpdGxlfGNvbnRlbnRdKSstXFxkKy0iICsgcmVuZGVyaW5nLmR5bmFtaWNQbGFjZWhvbGRlcklkOwoJCQkJCXBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoL1wvXC8vZywgJy8nKTsKICAgICAgICAgICAgICAgICAgICB2YXIgY29tcG9zaXRlUmVuZGVyaW5ncyA9ICR4YS5ncmVwKGFsbFJlbmRlcmluZ3MsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByLnBsYWNlaG9sZGVyLm1hdGNoKG5ldyBSZWdFeHAocGF0dGVybiwgImciKSkgIT0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkeGEuZWFjaChjb21wb3NpdGVSZW5kZXJpbmdzLCBmdW5jdGlvbiAoaW5kZXgsIHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgT25QYWdlRWRpdGluZ1NlcnZpY2UucHJvdG90eXBlLm9uUmVuZGVyaW5nUmVtb3ZlTWFya0FzTW9kaWZpZWQgPSBmdW5jdGlvbiAoYXJncykgewogICAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJpbmcgPSB0aGlzLmdldFJlbW92ZWRSZW5kZXJpbmcoYXJncyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFsbFJlbmRlcmluZ3MgPSB0aGlzLmdldEFsbFJlbmRlcmluZ3MoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgcGxhY2Vob2xkZXIgPSBuZXcgQ29tcG9zaXRlcy5QbGFjZWhvbGRlcihyZW5kZXJpbmcucGxhY2Vob2xkZXIpOwogICAgICAgICAgICAgICAgICAgIHZhciBjb21wb3NpdGVTZWN0aW9uUGxhY2Vob2xkZXIgPSBwbGFjZWhvbGRlci5HZXRDb21wb3NpdGVTZWN0aW9uUGxhY2Vob2xkZXIoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY29tcG9zaXRlU2VjdGlvblBsYWNlaG9sZGVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbXBvc2l0ZUR5bmFtaWNQbGFjZWhvbGRlcklEXzEgPSBjb21wb3NpdGVTZWN0aW9uUGxhY2Vob2xkZXIubWF0Y2goL3NlY3Rpb24tKFt0aXRsZXxjb250ZW50XSkrLVxkKy0oLiopLylbMl07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb21wb3NpdGVQbGFjZWhvbGRlck5hbWVfMSA9IHBsYWNlaG9sZGVyLkdldENvbXBvc2l0ZVBsYWNlaG9sZGVyTmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tcG9zaXRlUmVuZGVyaW5ncyA9ICR4YS5ncmVwKGFsbFJlbmRlcmluZ3MsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5wbGFjZWhvbGRlciA9PSBjb21wb3NpdGVQbGFjZWhvbGRlck5hbWVfMSAmJiByLmR5bmFtaWNQbGFjZWhvbGRlcklkID09IGNvbXBvc2l0ZUR5bmFtaWNQbGFjZWhvbGRlcklEXzE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAkeGEuZWFjaChjb21wb3NpdGVSZW5kZXJpbmdzLCBmdW5jdGlvbiAoaW5kZXgsIHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByLm1hcmtBc01vZGlmaWVkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gT25QYWdlRWRpdGluZ1NlcnZpY2U7CiAgICAgICAgICAgIH0oKSk7CiAgICAgICAgICAgIENvbXBvc2l0ZXMuT25QYWdlRWRpdGluZ1NlcnZpY2UgPSBPblBhZ2VFZGl0aW5nU2VydmljZTsKICAgICAgICAgICAgdmFyIENvbXBvc2l0ZXNJbml0SGFuZGxlciA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBDb21wb3NpdGVzSW5pdEhhbmRsZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wb3NpdGVNb2R1bGVzTmFtZXMgPSBuZXcgQXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBvc2l0ZU1vZHVsZXNOYW1lcy5wdXNoKCJjYXJvdXNlbHMiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBvc2l0ZU1vZHVsZXNOYW1lcy5wdXNoKCJ0YWJzIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wb3NpdGVNb2R1bGVzTmFtZXMucHVzaCgiZmxpcCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcG9zaXRlTW9kdWxlc05hbWVzLnB1c2goImFjY29yZGlvbnMiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBvc2l0ZU1vZHVsZXNOYW1lcy5wdXNoKCJzbmlwcGV0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBDb21wb3NpdGVzSW5pdEhhbmRsZXIucHJvdG90eXBlLnByb2Nlc3MgPSBmdW5jdGlvbiAobmFtZSwgbW9kdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9zaXRlTW9kdWxlc05hbWVzLmluZGV4T2YobmFtZSkgPiAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlcmZvcm1BY3Rpb24obmFtZSwgbW9kdWxlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIENvbXBvc2l0ZXNJbml0SGFuZGxlcjsKICAgICAgICAgICAgfSgpKTsKICAgICAgICAgICAgQ29tcG9zaXRlcy5Db21wb3NpdGVzSW5pdEhhbmRsZXIgPSBDb21wb3NpdGVzSW5pdEhhbmRsZXI7CiAgICAgICAgICAgIHZhciBDb21wb3NpdGVzUHJlSW5pdEhhbmRsZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgICAgICAgICAgICAgX19leHRlbmRzKENvbXBvc2l0ZXNQcmVJbml0SGFuZGxlciwgX3N1cGVyKTsKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBDb21wb3NpdGVzUHJlSW5pdEhhbmRsZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQ29tcG9zaXRlc1ByZUluaXRIYW5kbGVyLnByb3RvdHlwZS5wZXJmb3JtQWN0aW9uID0gZnVuY3Rpb24gKG5hbWUsIG1vZHVsZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBkaXNhYmxlZFBsYWNlaG9sZGVycyA9IHdpbmRvdy50b3AuZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnNjRW1wdHlQbGFjZWhvbGRlciIpOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBkaXNhYmxlZFBsYWNlaG9sZGVycy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBoID0gZGlzYWJsZWRQbGFjZWhvbGRlcnNbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICBwaC5jbGFzc0xpc3QucmVtb3ZlKCJzY0VtcHR5UGxhY2Vob2xkZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGguY2xhc3NMaXN0LmFkZCgic2NFbXB0eVBsYWNlaG9sZGVyU3hhIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBDb21wb3NpdGVzUHJlSW5pdEhhbmRsZXI7CiAgICAgICAgICAgIH0oQ29tcG9zaXRlc0luaXRIYW5kbGVyKSk7CiAgICAgICAgICAgIENvbXBvc2l0ZXMuQ29tcG9zaXRlc1ByZUluaXRIYW5kbGVyID0gQ29tcG9zaXRlc1ByZUluaXRIYW5kbGVyOwogICAgICAgICAgICB2YXIgQ29tcG9zaXRlc1Bvc3RJbml0SGFuZGxlciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgICAgICAgICBfX2V4dGVuZHMoQ29tcG9zaXRlc1Bvc3RJbml0SGFuZGxlciwgX3N1cGVyKTsKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBDb21wb3NpdGVzUG9zdEluaXRIYW5kbGVyKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIENvbXBvc2l0ZXNQb3N0SW5pdEhhbmRsZXIucHJvdG90eXBlLnBlcmZvcm1BY3Rpb24gPSBmdW5jdGlvbiAobmFtZSwgbW9kdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRpc2FibGVkUGxhY2Vob2xkZXJzID0gd2luZG93LnRvcC5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuc2NFbXB0eVBsYWNlaG9sZGVyU3hhIik7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGRpc2FibGVkUGxhY2Vob2xkZXJzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGggPSBkaXNhYmxlZFBsYWNlaG9sZGVyc1tpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgIHBoLmNsYXNzTGlzdC5yZW1vdmUoInNjRW1wdHlQbGFjZWhvbGRlclN4YSIpOwogICAgICAgICAgICAgICAgICAgICAgICBwaC5jbGFzc0xpc3QuYWRkKCJzY0VtcHR5UGxhY2Vob2xkZXIiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIENvbXBvc2l0ZXNQb3N0SW5pdEhhbmRsZXI7CiAgICAgICAgICAgIH0oQ29tcG9zaXRlc0luaXRIYW5kbGVyKSk7CiAgICAgICAgICAgIENvbXBvc2l0ZXMuQ29tcG9zaXRlc1Bvc3RJbml0SGFuZGxlciA9IENvbXBvc2l0ZXNQb3N0SW5pdEhhbmRsZXI7CiAgICAgICAgfSkoQ29tcG9zaXRlcyA9IEZlYXR1cmUuQ29tcG9zaXRlcyB8fCAoRmVhdHVyZS5Db21wb3NpdGVzID0ge30pKTsKICAgIH0pKEZlYXR1cmUgPSBTWEEuRmVhdHVyZSB8fCAoU1hBLkZlYXR1cmUgPSB7fSkpOwp9KShTWEEgfHwgKFNYQSA9IHt9KSk7CihmdW5jdGlvbiAoU1hBKSB7CiAgICB2YXIgRmVhdHVyZTsKICAgIChmdW5jdGlvbiAoRmVhdHVyZSkgewogICAgICAgIHZhciBDb21wb3NpdGVzOwogICAgICAgIChmdW5jdGlvbiAoQ29tcG9zaXRlcykgewogICAgICAgICAgICBpZiAoQ29tcG9zaXRlcy5Db250ZXh0Lm9uUGFnZUVkaXRpbmdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlID0gbmV3IFNYQS5GZWF0dXJlLkNvbXBvc2l0ZXMuT25QYWdlRWRpdGluZ1NlcnZpY2UoKTsKICAgICAgICAgICAgICAgIHNlcnZpY2UuaW5pdCgpOwogICAgICAgICAgICAgICAgdmFyIHByZUhhbmRsZXIgPSBuZXcgU1hBLkZlYXR1cmUuQ29tcG9zaXRlcy5Db21wb3NpdGVzUHJlSW5pdEhhbmRsZXIoKTsKICAgICAgICAgICAgICAgIHZhciBwb3N0SGFuZGxlciA9IG5ldyBTWEEuRmVhdHVyZS5Db21wb3NpdGVzLkNvbXBvc2l0ZXNQb3N0SW5pdEhhbmRsZXIoKTsKICAgICAgICAgICAgICAgIFhBLnJlZ2lzdGVyT25QcmVJbml0SGFuZGxlcihwcmVIYW5kbGVyKTsKICAgICAgICAgICAgICAgIFhBLnJlZ2lzdGVyT25Qb3N0SW5pdEhhbmRsZXIocG9zdEhhbmRsZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfSkoQ29tcG9zaXRlcyA9IEZlYXR1cmUuQ29tcG9zaXRlcyB8fCAoRmVhdHVyZS5Db21wb3NpdGVzID0ge30pKTsKICAgIH0pKEZlYXR1cmUgPSBTWEEuRmVhdHVyZSB8fCAoU1hBLkZlYXR1cmUgPSB7fSkpOwp9KShTWEEgfHwgKFNYQSA9IHt9KSk7Cg==
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 15457
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "ba3f86a2-4a1c-4d78-b63d-91c2779c1b5e"
  Hint: __Sortorder
  Value: 0
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160509T120144Z
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "5fc79902-e094-4841-8cab-d3df83084d8e"
