---
ID: "fd070a38-bf0a-4edc-b9a9-198bd1478372"
Parent: "f44f1073-c761-48d0-a23a-27eee2ad9717"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Base Themes/Bing Maps JS Connector/Scripts/bing-maps-connector"
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/FD070A38BF0A4EDCB9A9198BD1478372.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "fd070a38-bf0a-4edc-b9a9-198bd1478372"
  Value: WEEuY29ubmVjdG9yLm1hcHNDb25uZWN0b3IgPSAoZnVuY3Rpb24gKCQsIGRvY3VtZW50KSB7DQogICAgdmFyIGFwaSA9IHt9LA0KICAgICAgICBtYXBzID0gW10sDQogICAgICAgIGNhbGxiYWNrcyA9IFtdLA0KICAgICAgICBwaW5zID0gW10sDQogICAgICAgIGluZm9ib3hlcyA9IFtdLA0KICAgICAgICBsb2FkaW5nID0gZmFsc2UsDQogICAgICAgIGNyZWF0ZUZha2VNYXAsDQogICAgICAgIG1hcCwNCiAgICAgICAgZ2V0TWFwVHlwZSwNCiAgICAgICAgcmVuZGVySW5mb0JveCwNCiAgICAgICAgZ2V0Rmlyc3RNYXAsDQogICAgICAgIGNyZWF0ZVBpbiwNCiAgICAgICAgYWRkUGluLA0KICAgICAgICBhZGRJbmZvYm94LA0KICAgICAgICBsb29rdXA7DQoNCiAgICBnZXRNYXBUeXBlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsNCiAgICAgICAgc3dpdGNoIChvcHRpb25zLm1vZGUpIHsNCiAgICAgICAgICAgIGNhc2UgJ0F1dG8nOg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1pY3Jvc29mdC5NYXBzLk1hcFR5cGVJZC5hdXRvOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgJ1JvYWRtYXAnOg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1pY3Jvc29mdC5NYXBzLk1hcFR5cGVJZC5yb2FkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgJ0JpcmRzZXllJzoNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBNaWNyb3NvZnQuTWFwcy5NYXBUeXBlSWQuYmlyZHNleWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAnU2F0ZWxsaXRlJzoNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBNaWNyb3NvZnQuTWFwcy5NYXBUeXBlSWQuYWVyaWFsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWljcm9zb2Z0Lk1hcHMuTWFwVHlwZUlkLmF1dG87DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIGFkZFBpbiA9IGZ1bmN0aW9uKG1hcElkLCBwaW4sIGRhdGEpIHsNCiAgICAgICAgLy9zYXZlIFBPSSBpZCAtIHRoaXMgd2lsbCBiZSB1c2VkIHdoaWxlIHJlbW92aW5nIGR5bmFtaWMgUE9JcyBmcm9tIHRoZSBtYXANCiAgICAgICAgcGluLmlkID0gZGF0YS5pZDsNCiAgICAgICAgaWYgKHBpbnNbbWFwSWRdKSB7DQogICAgICAgICAgICBwaW5zW21hcElkXS5wdXNoKHsgcGluOiBwaW4sIHR5cGU6IGRhdGEudHlwZX0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcGluc1ttYXBJZF0gPSBbeyBwaW46IHBpbiwgdHlwZTogZGF0YS50eXBlfV07DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgY3JlYXRlRmFrZU1hcCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgbWFwT3B0aW9ucyA9IHsNCiAgICAgICAgICAgIHpvb206IDEwLA0KICAgICAgICAgICAgY2VudGVyOiBuZXcgTWljcm9zb2Z0Lk1hcHMuTG9jYXRpb24oIjUyLjQxNjIxMyIsICIxNi45ODQ0MjMiKSwNCiAgICAgICAgICAgIG1hcFR5cGVJZDogTWljcm9zb2Z0Lk1hcHMuTWFwVHlwZUlkLmF1dG8NCiAgICAgICAgfTsNCiAgICAgICAgcmV0dXJuIG5ldyBNaWNyb3NvZnQuTWFwcy5NYXAoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIG1hcE9wdGlvbnMpOw0KICAgIH07DQoNCiAgICBnZXRGaXJzdE1hcCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgZm9yKHZhciBtYXAgaW4gbWFwcykgew0KICAgICAgICAgICAgaWYgKG1hcHMuaGFzT3duUHJvcGVydHkobWFwKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBtYXBzW21hcF07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfTsNCg0KICAgIGluaXRNYXAgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBpLCBsZW5ndGggPSBjYWxsYmFja3MubGVuZ3RoOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGNhbGxiYWNrc1tpXS5jYWxsKCk7DQogICAgICAgIH0NCiAgICAgICAgbG9hZGluZyA9IGZhbHNlOw0KICAgIH07DQoNCiAgICBjcmVhdGVQaW4gPSBmdW5jdGlvbiAoZGF0YSwgbWFwSWQpIHsNCiAgICAgICAgdmFyIHBpbk9wdGlvbnM9IHsNCiAgICAgICAgICAgICAgICB0aXRsZTogZGF0YS50aXRsZSwNCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZGF0YS5kZXNjcmlwdGlvbiwNCiAgICAgICAgICAgICAgICBpY29uOiBkYXRhLmljb24NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBtYXAgPSBtYXBzW21hcElkXTsNCiAgICAgICAgdmFyIHBpbiA9IG5ldyBNaWNyb3NvZnQuTWFwcy5QdXNocGluKG1hcC5nZXRDZW50ZXIoKSwgcGluT3B0aW9ucyk7DQogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHZhciBwaW5JbWFnZSA9IG5ldyBJbWFnZSgpOw0KICAgICAgICAgICAgcGluSW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICBwaW4uc2V0T3B0aW9ucyh7DQogICAgICAgICAgICAgICAgICAgIHdpZHRoIDogcGluSW1hZ2Uud2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCA6IHBpbkltYWdlLmhlaWdodA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHBpbkltYWdlLnNyYyA9IHBpbk9wdGlvbnMuaWNvbjsNCiAgICAgICAgfSwwKTsNCiAgICAgICAgcmV0dXJuIHBpbjsNCiAgICB9Ow0KDQogICAgcmVuZGVySW5mb0JveCA9IGZ1bmN0aW9uIChlKSB7DQogICAgICAgIGlmIChlLnRhcmdldFR5cGUgPT0gJ3B1c2hwaW4nKSB7DQogICAgICAgICAgICB2YXIgbWFwSWQgPSBlLnRhcmdldC5kYXRhLm1hcElkLA0KICAgICAgICAgICAgICAgIG1hcCA9IG1hcHNbbWFwSWRdLA0KICAgICAgICAgICAgICAgIGluZm9ib3g7DQoNCiAgICAgICAgICAgIGlmIChpbmZvYm94ZXMuaGFzT3duUHJvcGVydHkobWFwSWQpKSB7DQogICAgICAgICAgICAgICAgbWFwLmVudGl0aWVzLnJlbW92ZShpbmZvYm94ZXNbbWFwSWRdKTsNCiAgICAgICAgICAgICAgICBkZWxldGUgaW5mb2JveGVzW21hcElkXTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaW5mb2JveCA9IG5ldyBNaWNyb3NvZnQuTWFwcy5JbmZvYm94KGUudGFyZ2V0LmdldExvY2F0aW9uKCksIG51bGwpOw0KICAgICAgICAgICAgbWFwLmVudGl0aWVzLnB1c2goaW5mb2JveCk7DQogICAgICAgICAgICBpbmZvYm94LnNldE9wdGlvbnMoeyB2aXNpYmxlOiB0cnVlLCBkZXNjcmlwdGlvbjogZS50YXJnZXQuZGF0YS5odG1sIH0pOw0KICAgICAgICAgICAgaW5mb2JveGVzW21hcElkXSA9IGluZm9ib3g7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgbG9va3VwID0gZnVuY3Rpb24ocXVlcnlQYXJhbXMsIHN1Y2Nlc3NDYWxsYmFjaywgZmFpbENhbGxiYWNrKXsNCiAgICAgICAgdmFyIG1hcCA9IGdldEZpcnN0TWFwKCksDQogICAgICAgICAgICBzZWFyY2gsDQogICAgICAgICAgICBxdWVyeSwNCiAgICAgICAgICAgIHNlYXJjaExvYWRlZENhbGxiYWNrOw0KDQogICAgICAgIGlmIChtYXAgPT0gbnVsbCkgew0KICAgICAgICAgICAgbWFwID0gY3JlYXRlRmFrZU1hcCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VhcmNoTG9hZGVkQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBpZiAobWFwID09PSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBtYXAuYWRkQ29tcG9uZW50KCJzZWFyY2hNYW5hZ2VyIiwgbmV3IE1pY3Jvc29mdC5NYXBzLlNlYXJjaC5TZWFyY2hNYW5hZ2VyKG1hcCkpOw0KICAgICAgICAgICAgc2VhcmNoID0gbWFwLmdldENvbXBvbmVudCgnc2VhcmNoTWFuYWdlcicpOw0KDQogICAgICAgICAgICBxdWVyeSA9IHsNCiAgICAgICAgICAgICAgICB3aGVyZTogcXVlcnlQYXJhbXMudGV4dCwNCiAgICAgICAgICAgICAgICBjb3VudDogcXVlcnlQYXJhbXMubWF4UmVzdWx0cyB8fCAxLA0KICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihhcmdzKXsNCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKGFyZ3MucmVzdWx0c1swXSkgIT09ICJ1bmRlZmluZWQiKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhhcmdzLnJlc3VsdHMpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgZmFpbENhbGxiYWNrKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZXJyb3JDYWxsYmFjazogZmFpbENhbGxiYWNrDQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBzZWFyY2guZ2VvY29kZShxdWVyeSk7DQogICAgICAgIH07DQoNCiAgICAgICAgTWljcm9zb2Z0Lk1hcHMubG9hZE1vZHVsZSgnTWljcm9zb2Z0Lk1hcHMuU2VhcmNoJywgeyBjYWxsYmFjazogc2VhcmNoTG9hZGVkQ2FsbGJhY2sgfSk7DQogICAgfTsNCg0KICAgIGFwaS5sb2FkU2NyaXB0ID0gZnVuY3Rpb24gKGtleSwgY2FsbGJhY2spIHsNCiAgICAgICAgLy9zYXZlIGVhY2ggY2FsbGJhY2sgYW5kIGNhbGwgdGhlbSBhbGwgd2hlbiBzY3JpcHQgd2lsbCBiZSBsb2FkZWQgLSBwcm90ZWN0aW9uIGZvciBsb2FkaW5nIG1hcHMgdHdpY2UNCiAgICAgICAgY2FsbGJhY2tzLnB1c2goY2FsbGJhY2spOw0KDQogICAgICAgIGlmICghbG9hZGluZykgew0KICAgICAgICAgICAgbG9hZGluZyA9IHRydWU7DQogICAgICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQogICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCJzcmMiLCAiLy9kZXYudmlydHVhbGVhcnRoLm5ldC9tYXBjb250cm9sL21hcGNvbnRyb2wuYXNoeD92PTcuMCZvblNjcmlwdExvYWQ9aW5pdE1hcCIpOw0KICAgICAgICAgICAgc2NyaXB0LnNldEF0dHJpYnV0ZSgidHlwZSIsICJ0ZXh0L2phdmFzY3JpcHQiKTsNCiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICBhcGkuc2hvd01hcCA9IGZ1bmN0aW9uIChtYXBJZCwgb3B0aW9ucywgdmlld0JvdW5kcykgew0KICAgICAgICBpZiAodmlld0JvdW5kcyBpbnN0YW5jZW9mIEFycmF5KSB7DQogICAgICAgICAgICBtYXBPcHRpb25zID0gew0KICAgICAgICAgICAgICAgIHpvb206IG9wdGlvbnMuem9vbSwNCiAgICAgICAgICAgICAgICBjZW50ZXI6IG5ldyBNaWNyb3NvZnQuTWFwcy5Mb2NhdGlvbih2aWV3Qm91bmRzWzBdLCB2aWV3Qm91bmRzWzFdKSwNCiAgICAgICAgICAgICAgICBtYXBUeXBlSWQ6IGdldE1hcFR5cGUob3B0aW9ucyksDQogICAgICAgICAgICAgICAgY3JlZGVudGlhbHM6IG9wdGlvbnMua2V5DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgbWFwID0gbmV3IE1pY3Jvc29mdC5NYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtYXBJZCksIG1hcE9wdGlvbnMpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbWFwT3B0aW9ucyA9IHsNCiAgICAgICAgICAgICAgICBtYXBUeXBlSWQ6IGdldE1hcFR5cGUob3B0aW9ucyksDQogICAgICAgICAgICAgICAgYm91bmRzOiB2aWV3Qm91bmRzDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgbWFwID0gbmV3IE1pY3Jvc29mdC5NYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtYXBJZCksIG1hcE9wdGlvbnMpOw0KICAgICAgICAgICAgaWYgKG9wdGlvbnMucG9pQ291bnQgPCAyKSB7DQogICAgICAgICAgICAgICAgbWFwLnNldFZpZXcoeyB6b29tOiBvcHRpb25zLnpvb20gfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAob3B0aW9ucy5kaXNhYmxlTWFwWm9vbU9uU2Nyb2xsID09PSAiMSIpIHsNCiAgICAgICAgICAgIE1pY3Jvc29mdC5NYXBzLkV2ZW50cy5hZGRIYW5kbGVyKG1hcCwgJ21vdXNld2hlZWwnLCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgZS5oYW5kbGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKG9wdGlvbnMuZGlzYWJsZU1hcFNjcm9sbGluZyA9PT0gIjEiKSB7DQogICAgICAgICAgICBNaWNyb3NvZnQuTWFwcy5FdmVudHMuYWRkSGFuZGxlcihtYXAsICdtb3VzZWRvd24nLCBmdW5jdGlvbiAobW91c2VFdmVudCkgew0KICAgICAgICAgICAgICAgIG1vdXNlRXZlbnQuaGFuZGxlZCA9IHRydWU7DQogICAgICAgICAgICB9KTsgDQogICAgICAgIH0NCg0KICAgICAgICBtYXBzW21hcElkXSA9IG1hcDsNCiAgICB9Ow0KDQogICAgYXBpLnJlbmRlclBvaSA9IGZ1bmN0aW9uIChtYXBJZCwgZGF0YSkgew0KICAgICAgICB2YXIgbWFwID0gbWFwc1ttYXBJZF0sDQogICAgICAgICAgICBwdXNocGluID0gY3JlYXRlUGluKGRhdGEsIG1hcElkKTsNCg0KICAgICAgICBhZGRQaW4obWFwSWQsIHB1c2hwaW4sIGRhdGEpOw0KDQogICAgICAgIGRhdGEubWFwSWQgPSBtYXBJZDsNCiAgICAgICAgcHVzaHBpbi5kYXRhID0gZGF0YTsNCiAgICAgICAgbWFwLmVudGl0aWVzLnB1c2gocHVzaHBpbik7DQogICAgICAgIHB1c2hwaW4uc2V0TG9jYXRpb24obmV3IE1pY3Jvc29mdC5NYXBzLkxvY2F0aW9uKGRhdGEubGF0aXR1ZGUsIGRhdGEubG9uZ2l0dWRlKSk7DQoNCiAgICAgICAgTWljcm9zb2Z0Lk1hcHMuRXZlbnRzLmFkZEhhbmRsZXIocHVzaHBpbiwgJ2NsaWNrJywgcmVuZGVySW5mb0JveCk7DQogICAgfTsNCg0KICAgIGFwaS5yZW5kZXJEeW5hbWljUG9pID0gZnVuY3Rpb24obWFwSWQsIGRhdGEsIGdldFBvaUNvbnRlbnQpIHsNCiAgICAgICAgdmFyIG1hcCA9IG1hcHNbbWFwSWRdLA0KICAgICAgICAgICAgcHVzaHBpbiA9IGNyZWF0ZVBpbihkYXRhLCBtYXBJZCk7DQoNCiAgICAgICAgYWRkUGluKG1hcElkLCBwdXNocGluLCBkYXRhKTsNCg0KICAgICAgICBkYXRhLm1hcElkID0gbWFwSWQ7DQogICAgICAgIHB1c2hwaW4uZGF0YSA9IGRhdGE7DQogICAgICAgIG1hcC5lbnRpdGllcy5wdXNoKHB1c2hwaW4pOw0KICAgICAgICBwdXNocGluLnNldExvY2F0aW9uKG5ldyBNaWNyb3NvZnQuTWFwcy5Mb2NhdGlvbihkYXRhLmxhdGl0dWRlLCBkYXRhLmxvbmdpdHVkZSkpOw0KDQogICAgICAgIE1pY3Jvc29mdC5NYXBzLkV2ZW50cy5hZGRIYW5kbGVyKHB1c2hwaW4sICdjbGljaycsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICBpZiAoZS50YXJnZXRUeXBlID09ICdwdXNocGluJyAmJiB0eXBlb2YgKGdldFBvaUNvbnRlbnQpID09PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgICAgdmFyIHBvaUlkID0gZGF0YS5pZCwNCiAgICAgICAgICAgICAgICAgICAgcG9pVHlwZUlkID0gZGF0YS5wb2lUeXBlSWQsDQogICAgICAgICAgICAgICAgICAgIHBvaVZhcmlhbnRJZCA9IGRhdGEucG9pVmFyaWFudElkLA0KICAgICAgICAgICAgICAgICAgICBpbmZvYm94Ow0KDQogICAgICAgICAgICAgICAgaWYgKHBvaVZhcmlhbnRJZCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBnZXRQb2lDb250ZW50KHBvaUlkLCBwb2lUeXBlSWQsIHBvaVZhcmlhbnRJZCwgZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGluZm9ib3hlcy5oYXNPd25Qcm9wZXJ0eShtYXBJZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5lbnRpdGllcy5yZW1vdmUoaW5mb2JveGVzW21hcElkXSk7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaW5mb2JveGVzW21hcElkXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpbmZvYm94ID0gbmV3IE1pY3Jvc29mdC5NYXBzLkluZm9ib3goZS50YXJnZXQuZ2V0TG9jYXRpb24oKSwgbnVsbCk7DQogICAgICAgICAgICAgICAgICAgIG1hcC5lbnRpdGllcy5wdXNoKGluZm9ib3gpOw0KICAgICAgICAgICAgICAgICAgICBpbmZvYm94LnNldE9wdGlvbnMoew0KICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGRhdGEuSHRtbCwNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldCB0aGUgaW5mb2JveCBlbm91Z2ggdG8ga2VlcCBpdCBmcm9tIG92ZXJsYXBwaW5nIHRoZSBwaW4uDQogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IG5ldyBNaWNyb3NvZnQuTWFwcy5Qb2ludCgwLCBwdXNocGluLmdldEhlaWdodCgpKQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgaW5mb2JveGVzW21hcElkXSA9IGluZm9ib3g7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH07DQoNCiAgICBhcGkuY2xlYXJNYXJrZXJzID0gZnVuY3Rpb24obWFwSWQpIHsNCiAgICAgICAgdmFyIG1hcFBpbnMsDQogICAgICAgICAgICBtYXAgPSBtYXBzW21hcElkXTsNCg0KICAgICAgICBpZiAocGlucy5oYXNPd25Qcm9wZXJ0eShtYXBJZCkpIHsNCiAgICAgICAgICAgIG1hcFBpbnMgPSBwaW5zW21hcElkXTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFwUGlucy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGlmIChtYXBQaW5zW2ldLnR5cGUgPT09ICJEeW5hbWljIikgew0KICAgICAgICAgICAgICAgICAgICBtYXAuZW50aXRpZXMucmVtb3ZlKG1hcFBpbnNbaV0ucGluKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwaW5zW21hcElkXSA9IG1hcFBpbnMuZmlsdGVyKGZ1bmN0aW9uIChwaW5EYXRhKSB7DQogICAgICAgICAgICAgICAgaWYgKHBpbkRhdGEudHlwZSA9PT0gIlN0YXRpYyIgfHwgcGluRGF0YS50eXBlID09PSAiTXlMb2NhdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGluZm9ib3hlc1ttYXBJZF0pIHsNCiAgICAgICAgICAgIG1hcEluZm9ib3hlcyA9IGluZm9ib3hlc1ttYXBJZF07DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcEluZm9ib3hlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIG1hcC5lbnRpdGllcy5yZW1vdmUobWFwSW5mb2JveGVzW2ldKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICBhcGkudXBkYXRlTWFwUG9zaXRpb24gPSBmdW5jdGlvbiAobWFwSWQsIGRlZmF1bHRab29tKSB7DQogICAgICAgIHZhciBtYXAgPSBtYXBzW21hcElkXSwNCiAgICAgICAgICAgIG1hcFBpbnMgPSBbXSwNCiAgICAgICAgICAgIG1pY3Jvc29mdExvY2F0aW9ucyA9IFtdLA0KICAgICAgICAgICAgYm91bmRzOw0KDQogICAgICAgIGlmIChwaW5zLmhhc093blByb3BlcnR5KG1hcElkKSkgew0KICAgICAgICAgICAgbWFwUGlucyA9IHBpbnNbbWFwSWRdOw0KICAgICAgICB9DQoNCiAgICAgICAgbWFwUGlucy5mb3JFYWNoKGZ1bmN0aW9uIChwaW5EYXRhKSB7DQogICAgICAgICAgICBtaWNyb3NvZnRMb2NhdGlvbnMucHVzaChuZXcgTWljcm9zb2Z0Lk1hcHMuTG9jYXRpb24ocGluRGF0YS5waW4uZGF0YS5sYXRpdHVkZSwgcGluRGF0YS5waW4uZGF0YS5sb25naXR1ZGUpKQ0KICAgICAgICB9LCB0aGlzKTsNCg0KICAgICAgICBtYXAuc2V0Vmlldyh7IGJvdW5kczogTWljcm9zb2Z0Lk1hcHMuTG9jYXRpb25SZWN0LmZyb21Mb2NhdGlvbnMobWljcm9zb2Z0TG9jYXRpb25zKX0pOw0KICAgICAgICBpZiAobWFwUGlucy5sZW5ndGggPT09IDEpIHsNCiAgICAgICAgICAgIG1hcC5zZXRWaWV3KHsgem9vbTogZGVmYXVsdFpvb20gfSk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgYXBpLmNlbnRlck1hcCA9IGZ1bmN0aW9uKG1hcElkLCBkYXRhLCBjZW50ZXJNYXAsIGFuaW1hdGUpIHsNCiAgICAgICB2YXIgbWFwID0gbWFwc1ttYXBJZF07DQogICAgICAgaWYgKGNlbnRlck1hcCl7DQogICAgICAgICAgbWFwLnNldFZpZXcoe2NlbnRlcjogbmV3IE1pY3Jvc29mdC5NYXBzLkxvY2F0aW9uKGRhdGEuY29vcmRpbmF0ZXNbMF0sIGRhdGEuY29vcmRpbmF0ZXNbMV0pIH0pOw0KICAgICAgIH0NCiAgICB9Ow0KDQogICAgYXBpLmdldENlbnRyYWxQb2ludCA9IGZ1bmN0aW9uIChwb2lzQ29vcmRzKSB7DQoNCiAgICAgICAgdmFyIG1pY3Jvc29mdExvY2F0aW9ucyA9IFtdLA0KICAgICAgICAgICAgYm91bmRzOw0KDQogICAgICAgIHBvaXNDb29yZHMuZm9yRWFjaChmdW5jdGlvbiAocG9pKSB7DQogICAgICAgICAgICBpZiAocG9pLmxhdGl0dWRlICE9PSAiIiAmJiBwb2kubG9uZ2l0dWRlICE9PSAiIikgew0KICAgICAgICAgICAgICAgIG1pY3Jvc29mdExvY2F0aW9ucy5wdXNoKG5ldyBNaWNyb3NvZnQuTWFwcy5Mb2NhdGlvbihwb2kubGF0aXR1ZGUsIHBvaS5sb25naXR1ZGUpKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LCB0aGlzKTsNCg0KICAgICAgICBib3VuZHMgPSBNaWNyb3NvZnQuTWFwcy5Mb2NhdGlvblJlY3QuZnJvbUxvY2F0aW9ucyhtaWNyb3NvZnRMb2NhdGlvbnMpOw0KDQogICAgICAgIHJldHVybiBib3VuZHM7DQogICAgfTsNCg0KICAgIGFwaS5sb2NhdGlvbkF1dG9jb21wbGV0ZSA9IGZ1bmN0aW9uKHF1ZXJ5UGFyYW1zLCBzdWNjZXNzQ2FsbGJhY2ssIGZhaWxDYWxsYmFjayl7DQogICAgICAgIHZhciBtYXhSZXN1bHRzID0gcXVlcnlQYXJhbXMubWF4UmVzdWx0cyA8PSAwID8gMSA6IHF1ZXJ5UGFyYW1zLm1heFJlc3VsdHM7DQoNCiAgICAgICAgbG9va3VwKHF1ZXJ5UGFyYW1zLA0KICAgICAgICBmdW5jdGlvbihyZXN1bHRzKXsgLy9zdWNjZXNzDQogICAgICAgICAgICB2YXIgbGVuZ3RoID0gcmVzdWx0cy5sZW5ndGggPj0gbWF4UmVzdWx0cyA/IG1heFJlc3VsdHMgOiByZXN1bHRzLmxlbmd0aCwNCiAgICAgICAgICAgICAgICBwcmVkaWN0aW9ucyA9IFtdOw0KDQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgcHJlZGljdGlvbnMucHVzaChfLmV4dGVuZChyZXN1bHRzW2ldLCB7dGV4dCA6IHJlc3VsdHNbaV0ubmFtZSwgYXV0b2NvbXBsZXRlZCA6IHRydWV9KSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhwcmVkaWN0aW9ucyk7DQogICAgICAgIH0sDQogICAgICAgIGZ1bmN0aW9uKCl7IC8vZmFpbA0KICAgICAgICAgICAgZmFpbENhbGxiYWNrKCk7DQogICAgICAgIH0pOw0KICAgIH07DQoNCiAgICBhcGkuYWRkcmVzc0xvb2t1cCA9IGZ1bmN0aW9uIChxdWVyeVBhcmFtcywgc3VjY2Vzc0NhbGxiYWNrLCBmYWlsQ2FsbGJhY2spIHsNCiAgICAgICAgdmFyIHJlc3VsdDsNCiAgICAgICAgaWYocXVlcnlQYXJhbXMuYXV0b2NvbXBsZXRlZCl7IC8vYWZ0ZXIgYXV0b2NvbXBsZXRlDQogICAgICAgICAgICByZXN1bHQgPSBxdWVyeVBhcmFtcy5sb2NhdGlvbjsNCiAgICAgICAgICAgIGlmKHJlc3VsdCl7DQogICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKFtyZXN1bHQubGF0aXR1ZGUscmVzdWx0LmxvbmdpdHVkZV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgZmFpbENhbGxiYWNrKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7IC8vc3RhbmRhcmQgbG9va3VwDQogICAgICAgICAgICBsb29rdXAocXVlcnlQYXJhbXMsDQogICAgICAgICAgICBmdW5jdGlvbihyZXN1bHRzKXsgLy9zdWNjZXNzDQogICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0c1swXTsNCiAgICAgICAgICAgICAgICBpZihyZXN1bHQubG9jYXRpb24pew0KICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soW3Jlc3VsdC5sb2NhdGlvbi5sYXRpdHVkZSxyZXN1bHQubG9jYXRpb24ubG9uZ2l0dWRlXSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBmYWlsQ2FsbGJhY2soKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZnVuY3Rpb24oKXsgLy9mYWlsDQogICAgICAgICAgICAgICAgZmFpbENhbGxiYWNrKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICBhcGkudXBkYXRlTXlQb2lMb2NhdGlvbiA9IGZ1bmN0aW9uKG1hcElkLCBjb29yZGluYXRlcywgZGVmYXVsdFpvb20pIHsNCiAgICAgICAgdmFyIG1hcFBpbnMsDQogICAgICAgICAgICBteUxvY2F0aW9uUGluLA0KICAgICAgICAgICAgbWFwID0gbWFwc1ttYXBJZF07DQoNCiAgICAgICAgaWYgKHBpbnMuaGFzT3duUHJvcGVydHkobWFwSWQpKSB7DQogICAgICAgICAgICBtYXBQaW5zID0gcGluc1ttYXBJZF07DQogICAgICAgICAgICBteUxvY2F0aW9uUGluID0gbWFwUGlucy5maWx0ZXIoZnVuY3Rpb24gKHBpbikgew0KICAgICAgICAgICAgICAgIGlmIChwaW4udHlwZSA9PT0gIk15TG9jYXRpb24iKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGlmIChteUxvY2F0aW9uUGluLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBteUxvY2F0aW9uUGluWzBdLnBpbi5zZXRMb2NhdGlvbihuZXcgTWljcm9zb2Z0Lk1hcHMuTG9jYXRpb24oY29vcmRpbmF0ZXNbMF0sIGNvb3JkaW5hdGVzWzFdKSk7DQogICAgICAgICAgICAgICAgbXlMb2NhdGlvblBpblswXS5waW4uZGF0YS5sYXRpdHVkZSA9IGNvb3JkaW5hdGVzWzBdOw0KICAgICAgICAgICAgICAgIG15TG9jYXRpb25QaW5bMF0ucGluLmRhdGEubG9uZ2l0dWRlID0gY29vcmRpbmF0ZXNbMV07DQogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVNYXBQb3NpdGlvbihtYXBJZCwgZGVmYXVsdFpvb20pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHJldHVybiBhcGk7DQoNCn0pKGpRdWVyeSwgZG9jdW1lbnQpOw0K
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 13350
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160517T105549Z
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "18fdb097-df6d-4796-aab2-526125e6a4d4"
