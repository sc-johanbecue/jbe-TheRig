---
ID: "3681b14b-68d3-4223-b11a-551cd1ef8bab"
Parent: "1b7d919b-1569-41b2-a993-ed6fb4a5b649"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Base Themes/Maps/Scripts/component-map"
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/3681B14B68D34223B11A551CD1EF8BAB.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "3681b14b-68d3-4223-b11a-551cd1ef8bab"
  Value: 77u/WEEuY29tcG9uZW50Lm1hcCA9IChmdW5jdGlvbiAoJCwgZG9jdW1lbnQpIHsNCg0KICAgICJ1c2Ugc3RyaWN0IjsNCg0KICAgIHZhciBhcGkgPSB7fSwNCiAgICAgICAgbWFwcyA9IFtdLA0KICAgICAgICBzZWFyY2hFbmRwb2ludCwNCiAgICAgICAgc2VhcmNoUmVzdWx0c1NpZ25hdHVyZXMgPSBbXSwNCiAgICAgICAga2V5LA0KICAgICAgICB1cmxIZWxwZXJNb2RlbCwNCiAgICAgICAgYXBpTW9kZWwsDQogICAgICAgIHF1ZXJ5TW9kZWwsDQogICAgICAgIG1hcHNDb25uZWN0b3IsDQogICAgICAgIHNjcmlwdHNMb2FkZWQgPSBmYWxzZSwNCiAgICAgICAgaW5pdGlhbGl6ZSwNCiAgICAgICAgc2VhcmNoUmVzdWx0cywNCiAgICAgICAgcHVzaE1hcERhdGEsDQogICAgICAgIHJlc3VsdHNMb2FkZWQsDQogICAgICAgIG15TG9jYXRpb25DaGFuZ2VkLA0KICAgICAgICBteUxvY2F0aW9uRGF0YSwNCiAgICAgICAgbWFwVmlld3MgPSBbXSwNCiAgICAgICAgTWFwTW9kZWwsDQogICAgICAgIE1hcFZpZXc7DQoNCiAgICByZXN1bHRzTG9hZGVkID0gZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgc2VhcmNoUmVzdWx0cyA9IGRhdGE7DQogICAgfTsNCg0KICAgIG15TG9jYXRpb25DaGFuZ2VkID0gZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgbXlMb2NhdGlvbkRhdGEgPSBkYXRhOw0KICAgIH07DQoNCiAgICBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgaSwgbWFwc0NvdW50ID0gbWFwcy5sZW5ndGg7DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBtYXBzQ291bnQ7IGkrKykgew0KICAgICAgICAgICAgLy9jcmF0ZSBCYWNrYm9uZS5qcyB2aWV3cyAtIG9uZSB2aWV3IHBlciBjb21wb25lbnQgb24gdGhlIHBhZ2UNCiAgICAgICAgICAgIG1hcFZpZXdzLnB1c2gobmV3IE1hcFZpZXcoe2VsOiBtYXBzW2ldLCBtb2RlbDogbmV3IE1hcE1vZGVsKCl9KSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHR5cGVvZiAoWEEuY29tcG9uZW50LnNlYXJjaCkgIT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICBwdXNoTWFwRGF0YSgpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHB1c2hNYXBEYXRhID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBub3RJbml0aWFsaXplZE1hcHMsDQogICAgICAgICAgICByZXN1bHRzRXhpc3RzID0gdHlwZW9mIHNlYXJjaFJlc3VsdHMgIT09ICJ1bmRlZmluZWQiLA0KICAgICAgICAgICAgbXlMb2NhdGlvbkV4aXN0cyA9IHR5cGVvZiBteUxvY2F0aW9uRGF0YSAhPT0gInVuZGVmaW5lZCI7DQoNCiAgICAgICAgaWYgKHJlc3VsdHNFeGlzdHMgfHwgbXlMb2NhdGlvbkV4aXN0cykgew0KICAgICAgICAgICAgLy9pbiBjYXNlIHRoYXQgcmVzdWx0cyB3ZXJlIGxvYWRlZCBiZWZvcmUgaW5pdGlhbGl6YXRpb24gb2YgdmlldyBhbmQgbW9kZWwsIHRyaWdnZXIgYW5vdGhlciBldmVudCB3aXRoDQogICAgICAgICAgICAvL3ByZXZpb3VzbHkgbG9hZGVkIHJlc3VsdHMNCiAgICAgICAgICAgIC8vdGhpcyB3aWxsIGhhcHBlbiBqdXN0IG9uY2UgLSB3aGlsZSBpbml0aWFsaXphdGlvbg0KICAgICAgICAgICAgLy9yZW1lbWJlciBhYm91dCBjaGVja2luZyBpZiBhbGwgbWFwcyBhcmUgYWxyZWFkeSByZW5kZXJlZA0KICAgICAgICAgICAgbm90SW5pdGlhbGl6ZWRNYXBzID0gbWFwVmlld3MuZmlsdGVyKGZ1bmN0aW9uICh2aWV3KSB7DQogICAgICAgICAgICAgICAgaWYgKHZpZXcubW9kZWwuZ2V0KCJzaG93ZWQiKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBpZiAobm90SW5pdGlhbGl6ZWRNYXBzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHB1c2hNYXBEYXRhLCAxMDAwKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKHJlc3VsdHNFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgWEEuY29tcG9uZW50LnNlYXJjaC52ZW50LnRyaWdnZXIoImludGVybmFsLXJlc3VsdHMtbG9hZGVkIiwgc2VhcmNoUmVzdWx0cyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChteUxvY2F0aW9uRXhpc3RzKSB7DQogICAgICAgICAgICAgICAgICAgIFhBLmNvbXBvbmVudC5zZWFyY2gudmVudC50cmlnZ2VyKCJpbnRlcm5hbC1teS1sb2NhdGlvbi1jb29yZGluYXRlcy1jaGFuZ2VkIiwgbXlMb2NhdGlvbkRhdGEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICBNYXBNb2RlbCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7DQogICAgICAgIGRlZmF1bHRzOiB7DQogICAgICAgICAgICBkYXRhUHJvcGVydGllczoge30sDQogICAgICAgICAgICBkeW5hbWljUG9pTGlzdDogW10sDQogICAgICAgICAgICBzaG93ZWQ6IGZhbHNlLA0KICAgICAgICAgICAgbXlMb2NhdGlvbjogWyIiLCAiIl0sDQogICAgICAgICAgICBpZDogbnVsbCwNCiAgICAgICAgICAgIGxvYWRNb3JlOiBmYWxzZQ0KICAgICAgICB9LA0KICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHZhciBzaWcgPSB0aGlzLmdldCgiZGF0YVByb3BlcnRpZXMiKS5zZWFyY2hSZXN1bHRzU2lnbmF0dXJlLA0KICAgICAgICAgICAgICAgIGhhc2ggPSBxdWVyeU1vZGVsLnBhcnNlSGFzaFBhcmFtZXRlcnMod2luZG93LmxvY2F0aW9uLmhhc2gpLA0KICAgICAgICAgICAgICAgIHBhcmFtID0gdHlwZW9mIChzaWcpICE9PSAidW5kZWZpbmVkIiAmJiBzaWcgIT09ICIiID8gc2lnICsgIl9nIiA6ICJnIjsNCg0KICAgICAgICAgICAgaWYgKHR5cGVvZiAoWEEuY29tcG9uZW50LnNlYXJjaCkgIT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAgICAgWEEuY29tcG9uZW50LnNlYXJjaC52ZW50Lm9uKCJyZXN1bHRzLWxvYWRlZCIsIHRoaXMudXBkYXRlRHluYW1pY1BvaUxpc3QuYmluZCh0aGlzKSk7DQogICAgICAgICAgICAgICAgWEEuY29tcG9uZW50LnNlYXJjaC52ZW50Lm9uKCJpbnRlcm5hbC1yZXN1bHRzLWxvYWRlZCIsIHRoaXMudXBkYXRlRHluYW1pY1BvaUxpc3QuYmluZCh0aGlzKSk7DQogICAgICAgICAgICAgICAgWEEuY29tcG9uZW50LnNlYXJjaC52ZW50Lm9uKCJteS1sb2NhdGlvbi1jb29yZGluYXRlcy1jaGFuZ2VkIiwgdGhpcy5jaGFuZ2VNeUxvY2F0aW9uLmJpbmQodGhpcykpOw0KICAgICAgICAgICAgICAgIFhBLmNvbXBvbmVudC5zZWFyY2gudmVudC5vbigiaW50ZXJuYWwtbXktbG9jYXRpb24tY29vcmRpbmF0ZXMtY2hhbmdlZCIsIHRoaXMuY2hhbmdlTXlMb2NhdGlvbi5iaW5kKHRoaXMpKTsNCiAgICAgICAgICAgICAgICBYQS5jb21wb25lbnQuc2VhcmNoLnZlbnQub24oImhhc2hDaGFuZ2VkIiwgdGhpcy5oYXNoQ2hhbmdlZC5iaW5kKHRoaXMpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGhhc2guaGFzT3duUHJvcGVydHkocGFyYW0pICYmIGhhc2hbcGFyYW1dICE9PSAiIikgew0KICAgICAgICAgICAgICAgIC8vaWYgTG9jYXRpb24gRmlsdGVyIGNvbXBvbmVudCBpcyBvbiB0aGUgcGFnZSBpdCBjb3VsZCBhbHJlYWR5IGZpbGwgImciIGhhc2ggcGFyYW1ldGVyDQogICAgICAgICAgICAgICAgdGhpcy5zZXQoIm15TG9jYXRpb24iLCBoYXNoW3BhcmFtXS5zcGxpdCgifCIpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgZ2V0UG9pVmFyaWFudDogZnVuY3Rpb24gKHBvaVR5cGVJZCwgcG9pVmFyaWFudElkKSB7DQogICAgICAgICAgICB2YXIgbWFwcGluZyA9IHRoaXMuZ2V0KCJkYXRhUHJvcGVydGllcyIpLnR5cGVUb1ZhcmlhbnRNYXBwaW5nLA0KICAgICAgICAgICAgICAgIHR5cGVJZDsNCg0KICAgICAgICAgICAgaWYgKHR5cGVvZiBwb2lUeXBlSWQgIT09ICJ1bmRlZmluZWQiICYmIHBvaVR5cGVJZCAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgdHlwZUlkID0gInsiICsgcG9pVHlwZUlkLnRvVXBwZXJDYXNlKCkgKyAifSI7DQogICAgICAgICAgICAgICAgaWYgKG1hcHBpbmcuaGFzT3duUHJvcGVydHkodHlwZUlkKSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFwcGluZ1t0eXBlSWRdOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2lWYXJpYW50SWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHBvaVZhcmlhbnRJZDsNCiAgICAgICAgfSwNCiAgICAgICAgdXBkYXRlRHluYW1pY1BvaUxpc3Q6IGZ1bmN0aW9uKHNlYXJjaFJlc3VsdHMpIHsNCiAgICAgICAgICAgIHZhciBkeW5hbWljUG9pTGlzdCA9IFtdLA0KICAgICAgICAgICAgICAgIHNpZ25hdHVyZSA9IHRoaXMuZ2V0KCJkYXRhUHJvcGVydGllcyIpLnNlYXJjaFJlc3VsdHNTaWduYXR1cmUsDQogICAgICAgICAgICAgICAgZ2VvbG9jYXRpb25EYXRhID0gc2VhcmNoUmVzdWx0cy5kYXRhLmZpbHRlcihmdW5jdGlvbiAocmVzdWx0KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaGFzT3duUHJvcGVydHkoIkdlb3NwYXRpYWwiKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICBpLA0KICAgICAgICAgICAgICAgIHBvaTsNCg0KICAgICAgICAgICAgaWYgKHNpZ25hdHVyZSAhPT0gc2VhcmNoUmVzdWx0cy5zZWFyY2hSZXN1bHRzU2lnbmF0dXJlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvL3NhdmUgaW5mb3JtYXRpb24gdGhhdCB0aG9zZSBQT0lzIGNvbWVzIGZyb20gbG9hZCBtb3JlIGFjdGlvbg0KICAgICAgICAgICAgdGhpcy5zZXQoImxvYWRNb3JlIiwgc2VhcmNoUmVzdWx0cy5sb2FkTW9yZSk7DQoNCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBnZW9sb2NhdGlvbkRhdGEubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBwb2kgPSBnZW9sb2NhdGlvbkRhdGFbaV07DQoNCiAgICAgICAgICAgICAgICAvL2Rvbid0IHNob3cgUE9JcyB3aGljaCBkb2Vzbid0IGhhdmUgTGF0aXR1ZGUgYW5kIExvbmdpdHVkZQ0KICAgICAgICAgICAgICAgIGlmIChwb2kuR2Vvc3BhdGlhbC5MYXRpdHVkZSA9PT0gMCB8fCBwb2kuR2Vvc3BhdGlhbC5Mb25naXR1ZGUgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgZHluYW1pY1BvaUxpc3QucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIGlkOiBwb2kuSWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJEeW5hbWljIiwNCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHBvaS5OYW1lLA0KICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogcG9pLkdlb3NwYXRpYWwuTGF0aXR1ZGUsDQogICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogcG9pLkdlb3NwYXRpYWwuTG9uZ2l0dWRlLA0KICAgICAgICAgICAgICAgICAgICBpY29uOiBwb2kuR2Vvc3BhdGlhbC5Qb2lJY29uLA0KICAgICAgICAgICAgICAgICAgICBwb2lUeXBlSWQ6IHBvaS5HZW9zcGF0aWFsLlBvaVR5cGVJZCwNCiAgICAgICAgICAgICAgICAgICAgcG9pVmFyaWFudElkOiB0aGlzLmdldFBvaVZhcmlhbnQocG9pLkdlb3NwYXRpYWwuUG9pVHlwZUlkLCBwb2kuR2Vvc3BhdGlhbC5Qb2lWYXJpYW50SWQpDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRoaXMuc2V0KCJkeW5hbWljUG9pTGlzdCIsIGR5bmFtaWNQb2lMaXN0KTsNCiAgICAgICAgfSwNCiAgICAgICAgY2hhbmdlTXlMb2NhdGlvbjogZnVuY3Rpb24gKG15TG9jYXRpb25EYXRhKSB7DQogICAgICAgICAgICB2YXIgc2lnID0gdGhpcy5nZXQoImRhdGFQcm9wZXJ0aWVzIikuc2VhcmNoUmVzdWx0c1NpZ25hdHVyZTsNCiAgICAgICAgICAgIGlmIChzaWcgPT09IG15TG9jYXRpb25EYXRhLnNpZykgew0KICAgICAgICAgICAgICAgIHRoaXMuc2V0KCJteUxvY2F0aW9uIiwgbXlMb2NhdGlvbkRhdGEuY29vcmRpbmF0ZXMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBoYXNoQ2hhbmdlZDogZnVuY3Rpb24gKGhhc2gpIHsNCiAgICAgICAgICAgIHZhciBzaWcgPSB0aGlzLmdldCgiZGF0YVByb3BlcnRpZXMiKS5zZWFyY2hSZXN1bHRzU2lnbmF0dXJlLA0KICAgICAgICAgICAgICAgIGxvY2F0aW9uID0gaGFzaFtzaWcgIT09ICIiID8gc2lnICsgIl9nIiA6ICJnIl0sDQogICAgICAgICAgICAgICAgbXlMb2NhdGlvbkRhdGFTaWduYXR1cmUgPSB0eXBlb2YgbXlMb2NhdGlvbkRhdGEgIT09ICJ1bmRlZmluZWQiID8gbXlMb2NhdGlvbkRhdGEuc2lnIDogIiIsDQogICAgICAgICAgICAgICAgcGFydHM7DQoNCiAgICAgICAgICAgIGlmIChzaWcgPT09IG15TG9jYXRpb25EYXRhU2lnbmF0dXJlICYmIHR5cGVvZiBsb2NhdGlvbiAhPT0gInVuZGVmaW5lZCIgJiYgbG9jYXRpb24gIT09IG51bGwgJiYgbG9jYXRpb24gIT09ICIiKSB7DQogICAgICAgICAgICAgICAgcGFydHMgPSBsb2NhdGlvbi5zcGxpdCgifCIpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPiAxKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0KCJteUxvY2F0aW9uIiwgW3BhcnRzWzBdLCBwYXJ0c1sxXV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgTWFwVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsNCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBkYXRhUHJvcGVydGllcyA9IHRoaXMuJGVsLmRhdGEoKSwNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzID0gZGF0YVByb3BlcnRpZXMucHJvcGVydGllczsNCg0KICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwpIHsNCiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7ZGF0YVByb3BlcnRpZXM6IHByb3BlcnRpZXN9KTsNCiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7aWQ6IHRoaXMuJGVsLmZpbmQoIi5tYXAtY2FudmFzIikucHJvcCgiaWQiKX0pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB0aGlzLnJlbmRlcigpOw0KICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigiY2hhbmdlOmR5bmFtaWNQb2lMaXN0IiwgdGhpcy5yZW5kZXJEeW5hbWljUG9pcywgdGhpcyk7DQogICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCJjaGFuZ2U6bXlMb2NhdGlvbiIsIHRoaXMudXBkYXRlTXlMb2NhdGlvblBvaSwgdGhpcyk7DQogICAgICAgICAgICBpZiAodHlwZW9mIChYQS5jb21wb25lbnQuc2VhcmNoKSAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICBYQS5jb21wb25lbnQuc2VhcmNoLnZlbnQub24oImNlbnRlci1tYXAiLCB0aGlzLmhhbmRsZUNlbnRlck1hcC5iaW5kKHRoaXMpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMudXBkYXRlTXlMb2NhdGlvblBvaSgpOw0KDQogICAgICAgIH0sDQogICAgICAgIHJlbmRlciA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywNCiAgICAgICAgICAgICAgICBzaG93ZWQgPSB0aGlzLm1vZGVsLmdldCgic2hvd2VkIiksDQogICAgICAgICAgICAgICAgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5tb2RlbC5nZXQoImlkIikpOw0KDQogICAgICAgICAgICBpZiAoIXNob3dlZCAmJiBjYW52YXMgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmdldENlbnRyYWxQb2ludChmdW5jdGlvbiAodmlld0JvdW5kcywgY3R4KSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygdmlld0JvdW5kcyAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdHlwZW9mIGN0eCAhPT0gInVuZGVmaW5lZCIgPyBjdHggOiB0aGlzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gY29udGV4dC5tb2RlbC5nZXQoImlkIiksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllcyA9IGNvbnRleHQubW9kZWwuZ2V0KCJkYXRhUHJvcGVydGllcyIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcE9wdGlvbnMgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc0lkOiBpZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgem9vbTogdHlwZW9mKHByb3BlcnRpZXMuem9vbSkgPT09ICJudW1iZXIiID8gcHJvcGVydGllcy56b29tIDogY29udGV4dC5wYXJzZVpvb20ocHJvcGVydGllcy56b29tLCAxNSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6IHByb3BlcnRpZXMubW9kZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pQ291bnQ6IHByb3BlcnRpZXMucG9pcy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleTogcHJvcGVydGllcy5rZXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVNYXBTY3JvbGxpbmc6IHByb3BlcnRpZXMuZGlzYWJsZU1hcFNjcm9sbGluZywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZU1hcFpvb21PblNjcm9sbDogcHJvcGVydGllcy5kaXNhYmxlTWFwWm9vbU9uU2Nyb2xsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgbWFwc0Nvbm5lY3Rvci5zaG93TWFwKGlkLCBtYXBPcHRpb25zLCB2aWV3Qm91bmRzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQucmVuZGVyUG9pTGlzdChpZCwgcHJvcGVydGllcy5wb2lzKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5tb2RlbC5zZXQoInNob3dlZCIsIHRydWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHJlbmRlckR5bmFtaWNQb2lzOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHZhciBkYXRhUHJvcGVydGllcyA9IHRoaXMubW9kZWwuZ2V0KCJkYXRhUHJvcGVydGllcyIpLA0KICAgICAgICAgICAgICAgIGR5bmFtaWNQb2lMaXN0ID0gdGhpcy5tb2RlbC5nZXQoImR5bmFtaWNQb2lMaXN0IiksDQogICAgICAgICAgICAgICAgcHJvcGVydGllcyA9IHRoaXMubW9kZWwuZ2V0KCJkYXRhUHJvcGVydGllcyIpLA0KICAgICAgICAgICAgICAgIGlkID0gdGhpcy5tb2RlbC5nZXQoImlkIiksDQogICAgICAgICAgICAgICAgaTsNCg0KICAgICAgICAgICAgaWYgKCF0aGlzLm1vZGVsLmdldCgibG9hZE1vcmUiKSkgew0KICAgICAgICAgICAgICAgIG1hcHNDb25uZWN0b3IuY2xlYXJNYXJrZXJzKGlkKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGR5bmFtaWNQb2lMaXN0Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgbWFwc0Nvbm5lY3Rvci5yZW5kZXJEeW5hbWljUG9pKGlkLCBkeW5hbWljUG9pTGlzdFtpXSwgdGhpcy5nZXRHZW9Qb2lDb250ZW50LmJpbmQodGhpcykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvL2lmIHVzZXIgd2FudCB0byBzZWUgYWxsIFBPSXMgdGhlbiBhZnRlciBhZGRpbmcgZHluYW1pYyBQT0lzIHdlIGhhdmUgdG8gcmVjYWxjdWxhdGUgbWFwIGNlbnRlciBwb2ludA0KICAgICAgICAgICAgaWYgKGRhdGFQcm9wZXJ0aWVzLmNlbnRyYWxQb2ludE1vZGUgPT09ICJNaWRPZlBvaSIpIHsNCiAgICAgICAgICAgICAgICBtYXBzQ29ubmVjdG9yLnVwZGF0ZU1hcFBvc2l0aW9uKHRoaXMubW9kZWwuZ2V0KCJpZCIpLCB0aGlzLnBhcnNlWm9vbShwcm9wZXJ0aWVzLnpvb20sIDE1KSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHJlbmRlclBvaUxpc3Q6IGZ1bmN0aW9uKG1hcElkLCBwb2lMaXN0KSB7DQogICAgICAgICAgICB2YXIgaSwNCiAgICAgICAgICAgICAgICBwb2ksDQogICAgICAgICAgICAgICAgbXlMb2NhdGlvbiwNCiAgICAgICAgICAgICAgICBwb2lDb3VudCA9IHBvaUxpc3QubGVuZ3RoLA0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKSwNCiAgICAgICAgICAgICAgICBzaWcgPSBwcm9wZXJ0aWVzLnNlYXJjaFJlc3VsdHNTaWduYXR1cmUsDQogICAgICAgICAgICAgICAgaGFzaCA9IHF1ZXJ5TW9kZWwucGFyc2VIYXNoUGFyYW1ldGVycyh3aW5kb3cubG9jYXRpb24uaGFzaCksDQogICAgICAgICAgICAgICAgcGFyYW0gPSBzaWcgIT09ICIiID8gc2lnICsgIl9nIiA6ICJnIjsNCg0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHBvaUNvdW50OyBpKyspIHsNCiAgICAgICAgICAgICAgICBwb2kgPSBwb2lMaXN0W2ldOw0KDQogICAgICAgICAgICAgICAgaWYgKHBvaS5UeXBlID09PSAiTXlMb2NhdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgbXlMb2NhdGlvbiA9IHRoaXMubW9kZWwuZ2V0KCJteUxvY2F0aW9uIik7DQogICAgICAgICAgICAgICAgICAgIHBvaS5MYXRpdHVkZSA9IG15TG9jYXRpb25bMF07DQogICAgICAgICAgICAgICAgICAgIHBvaS5Mb25naXR1ZGUgPSBteUxvY2F0aW9uWzFdOw0KDQogICAgICAgICAgICAgICAgICAgIGlmICghaGFzaC5oYXNPd25Qcm9wZXJ0eShwYXJhbSkgfHwgKGhhc2guaGFzT3duUHJvcGVydHkocGFyYW0pICYmIGhhc2hbcGFyYW1dID09PSAiIikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgbm8gImciIHBhcmFtIHRoZW4gaXQncyBtZWFuIHRoYXQgdGhlcmUgaXMgbm8gTG9jYXRpb24gRmlsdGVyIG9uIHRoZSBtYXANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vaW4gdGhpcyBjYXNlIHdlIGhhdmUgdGFrZSBjb29yZGluYXRlZCBmcm9tIHRoZSBicm93c2VyIHRvIGRpc3BsYXkgTXkgTG9jYXRpb24gUE9JDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEN1cnJlbnRQb3NpdGlvbihmdW5jdGlvbiAoY29vcmRpbmF0ZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgibXlMb2NhdGlvbiIsIGNvb3JkaW5hdGVzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc2guaGFzT3duUHJvcGVydHkocGFyYW0pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgibXlMb2NhdGlvbiIsIGhhc2hbcGFyYW1dLnNwbGl0KCJ8IikpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwb2kuTGF0aXR1ZGUgPT09ICIiIHx8IHBvaS5Mb25naXR1ZGUgPT09ICIiKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIG1hcHNDb25uZWN0b3IucmVuZGVyUG9pKG1hcElkLCB7DQogICAgICAgICAgICAgICAgICAgIGlkOiBwb2kuSWQuR3VpZCwNCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHBvaS5UaXRsZSwNCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHBvaS5EZXNjcmlwdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHBvaS5MYXRpdHVkZSwNCiAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiBwb2kuTG9uZ2l0dWRlLA0KICAgICAgICAgICAgICAgICAgICBpY29uOiBwb2kuUG9pSWNvbiwNCiAgICAgICAgICAgICAgICAgICAgaHRtbDogcG9pLkh0bWwsDQogICAgICAgICAgICAgICAgICAgIHR5cGU6IHBvaS5UeXBlDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGdldFBvaUNvbnRlbnQ6IGZ1bmN0aW9uKHBvaUlkLCBwb2lUeXBlSWQsIHBvaVZhcmlhbnRJZCwgcmVuZGVyUG9pQ29udGVudENhbGxiYWNrKSB7DQogICAgICAgICAgICB2YXIgcHJvcGVydGllcyA9IHRoaXMubW9kZWwuZ2V0KCJkYXRhUHJvcGVydGllcyIpLA0KICAgICAgICAgICAgICAgIHVybCA9IHVybEhlbHBlck1vZGVsLmNyZWF0ZUdldFBvaUNvbnRlbnRVcmwoe2VuZHBvaW50OiBwcm9wZXJ0aWVzLnZhcmlhbnRzRW5kcG9pbnR9LCBwb2lJZCwgcG9pVmFyaWFudElkKTsNCg0KICAgICAgICAgICAgYXBpTW9kZWwuZ2V0RGF0YSh7DQogICAgICAgICAgICAgICAgY2FsbGJhY2s6IHJlbmRlclBvaUNvbnRlbnRDYWxsYmFjaywNCiAgICAgICAgICAgICAgICB1cmw6IHVybCwNCiAgICAgICAgICAgICAgICBleGNsdWRlU2l0ZU5hbWU6IHRydWUNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9LA0KICAgICAgICBnZXRHZW9Qb2lDb250ZW50OiBmdW5jdGlvbiAocG9pSWQsIHBvaVR5cGVJZCwgcG9pVmFyaWFudElkLCByZW5kZXJQb2lDb250ZW50Q2FsbGJhY2spIHsNCiAgICAgICAgICAgIHZhciBteUxvY2F0aW9uID0gdGhpcy5tb2RlbC5nZXQoIm15TG9jYXRpb24iKSwNCiAgICAgICAgICAgICAgICBsYXRpdHVkZSA9IG15TG9jYXRpb25bMF0sDQogICAgICAgICAgICAgICAgbG9uZ2l0dWRlID0gbXlMb2NhdGlvblsxXSwNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzID0gdGhpcy5tb2RlbC5nZXQoImRhdGFQcm9wZXJ0aWVzIiksDQogICAgICAgICAgICAgICAgaGFzaCA9IHF1ZXJ5TW9kZWwucGFyc2VIYXNoUGFyYW1ldGVycyh3aW5kb3cubG9jYXRpb24uaGFzaCksDQogICAgICAgICAgICAgICAgdW5pdHMgPSBoYXNoLm8sDQogICAgICAgICAgICAgICAgdXJsID0gdXJsSGVscGVyTW9kZWwuY3JlYXRlR2V0R2VvUG9pQ29udGVudFVybCh7IGVuZHBvaW50OiBwcm9wZXJ0aWVzLnZhcmlhbnRzRW5kcG9pbnQgfSwgcG9pSWQsIHBvaVZhcmlhbnRJZCwgbGF0aXR1ZGUgKyAiLCIgKyBsb25naXR1ZGUsIHVuaXRzLCBwcm9wZXJ0aWVzLml0ZW1JZCk7DQoNCiAgICAgICAgICAgIGFwaU1vZGVsLmdldERhdGEoew0KICAgICAgICAgICAgICAgIGNhbGxiYWNrOiByZW5kZXJQb2lDb250ZW50Q2FsbGJhY2ssDQogICAgICAgICAgICAgICAgdXJsOiB1cmwsDQogICAgICAgICAgICAgICAgZXhjbHVkZVNpdGVOYW1lOiB0cnVlDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICB9LA0KICAgICAgICBnZXRDZW50cmFsUG9pbnQ6IGZ1bmN0aW9uIChjYWxsYmFjaykgew0KICAgICAgICAgICAgdmFyIHByb3BlcnRpZXMgPSB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKSwNCiAgICAgICAgICAgICAgICB0aGF0ID0gdGhpczsNCg0KICAgICAgICAgICAgc3dpdGNoIChwcm9wZXJ0aWVzLmNlbnRyYWxQb2ludE1vZGUpIHsNCiAgICAgICAgICAgICAgICBjYXNlICJBdXRvIjogew0KICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcy5jZW50cmFsUG9pbnQgIT09ICIiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoYXQsIFtwcm9wZXJ0aWVzLmxhdGl0dWRlLCBwcm9wZXJ0aWVzLmxvbmdpdHVkZV0pOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByb3BlcnRpZXMucG9pcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoYXQsIFtwcm9wZXJ0aWVzLnBvaXNbMF0uTGF0aXR1ZGUsIHByb3BlcnRpZXMucG9pc1swXS5Mb25naXR1ZGVdKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q3VycmVudFBvc2l0aW9uKGNhbGxiYWNrKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSAiTWlkT2ZQb2kiOiB7DQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwodGhhdCwgdGhpcy5nZXRQb2lzQ2VudHJhbFBvaW50KCkpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSAiTG9jYXRpb24iOnsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDdXJyZW50UG9zaXRpb24oY2FsbGJhY2spOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGdldEN1cnJlbnRQb3NpdGlvbjogZnVuY3Rpb24gKGNhbGxiYWNrKSB7DQogICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOw0KICAgICAgICAgIFhBLmNvbXBvbmVudC5sb2NhdGlvblNlcnZpY2UuZGV0ZWN0TG9jYXRpb24oDQogICAgICAgICAgICAgIGZ1bmN0aW9uIChsb2NhdGlvbikgew0KICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGF0LCBsb2NhdGlvbiwgdGhhdCk7DQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvck1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwodGhhdCwgWzAsIDBdLCB0aGF0KTsNCiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yTWVzc2FnZSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICApOw0KICAgICAgICB9LA0KICAgICAgICBnZXRQb2lzQ2VudHJhbFBvaW50OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgaSwNCiAgICAgICAgICAgICAgICBwb2ksDQogICAgICAgICAgICAgICAgcG9pc0Nvb3JkcyA9IFtdLA0KICAgICAgICAgICAgICAgIG15TG9jYXRpb24gPSB0aGlzLm1vZGVsLmdldCgibXlMb2NhdGlvbiIpLA0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKSwNCiAgICAgICAgICAgICAgICBjb3VudCA9IHByb3BlcnRpZXMucG9pcy5sZW5ndGg7DQoNCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7DQogICAgICAgICAgICAgICAgcG9pID0gcHJvcGVydGllcy5wb2lzW2ldOw0KICAgICAgICAgICAgICAgIGlmIChwb2kuVGVtcGxhdGVJZC5HdWlkID09PSAiN2RkOWVjZTUtOTQ2MS00OThkLTg3MjEtN2NiZWE4MTExYjVlIikgew0KICAgICAgICAgICAgICAgICAgICBpZiAobXlMb2NhdGlvblswXSAhPT0gIiIgJiYgbXlMb2NhdGlvblsxXSAhPT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvaS5MYXRpdHVkZSA9IG15TG9jYXRpb25bMF07DQogICAgICAgICAgICAgICAgICAgICAgICBwb2kuTG9uZ2l0dWRlID0gbXlMb2NhdGlvblsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCJkYXRhUHJvcGVydGllcyIsIHByb3BlcnRpZXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcG9pc0Nvb3Jkcy5wdXNoKHtsYXRpdHVkZTogcG9pLkxhdGl0dWRlLCBsb25naXR1ZGU6IHBvaS5Mb25naXR1ZGV9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHBvaXNDb29yZHMucHVzaCh7bGF0aXR1ZGU6IHBvaS5MYXRpdHVkZSwgbG9uZ2l0dWRlOiBwb2kuTG9uZ2l0dWRlfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gbWFwc0Nvbm5lY3Rvci5nZXRDZW50cmFsUG9pbnQocG9pc0Nvb3Jkcyk7DQogICAgICAgIH0sDQogICAgICAgIGhhbmRsZUNlbnRlck1hcDogZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgICAgIHZhciBjZW50ZXJNYXAgPSB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKS5jZW50ZXJPbkZvdW5kUG9pID09PSAiMSIsDQogICAgICAgICAgICAgICAgYW5pbWF0ZSA9IHRoaXMubW9kZWwuZ2V0KCJkYXRhUHJvcGVydGllcyIpLmFuaW1hdGVGb3VuZFBvaSA9PT0gIjEiOw0KICAgICAgICAgICAgdGhpcy5jZW50ZXJPbk1hcChkYXRhLCBjZW50ZXJNYXAsIGFuaW1hdGUpOw0KICAgICAgICB9LA0KICAgICAgICBjZW50ZXJPbk1hcDogZnVuY3Rpb24gKGRhdGEsIGNlbnRlck1hcCwgYW5pbWF0ZSkgew0KICAgICAgICAgICAgaWYgKGRhdGEuc2lnID09PSB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKS5zZWFyY2hSZXN1bHRzU2lnbmF0dXJlKSB7DQogICAgICAgICAgICAgICAgbWFwc0Nvbm5lY3Rvci5jZW50ZXJNYXAodGhpcy5tb2RlbC5nZXQoImlkIiksIGRhdGEsIGNlbnRlck1hcCwgYW5pbWF0ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHVwZGF0ZU15TG9jYXRpb25Qb2k6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5tb2RlbC5nZXQoImRhdGFQcm9wZXJ0aWVzIiksDQogICAgICAgICAgICAgICAgbXlMb2NhdGlvbiA9IHRoaXMubW9kZWwuZ2V0KCJteUxvY2F0aW9uIik7DQoNCiAgICAgICAgICAgIC8vY2hlY2sgaWYgdGhlcmUgaXMgc29tZXRoaW5nIGluIG15IGxvY2F0aW9uDQogICAgICAgICAgICBpZiAobXlMb2NhdGlvblswXSAhPT0gIiIgJiYgbXlMb2NhdGlvblsxXSAhPT0gMCkgew0KICAgICAgICAgICAgICAgIC8vbXkgbG9jYXRpb24gd2FzIGNoYW5nZWQgc28gdXBkYXRlIHBvc2l0aW9uIG9mIE15IExvY2F0aW9uIG1hcmtlcg0KICAgICAgICAgICAgICAgIG1hcHNDb25uZWN0b3IudXBkYXRlTXlQb2lMb2NhdGlvbih0aGlzLm1vZGVsLmdldCgiaWQiKSwgbXlMb2NhdGlvbiwgdGhpcy5wYXJzZVpvb20ocHJvcGVydGllcy56b29tLCAxNSkpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0aWVzLmxhdGl0dWRlICE9PSAiIiAmJiBwcm9wZXJ0aWVzLmxvbmdpdHVkZSAhPT0gIiIpIHsNCiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHt9Ow0KICAgICAgICAgICAgICAgIGRhdGEuc2lnID0gcHJvcGVydGllcy5zZWFyY2hSZXN1bHRzU2lnbmF0dXJlOw0KICAgICAgICAgICAgICAgIGRhdGEuY29vcmRpbmF0ZXMgPSBbcHJvcGVydGllcy5sYXRpdHVkZSwgcHJvcGVydGllcy5sb25naXR1ZGVdOw0KICAgICAgICAgICAgICAgIHRoaXMuY2VudGVyT25NYXAoZGF0YSwgdHJ1ZSwgZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBwYXJzZVpvb206IGZ1bmN0aW9uIChzdHIsIGRlZmF1bHRWYWx1ZSkgew0KICAgICAgICAgICAgdmFyIHJldFZhbHVlID0gZGVmYXVsdFZhbHVlOw0KICAgICAgICAgICAgaWYoc3RyICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgaWYoc3RyLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05hTihzdHIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWx1ZSA9IHBhcnNlSW50KHN0cik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gcmV0VmFsdWU7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIGFwaS5pbml0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBpLA0KICAgICAgICAgICAgbWFwRWxlbWVudHMgPSAkKCIubWFwLmNvbXBvbmVudDpub3QoLmluaXRpYWxpemVkKSIpLA0KICAgICAgICAgICAgY291bnQgPSBtYXBFbGVtZW50cy5sZW5ndGg7DQoNCiAgICAgICAgaWYgKHR5cGVvZiAoWEEuY29tcG9uZW50LnNlYXJjaCkgIT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICBxdWVyeU1vZGVsID0gWEEuY29tcG9uZW50LnNlYXJjaC5xdWVyeTsNCiAgICAgICAgICAgIHVybEhlbHBlck1vZGVsID0gWEEuY29tcG9uZW50LnNlYXJjaC51cmw7DQogICAgICAgICAgICBhcGlNb2RlbCA9IFhBLmNvbXBvbmVudC5zZWFyY2guYWpheDsNCg0KICAgICAgICAgICAgLy9pZiB0aGUgcGFnZSB3YXMgcmVsb2FkZWQgdGhlcmUgY291bGQgYmUgc2l0dWF0aW9uIHRoYXQgc2VhcmNoIHJlc3VsdHMgd2lsbCBsb2FkIHJlc3VsdHMgZmFzdGVyIHRoZW4gbWFwIGluaXRpYWxpemF0aW9uDQogICAgICAgICAgICAvL3NvIHRoYXQgd2UgaGF2ZSB0byBzYXZlIHRoZW0gYW5kIHBhc3MgdG8gdGhlIG1vZGVscyB3aGVuIHRoZXkgd2lsbCBiZSBjcmVhdGVkDQogICAgICAgICAgICBYQS5jb21wb25lbnQuc2VhcmNoLnZlbnQub24oInJlc3VsdHMtbG9hZGVkIiwgcmVzdWx0c0xvYWRlZCk7DQogICAgICAgICAgICAvL3RoZSBzYW1lIHdpdGggIm15IGxvY2F0aW9uIiwgc29tZXRpbWVzIExvY2F0aW9uIEZpbHRlciBjb21wb25lbnQgY2FuIGNoYW5nZSBsb2NhdGlvbiBiZWZvcmUgbWFwIHdhcyBpbml0aWFsaXplZA0KICAgICAgICAgICAgWEEuY29tcG9uZW50LnNlYXJjaC52ZW50Lm9uKCJteS1sb2NhdGlvbi1jb29yZGluYXRlcy1jaGFuZ2VkIiwgbXlMb2NhdGlvbkNoYW5nZWQpOw0KICAgICAgICB9DQogICAgICAgIG1hcHNDb25uZWN0b3IgPSBYQS5jb25uZWN0b3IubWFwc0Nvbm5lY3RvcjsNCg0KICAgICAgICBpZiAoY291bnQgPiAwKSB7DQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgIHZhciAkbWFwID0gJChtYXBFbGVtZW50c1tpXSk7DQogICAgICAgICAgICAgICAgdmFyIHByb3BlcnRpZXMgPSAkbWFwLmRhdGEoInByb3BlcnRpZXMiKTsNCiAgICAgICAgICAgICAgICBrZXkgPSBwcm9wZXJ0aWVzLmtleTsNCiAgICAgICAgICAgICAgICBzZWFyY2hFbmRwb2ludCA9IHByb3BlcnRpZXMuZW5kcG9pbnQ7DQogICAgICAgICAgICAgICAgc2VhcmNoUmVzdWx0c1NpZ25hdHVyZXMucHVzaChwcm9wZXJ0aWVzLnNlYXJjaFJlc3VsdHNTaWduYXR1cmUpDQogICAgICAgICAgICAgICAgJG1hcC5hZGRDbGFzcygiaW5pdGlhbGl6ZWQiKTsNCiAgICAgICAgICAgICAgICBtYXBzLnB1c2goJG1hcCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICghc2NyaXB0c0xvYWRlZCkgew0KICAgICAgICAgICAgICAgIG1hcHNDb25uZWN0b3IubG9hZFNjcmlwdChrZXksIFhBLmNvbXBvbmVudC5tYXAuc2NyaXB0c0xvYWRlZCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGluaXRpYWxpemUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICBhcGkuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0c0xvYWRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBjb25zb2xlLmxvZygiTWFwcyBhcGkgbG9hZGVkIik7DQogICAgICAgIHNjcmlwdHNMb2FkZWQgPSB0cnVlOw0KICAgICAgICBpbml0aWFsaXplKCk7DQogICAgfTsNCg0KICAgIGFwaS5nZXRTZWFyY2hFbmRwb2ludCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gc2VhcmNoRW5kcG9pbnQ7DQogICAgfTsNCg0KICAgIGFwaS5nZXRTaWduYXR1cmVzID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBzZWFyY2hSZXN1bHRzU2lnbmF0dXJlczsNCiAgICB9DQoNCiAgICByZXR1cm4gYXBpOw0KDQp9KGpRdWVyeSwgZG9jdW1lbnQpKTsNCg0KWEEucmVnaXN0ZXIoIm1hcCIsIFhBLmNvbXBvbmVudC5tYXApOw0K
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 19638
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160517T105516Z
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "3b0b9987-17fa-47da-ab23-028b5f9a987d"
