---
ID: "99c67b35-5802-44ef-a959-2ed64c09ca10"
Parent: "02f3f9cf-6e2b-49c8-be56-9701c0316569"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Base Themes/Components Theme/Scripts/component-carousel"
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/99C67B35580244EFA9592ED64C09CA10.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "99c67b35-5802-44ef-a959-2ed64c09ca10"
  Value: LyoqCiAqIFhBQ29udGV4dAogKgogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4KICoKICogRXhwb3NlcyByZWdpc3RlciAoc2VsZWN0b3IsIG9wdGlvbnMpIG1ldGhvZCB0aGF0IGluaXRpYWxpemVzIENhcm91c2VsCiAqIGZvciBlYWNoIGVsZW1lbnQgdGhhdCBtYXRjaGVzIHRoZSBwcm92aWRlZCBzZWxlY3Rvciwgd2l0aCBpdHMgZ2l2ZW4gb3B0aW9ucy4KICogRWxlbWVudCB1c2VkIGFzIGEgY2Fyb3VzZWwgbXVzdCBjb250YWluIGEgPHVsIGNsYXNzPSJzbGlkZXMiPiB0YWcuCiAqIFRoYXQgdGFnIG11c3QgYmUgZmlsbGVkIHdpdGggPGxpPiBlbGVtZW50cy4gRWFjaCA8bGk+IGVsZW1lbnQgd2lsbCBiZSBjb25zaWRlcmVkIGFzIGEgc2xpZGUuCiAqIEZvciBtb3JlIGRldGFpbHMgcmVhZCB0aGUgZG9jdW1lbnRhdGlvbiBvZiB0aGUgcmVnaXN0ZXIoc2VsZWN0b3IsIG9wdGlvbnMpIG1ldGhvZC4KICoKICogQHJlcXVpcmVzIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjEuNC40IG9yIGhpZ2hlcgogKi8KLyogZ2xvYmFsIEhhbW1lcjp0cnVlICovClhBLmNvbXBvbmVudC5jYXJvdXNlbHMgPSAoZnVuY3Rpb24gKCQpIHsKICB2YXIgcHViID0ge30sCiAgICBOYXZpZ2F0aW9uQnVpbGRlciA9IG51bGwsCiAgICBTbGlkZXJJbml0aWFsaXplciA9IG51bGw7CgogIC8qKgogICAqIFRpbWVyIGNsYXNzIHNhdmVzIHRpbWUgc3RhbXAgYW5kIGNvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbgogICAqIGN1cnJlbnQgdGltZSAodXBkYXRlKCkgbWV0aG9kKSBhbmQgc2F2ZWQgdGltZSBzdGFtcC4KICAgKiBAY29uc3RydWN0b3IKICAgKi8KICBmdW5jdGlvbiBUaW1lcigpIHsKICAgIC8qKgogICAgICogVGltZSBkaWZmZXJlbmNlIGJldHdlZW4gbGFzdCB1cGRhdGUoKSBjYWxsIGFuZCBsYXN0IHNldCgpIGNhbGwKICAgICAqCiAgICAgKiBAbWVtYmVyIFRpbWVyCiAgICAgKi8KICAgIHRoaXMuZWxhcHNlZCA9IDA7CiAgICAvKioKICAgICAqIFRpbWUgc3RhbXAKICAgICAqCiAgICAgKiBAbWVtYmVyIFRpbWVyCiAgICAgKi8KICAgIHRoaXMuc3RhbXAgPSBudWxsOwogIH0KCiAgLyoqCiAgICogIENvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRpbWUgYW5kIHNhdmVkIHRpbWUgc3RhbXAKICAgKgogICAqIEBtZW1iZXIgVGltZXIKICAgKi8KICBUaW1lci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuc3RhbXAgIT09IG51bGwpIHsKICAgICAgdGhpcy5lbGFwc2VkICs9IHRoaXMubmV3U3RhbXAoKSAtIHRoaXMuc3RhbXA7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogIFNhdmVzIG5ldyB0aW1lIHN0YW1wCiAgICoKICAgKiBAbWVtYmVyIFRpbWVyCiAgICovCiAgVGltZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuc3RhbXAgPSB0aGlzLm5ld1N0YW1wKCk7CiAgfTsKCiAgLyoqCiAgICogIENvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRpbWUgYW5kIHNhdmVkIHRpbWUgc3RhbXAKICAgKgogICAqIEBtZW1iZXIgVGltZXIKICAgKiBAcmV0dXJuIHN0YW1wIG9mIGEgY3VycmVudCB0aW1lCiAgICogQHR5cGUgTnVtYmVyCiAgICovCiAgVGltZXIucHJvdG90eXBlLm5ld1N0YW1wID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIG5ldyBEYXRlKCkudmFsdWVPZigpOwogIH07CgogIC8qKgogICAqICBSZXNldHMgZWxhcHNlZCB0aW1lLgogICAqCiAgICogQG1lbWJlciBUaW1lcgogICAqLwogIFRpbWVyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWxhcHNlZCA9IDA7CiAgfTsKICAvKioKICAgKiBFbmQgb2YgVGltZXIgY2xhc3MKICAgKi8KCiAgLyoqCiAgICogVGltZUluZGljYXRvciBjbGFzcyBleHRlbmRzIFRpbWVyIGNsYXNzCiAgICogQGNvbnN0cnVjdG9yCiAgICogQHBhcmFtIHtPYmplY3R9ICQgICAgIGEgalF1ZXJ5IG9iamVjdAogICAqIEBwYXJhbSB7WEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3fSB2aWV3ICBhIHRpbWUgaW5kaWNhdG9yIHZpZXcuCiAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgICBhIHZpZXcgdGltZW91dAogICAqIEBiYXNlIFRpbWVyCiAgICovCiAgZnVuY3Rpb24gVGltZUluZGljYXRvcigkLCB2aWV3LCB0aW1lb3V0KSB7CiAgICAvKioKICAgICAqIEEgdGltZSBpbmRpY2F0b3Igdmlldy4KICAgICAqCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yCiAgICAgKi8KICAgIHRoaXMudmlldyA9IHZpZXc7CgogICAgdGhpcy52aWV3LmluaXQodGltZW91dCk7CiAgfQogIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlID0gbmV3IFRpbWVyKCk7CiAgVGltZUluZGljYXRvci5jb25zdHJ1Y3RvciA9IFRpbWVyOwoKICAvKioKICAgKiBQbGF5cyB0aGUgYXR0YWNoZWQgdmlldy4KICAgKgogICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3IKICAgKi8KICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy52aWV3LnBsYXkoKTsKICB9OwoKICAvKioKICAgKiBQYXVzZXMgdGhlIGF0dGFjaGVkIHZpZXcuCiAgICoKICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yCiAgICovCiAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnZpZXcucGF1c2UoKTsKICB9OwoKICAvKioKICAgKiBSZXNldHMgZWxhcHNlZCB0aW1lIGFuZCByZXNldHMgdGhlIGF0dGFjaGVkIHZpZXcuCiAgICoKICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yCiAgICovCiAgVGltZUluZGljYXRvci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7CiAgICBUaW1lci5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsKICAgIHRoaXMudmlldy5yZXNldCgpOwogIH07CgogIC8qKgogICAqIENvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRpbWUgYW5kIHNhdmVkIHRpbWUgc3RhbXAKICAgKiBhbmQgdXBkYXRlcyB0aGUgYXR0YWNoZWQgdmlldwogICAqCiAgICogQG1lbWJlciBUaW1lckluZGljYXRvcgogICAqLwogIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgIFRpbWVyLnByb3RvdHlwZS51cGRhdGUuY2FsbCh0aGlzKTsKICAgIHRoaXMudmlldy51cGRhdGUodGhpcy5lbGFwc2VkKTsKICB9OwogIC8qKgogICAqIGVuZCBvZiBUaW1lSW5kaWNhdG9yIGNsYXNzCiAgICovCgogIC8qKgogICAqIE5hdmlnYXRpb25CdWlsZGVyIG9iamVjdCBjcmVhdGVzIG5hdmlnYXRpb24gaXRlbXMKICAgKi8KICBOYXZpZ2F0aW9uQnVpbGRlciA9IChmdW5jdGlvbiAoJCkgewogICAgZnVuY3Rpb24gY3JlYXRlSXRlbShzZXR0aW5ncykgewogICAgICB2YXIgdGV4dCA9IHNldHRpbmdzLnRleHQsCiAgICAgICAgJG5hdkl0ZW0gPSBudWxsOwoKICAgICAgc2V0dGluZ3MudGV4dCA9ICIiOwogICAgICBzZXR0aW5ncy5ocmVmID0gIiMiOwoKICAgICAgJG5hdkl0ZW0gPSAkKCI8YT4iLCBzZXR0aW5ncyk7CiAgICAgICQoIjxzcGFuPiIsIHsKICAgICAgICB0ZXh0OiB0ZXh0LAogICAgICB9KS5hcHBlbmRUbygkbmF2SXRlbSk7CgogICAgICByZXR1cm4gJG5hdkl0ZW07CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgLyoqCiAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQocykgdGhhdCBtYXRjaCB0aGUgcHJvdmlkZWQgc2VsZWN0b3Igb3IgbnVsbAogICAgICAgKgogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcKICAgICAgICogQHJldHVybiBhIGpRdWVyeSBvYmplY3QgY29udGFpbmluZyBlbGVtZW50KHMpIHRoYXQgbWF0Y2ggdGhlIHByb3ZpZGVkIHNlbGVjdG9yIG9yIG51bGwgaWYgdGhlcmUgaXMgbm8gZWxlbWVudCBtYXRjaAogICAgICAgKiBAdHlwZSBPYmplY3QKICAgICAgICovCiAgICAgIGdldEVsZW1lbnQ6IGZ1bmN0aW9uIChzZWxlY3RvcikgewogICAgICAgIHZhciAkZWxlbWVudCA9ICQoc2VsZWN0b3IpOwoKICAgICAgICBpZiAoJGVsZW1lbnQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAkZWxlbWVudCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGVsZW1lbnQ7CiAgICAgIH0sCiAgICAgIC8qKgogICAgICAgKiBDcmVhdGVzIG5hdmlnYXRpb24gaXRlbXMgYW5kIGFwcGVuZHMgdGhlbSB0byAkY29udGFpbmVyLgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gJGNvbnRhaW5lciAgIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIChqUXVlcnkgb2JqZWN0KQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbGFiZWwgICBuYXZpZ2F0aW9uIGl0ZW1zIGxhYmVsIHRlbXBsYXRlCiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCAgICBudW1iZXIgb2YgbmF2aWdhdGlvbiBpdGVtcyB0byBjcmVhdGUKICAgICAgICovCiAgICAgIGNyZWF0ZUl0ZW1zOiBmdW5jdGlvbiAoJGNvbnRhaW5lciwgbGFiZWwsIGNvdW50KSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICBwYXR0ZXJuID0gLyNce2luZGV4XH0vZywKICAgICAgICAgIHNldHRpbmdzOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgc2V0dGluZ3MgPSB7CiAgICAgICAgICAgIHRleHQ6IGxhYmVsLnJlcGxhY2UocGF0dGVybiwgaSArIDEpLAogICAgICAgICAgfTsKICAgICAgICAgIGNyZWF0ZUl0ZW0oc2V0dGluZ3MpLmFwcGVuZFRvKCRjb250YWluZXIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgLyoqCiAgICAgICAqIENyZWF0ZXMgb3Igc2VsZWN0cyAncHJldmlvdXMnLyduZXh0JyBuYXZpZ2F0aW9uIGl0ZW0uCiAgICAgICAqIE1vZGUgb2YgYWN0aW9uIGRlcGVuZHMgb24gc2V0dGluZ3Mgb2JqZWN0OgogICAgICAgKiB2YXIgc2V0dGluZ3MgPSB7CiAgICAgICAqICAgICBpc0NvbnRhaW5lcjogQm9vbGVhbiB2YWx1ZSwKICAgICAgICogICAgIGxhYmVsOiBTdHJpbmcgdmFsdWUsCiAgICAgICAqICAgICBzZWxlY3RvcjogU3RyaW5nIHZhbHVlLAogICAgICAgKiAgICAgbWV0aG9kOiBTdHJpbmcgdmFsdWUKICAgICAgICogfTsKICAgICAgICoKICAgICAgICogSWYgc2V0dGluZ3Muc2VsZWN0b3IgPT09IG51bGwgb3IgaWYgc2V0dGluZ3Muc2VsZWN0b3IgIT09IG51bGwgYW5kIHNldHRpbmdzLmlzQ29udGFpbmVyID09IHRydWUKICAgICAgICogbmF2aWdhdGlvbiBpdGVtIGlzIGNyZWF0ZWQgYW5kIGF0dGFjaGVkIHRvICRlbGVtZW50LmZpcnN0KCkgKHVzaW5nIHNldHRpbmdzLm1ldGhvZCkuCiAgICAgICAqIElmIHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsIGFuZCBzZXR0aW5ncy5pc0NvbnRhaW5lciA9PSBmYWxzZQogICAgICAgKiAkZWxlbWVudC5maXJzdCgpIGlzIHNlbGVjdGVkIGFzIG5hdmlnYXRpb24gaXRlbQogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3Mgc2V0dGluZ3Mgb2YgbmF2aWdhdGlvbiBpdGVtCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtU2V0dGluZ3MgICBodG1sIGF0dHJpYnV0ZXMgb2YgbmF2aWdhdGlvbiBpdGVtCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkZWxlbWVudCAgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkKICAgICAgICogQHJldHVybiBUaGUgJ3ByZXYnLyduZXh0JyBuYXZpZ2F0aW9uIGl0ZW0KICAgICAgICogQHR5cGUgT2JqZWN0CiAgICAgICAqLwogICAgICBjcmVhdGVQcmV2TmV4dEl0ZW06IGZ1bmN0aW9uIChzZXR0aW5ncywgaXRlbVNldHRpbmdzLCAkZWxlbWVudCkgewogICAgICAgIHZhciAkaXRlbSA9IG51bGwsCiAgICAgICAgICBpc1NlbGVjdG9yRXhpc3RzID0gc2V0dGluZ3Muc2VsZWN0b3IgIT09IG51bGw7CgogICAgICAgIGlmIChpc1NlbGVjdG9yRXhpc3RzKSB7CiAgICAgICAgICAkZWxlbWVudCA9IHRoaXMuZ2V0RWxlbWVudChzZXR0aW5ncy5zZWxlY3Rvcik7CiAgICAgICAgfQoKICAgICAgICBpZiAoJGVsZW1lbnQgIT09IG51bGwpIHsKICAgICAgICAgIGlmIChzZXR0aW5ncy5pc0NvbnRhaW5lciB8fCAhaXNTZWxlY3RvckV4aXN0cykgewogICAgICAgICAgICAkaXRlbSA9IGNyZWF0ZUl0ZW0oCiAgICAgICAgICAgICAgJC5leHRlbmQoCiAgICAgICAgICAgICAgICB7fSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgdGV4dDogc2V0dGluZ3MubGFiZWwsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXRlbVNldHRpbmdzCiAgICAgICAgICAgICAgKQogICAgICAgICAgICApOwogICAgICAgICAgICAkZWxlbWVudC5maXJzdCgpW3NldHRpbmdzLm1ldGhvZF0oJGl0ZW0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGl0ZW0gPSAkZWxlbWVudC5maXJzdCgpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRpdGVtOwogICAgICB9LAogICAgfTsKICB9KSgkKTsKICAvKioKICAgKiBlbmQgb2YgTmF2aWdhdGlvbkJ1aWxkZXIgb2JqZWN0CiAgICovCgogIC8qKgogICAqIE5hdmlnYXRpb24gY2xhc3MgdGhhdCBjb250YWlucyBuYXZpZ2F0aW9uIGl0ZW1zLgogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIE5hdmlnYXRpb24oJCwgJHdyYXBwZXIsIG9wdGlvbnMpIHsKICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgICBpc0VuYWJsZWQ6IHRydWUsCiAgICAgICAgaGFzUHJldk5leHRJdGVtczogdHJ1ZSwKICAgICAgICBpdGVtOiB7CiAgICAgICAgICBsYWJlbDogIiN7aW5kZXh9IiwKICAgICAgICAgIHNlbGVjdG9yOiBudWxsLAogICAgICAgIH0sCiAgICAgICAgcHJldkl0ZW06IHsKICAgICAgICAgIGxhYmVsOiAiPCIsCiAgICAgICAgICBzZWxlY3RvcjogbnVsbCwKICAgICAgICAgIGlzQ29udGFpbmVyOiBmYWxzZSwKICAgICAgICB9LAogICAgICAgIG5leHRJdGVtOiB7CiAgICAgICAgICBsYWJlbDogIj4iLAogICAgICAgICAgc2VsZWN0b3I6IG51bGwsCiAgICAgICAgICBpc0NvbnRhaW5lcjogZmFsc2UsCiAgICAgICAgfSwKICAgICAgICBzbGlkZXNDb3VudDogMCwKICAgICAgfSwKICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOwoKICAgIC8qKgogICAgICogalF1ZXJ5IG9iamVjdAogICAgICoKICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbgogICAgICovCiAgICB0aGlzLiQgPSAkOwogICAgLyoqCiAgICAgKiBOYXZpZ2F0aW9uIGl0ZW1zIChvbmUgZm9yIGVhY2ggc2xpZGUgaWYgbmF2aWdhdGlvbiBpcyBlbmFibGVkKS4KICAgICAqCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24KICAgICAqLwogICAgdGhpcy4kaXRlbXMgPSAkKCk7CiAgICAvKioKICAgICAqIE5hdmlnYXRpb24gJ25leHQnIGl0ZW0gKGlmIHByZXYvbmV4dCBpdGVtcyBhcmUgZW5hYmxlZCkuCiAgICAgKgogICAgICogQG1lbWJlciBOYXZpZ2F0aW9uCiAgICAgKi8KICAgIHRoaXMuJG5leHRJdGVtID0gJCgpOwogICAgLyoqCiAgICAgKiBOYXZpZ2F0aW9uICdwcmV2aW91cycgaXRlbSAoaWYgcHJldi9uZXh0IGl0ZW1zIGFyZSBlbmFibGVkKS4KICAgICAqCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24KICAgICAqLwogICAgdGhpcy4kcHJldkl0ZW0gPSAkKCk7CiAgICAvKioKICAgICAqIFNlbGVjdGVkIGl0ZW0gKG9uZSBmcm9tIHRoaXMuJGl0ZW1zIG9yIG51bGwpLgogICAgICoKICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbgogICAgICovCiAgICB0aGlzLiRzZWxlY3RlZEl0ZW0gPSBudWxsOwoKICAgIC8vaW5pdGlhbGl6YXRpb24KICAgIGlmIChzZXR0aW5ncy5pc0VuYWJsZWQpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBzZWxmLnByZXBhcmVJdGVtcyhzZXR0aW5ncy5pdGVtLCBzZXR0aW5ncy5zbGlkZXNDb3VudCwgJHdyYXBwZXIpOwogICAgICAgIC8vc2VsZWN0IGZpcnN0IGl0ZW0gb24gaW5pdAogICAgICAgIHNlbGYuc2VsZWN0SXRlbSgwKTsKICAgICAgfSwgMTAwMCk7CgogICAgICAkd3JhcHBlci5maW5kKCIubmF2IikudHJpZ2dlcigibmF2aWdhdGlvbi1jcmVhdGVkIiwgdGhpcyk7CiAgICB9CiAgfQoKICAvKioKICAgKiBDU1MgY2xhc3MgdXNlZCB0byBtYXJrIHNlbGVjdGVkIGl0ZW0uCiAgICoKICAgKiBAbWVtYmVyIE5hdmlnYXRpb24KICAgKi8KICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5zZWxlY3RlZEl0ZW1DbGFzcyA9ICJhY3RpdmUiOwoKICAvKioKICAgKiBNYXJrIG5hdmlnYXRpb24gaXRlbSB3aXRoIGdpdmVuIGluZGV4IGFzIHNlbGVjdGVkLgogICAqCiAgICogQG1lbWJlciBOYXZpZ2F0aW9uCiAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4ICAgICBpbmRleCBvZiBuYXZpZ2F0aW9uIGl0ZW0KICAgKi8KICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5zZWxlY3RJdGVtID0gZnVuY3Rpb24gKGluZGV4KSB7CiAgICBpZiAodGhpcy4kc2VsZWN0ZWRJdGVtICE9PSBudWxsKSB7CiAgICAgIHRoaXMuJHNlbGVjdGVkSXRlbS5yZW1vdmVDbGFzcyh0aGlzLnNlbGVjdGVkSXRlbUNsYXNzKTsKICAgIH0KICAgIHRoaXMuJHNlbGVjdGVkSXRlbSA9IHRoaXMuJGl0ZW1zLmVxKGluZGV4KS5hZGRDbGFzcyh0aGlzLnNlbGVjdGVkSXRlbUNsYXNzKTsKICB9OwoKICAvKioKICAgKiBDcmVhdGVzIG9yIHNlbGVjdHMgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgYW5kIGZpbGxzIGl0IHdpdGggbmF2aWdhdGlvbiBpdGVtcy4KICAgKiBJZiBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciBpcyBub3QgZW1wdHksIGNoaWxkIGVsZW1lbnRzIGFyZSBhZG9wdGVkIGFzIG5hdmlnYXRpb24gaXRlbXMuCiAgICogTW9kZSBvZiBhY3Rpb24gZGVwZW5kcyBvbiBzZXR0aW5ncyBvYmplY3Q6CiAgICogdmFyIHNldHRpbmdzID0gewogICAqICAgICAnbGFiZWwnOiAnI3tpbmRleH0nLAogICAqICAgICAnc2VsZWN0b3InOiBudWxsCiAgICogfTsKICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciA9PT0gbnVsbCBuYXZpZ2F0aW9uIGl0ZW0gY29udGFpbmVyIGlzIGNyZWF0ZWQuCiAgICogSWYgc2V0dGluZ3Muc2VsZWN0b3IgIT09IG51bGwgZWxlbWVudCB0aGF0IG1hdGNoIHNldHRpbmdzLnNlbGVjdG9yIGlzIGFkYXB0ZWQgYXMgbmF2aWdhZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lci4KICAgKgogICAqIEBtZW1iZXIgTmF2aWdhdGlvbgogICAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBzZXR0aW5ncyBvZiBuYXZpZ2F0aW9uIGl0ZW1zCiAgICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50ICAgbnVtYmVyIG9mIG5hdmlnYXRpb24gaXRlbXMKICAgKiBAcGFyYW0ge09iamVjdH0gJHdyYXBwZXIgICAgd3JhcHBlciBvZiBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkKICAgKiBAcmV0dXJuIFRoZSBjb250YWluZXIgZmlsbGVkIHdpdGggbmF2aWdhdGlvbiBpdGVtcy4KICAgKiBAdHlwZSBPYmplY3QKICAgKi8KICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5wcmVwYXJlSXRlbXMgPSBmdW5jdGlvbiAoc2V0dGluZ3MsIGNvdW50LCAkd3JhcHBlcikgewogICAgdmFyICRjb250YWluZXIgPSBudWxsOwoKICAgIGlmIChzZXR0aW5ncy5zZWxlY3RvcikgewogICAgICAkY29udGFpbmVyID0gTmF2aWdhdGlvbkJ1aWxkZXIuZ2V0RWxlbWVudChzZXR0aW5ncy5zZWxlY3Rvcik7CiAgICB9IGVsc2UgewogICAgICAkY29udGFpbmVyID0gJCgiPGRpdi8+IiwgewogICAgICAgIGNsYXNzOiAibmF2IiwKICAgICAgfSk7CiAgICAgICRjb250YWluZXIuYXBwZW5kVG8oJHdyYXBwZXIpOwogICAgfQoKICAgIGlmICgkY29udGFpbmVyKSB7CiAgICAgIGlmICgkY29udGFpbmVyLmNoaWxkcmVuKCkubGVuZ3RoID09PSAwKSB7CiAgICAgICAgTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlSXRlbXMoJGNvbnRhaW5lciwgc2V0dGluZ3MubGFiZWwsIGNvdW50KTsKICAgICAgfQoKICAgICAgdGhpcy4kaXRlbXMgPSAkY29udGFpbmVyLmNoaWxkcmVuKCkuc2xpY2UoMCwgY291bnQpOwogICAgfQoKICAgIHJldHVybiAkY29udGFpbmVyOwogIH07CgogIC8qKgogICAqIENyZWF0ZXMgb3Igc2VsZWN0cyBuYXZpZ2F0aW9uICdwcmV2aW91cycgYW5kICduZXh0JyBuYXZpZ2F0aW9uIGl0ZW1zIChAc2VlIE5hdmlnYXRpb25CdWlsZGVyLmNyZWF0ZVByZXZOZXh0SXRlbSgpKS4KICAgKiBJZiBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciBpcyBub3QgZW1wdHksIGNoaWxkIGVsZW1lbnRzIGFyZSBhZG9wdGVkIGFzIG5hdmlnYXRpb24gaXRlbXMuCiAgICoKICAgKiBAbWVtYmVyIE5hdmlnYXRpb24KICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3Mgc2V0dGluZ3Mgb2YgbmF2aWdhdGlvbgogICAqIEBwYXJhbSB7T2JqZWN0fSAkY29udGFpbmVyICAgIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIChqUXVlcnkgb2JqZWN0KQogICAqLwogIE5hdmlnYXRpb24ucHJvdG90eXBlLnByZXBhcmVQcmV2TmV4dEl0ZW1zID0gZnVuY3Rpb24gKHNldHRpbmdzLCAkY29udGFpbmVyKSB7CiAgICB2YXIgJGl0ZW07CgogICAgc2V0dGluZ3MucHJldkl0ZW0ubWV0aG9kID0gInByZXBlbmQiOwogICAgJGl0ZW0gPSBOYXZpZ2F0aW9uQnVpbGRlci5jcmVhdGVQcmV2TmV4dEl0ZW0oCiAgICAgIHNldHRpbmdzLnByZXZJdGVtLAogICAgICB7CiAgICAgICAgY2xhc3M6ICJwcmV2IiwKICAgICAgfSwKICAgICAgJGNvbnRhaW5lcgogICAgKTsKICAgIHRoaXMuJHByZXZJdGVtID0gJGl0ZW0gPT09IG51bGwgPyB0aGlzLiRwcmV2SXRlbSA6ICRpdGVtOwoKICAgIHNldHRpbmdzLm5leHRJdGVtLm1ldGhvZCA9ICJhcHBlbmQiOwogICAgJGl0ZW0gPSBOYXZpZ2F0aW9uQnVpbGRlci5jcmVhdGVQcmV2TmV4dEl0ZW0oCiAgICAgIHNldHRpbmdzLm5leHRJdGVtLAogICAgICB7CiAgICAgICAgY2xhc3M6ICJuZXh0IiwKICAgICAgfSwKICAgICAgJGNvbnRhaW5lcgogICAgKTsKICAgIHRoaXMuJG5leHRJdGVtID0gJGl0ZW0gPT09IG51bGwgPyB0aGlzLiRuZXh0SXRlbSA6ICRpdGVtOwogIH07CiAgLyoqCiAgICogZW5kIG9mIE5hdmlnYXRpb24gY2xhc3MKICAgKi8KCiAgLyoqCiAgICogY2xhc3MgU3dpcGVyIHlvdSBjYW4gZGVmaW5lIGhvcml6b250YWwgc3dpcGUgZm9yIGNob3NpbmcgZWxlbWVudCBhbmQgc2V0IGJlaGF2aW9yIG9mIHN3aXBlKGxlZnQvcmlnaHQpLgogICAqIFlvdSBjYW4gZXh0ZW5kIHRoaXMgY2xhc3Mgd2l0aCB2ZXJ0aWNhbCBzd2lwZSBpZiBpdCBuZWVkcwogICAqIEBwYXJhbSB0YXJnZXQgRWxlbWVudCBvciBxdWVyeSBvZiBxdWVyeVNlbGVjdG9yCiAgICovCiAgZnVuY3Rpb24gU3dpcGVyKHRhcmdldCkgewogICAgbGV0IHRvdWNoU3RhcnRYID0gMCwKICAgICAgdG91Y2hTdGFydFkgPSAwLAogICAgICB0b3VjaEVuZFggPSAwLAogICAgICB0b3VjaEVuZFkgPSAwLAogICAgICB0aHJlc2hvbGQgPSA1MDsKCiAgICBsZXQgb25Td2lwZUxlZnRBZ2VudCA9IG51bGwsCiAgICAgIG9uU3dpcGVSaWdodEFnZW50ID0gbnVsbCwKICAgICAgZWxlbWVudCA9IG51bGw7CgogICAgZWxlbWVudCA9CiAgICAgIHRhcmdldCBpbnN0YW5jZW9mIEV2ZW50VGFyZ2V0ID8gdGFyZ2V0IDogZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0YXJnZXQpOwoKICAgIG9uVG91Y2hTdGFydCA9IChldmVudCkgPT4gewogICAgICB0b3VjaFN0YXJ0WCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnNjcmVlblg7CiAgICAgIHRvdWNoU3RhcnRZID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uc2NyZWVuWTsKICAgIH07CgogICAgb25Ub3VjaEVuZCA9IChldmVudCkgPT4gewogICAgICB0b3VjaEVuZFggPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5zY3JlZW5YOwogICAgICB0b3VjaEVuZFkgPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5zY3JlZW5ZOwogICAgICBoYW5kbGVHZXN0dXJlKGV2ZW50KTsKICAgIH07CgogICAgb25Nb3VzZURvd24gPSAoZXZlbnQpID0+IHsKICAgICAgdG91Y2hTdGFydFggPSBldmVudC5zY3JlZW5YOwogICAgICB0b3VjaFN0YXJ0WSA9IGV2ZW50LnNjcmVlblk7CiAgICB9OwoKICAgIG9uTW91c2VVcCA9IChldmVudCkgPT4gewogICAgICB0b3VjaEVuZFggPSBldmVudC5zY3JlZW5YOwogICAgICB0b3VjaEVuZFkgPSBldmVudC5zY3JlZW5ZOwogICAgICBoYW5kbGVHZXN0dXJlKGV2ZW50KTsKICAgIH07CgogICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaHN0YXJ0Iiwgb25Ub3VjaFN0YXJ0LCBmYWxzZSk7CgogICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaGVuZCIsIG9uVG91Y2hFbmQsIGZhbHNlKTsKCiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIG9uTW91c2VEb3duLCBmYWxzZSk7CgogICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwgb25Nb3VzZVVwLCBmYWxzZSk7CgogICAgLyoqCiAgICAgKiBtZXRob2Qgd2hpY2ggZGVmaW5lcyBzd2lwZSBsZWZ0CiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgZnVuYwogICAgICovCiAgICB0aGlzLm9uU3dpcGVMZWZ0ID0gKGNhbGxiYWNrKSA9PiB7CiAgICAgIG9uU3dpcGVMZWZ0QWdlbnQgPSAoZXZlbnQpID0+IGNhbGxiYWNrLmNhbGwodGhpcywgZXZlbnQpOwogICAgfTsKCiAgICAvKioKICAgICAqIG1ldGhvZCB3aGljaCBkZWZpbmVzIHN3aXBlIHJpZ2h0CiAgICAgKiBAcGFyYW0gY2FsbGJhY2sKICAgICAqLwogICAgdGhpcy5vblN3aXBlUmlnaHQgPSAoY2FsbGJhY2spID0+IHsKICAgICAgb25Td2lwZVJpZ2h0QWdlbnQgPSAoZXZlbnQpID0+IGNhbGxiYWNrLmNhbGwodGhpcywgZXZlbnQpOwogICAgfTsKCiAgICB0aGlzLmRlc3Ryb3kgPSAoKSA9PiB7CiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigidG91Y2hzdGFydCIsIG9uVG91Y2hTdGFydCk7CiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigidG91Y2hlbmQiLCBvblRvdWNoRW5kKTsKICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCBvbk1vdXNlRG93bik7CiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2V1cCIsIG9uTW91c2VVcCk7CiAgICB9OwoKICAgIGZ1bmN0aW9uIGhhbmRsZUdlc3R1cmUoZXZlbnQpIHsKICAgICAgLyoqCiAgICAgICAqIHN3aXBlZCBsZWZ0CiAgICAgICAqLwogICAgICBpZiAodG91Y2hFbmRYICsgdGhyZXNob2xkIDw9IHRvdWNoU3RhcnRYKSB7CiAgICAgICAgb25Td2lwZUxlZnRBZ2VudCAmJiBvblN3aXBlTGVmdEFnZW50KGV2ZW50KTsKICAgICAgfQoKICAgICAgLyoqCiAgICAgICAqIHN3aXBlZCByaWdodAogICAgICAgKi8KICAgICAgaWYgKHRvdWNoRW5kWCAtIHRocmVzaG9sZCA+PSB0b3VjaFN0YXJ0WCkgewogICAgICAgIG9uU3dpcGVSaWdodEFnZW50ICYmIG9uU3dpcGVSaWdodEFnZW50KGV2ZW50KTsKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogU2xpZGVyQ29udGV4dCBjbGFzcyBpcyBiaW5kZWQgdG8gYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UKICAgKiBhbmQgY29udGFpbnMgaXRzIHByb3BlcnRpZXMuCiAgICogQGNvbnN0cnVjdG9yCiAgICovCiAgZnVuY3Rpb24gU2xpZGVyQ29udGV4dCgpIHsKICAgIC8qKgogICAgICogRmxhZyB0aGF0IGRldGVybWluZXMgaWYgc2xpZGUgY2FuIG9yIGNhbm5vdCBiZSBjaGFuZ2VkIChmb3IgdXNlciByZXF1ZXN0KQogICAgICoKICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dAogICAgICovCiAgICB0aGlzLmNhbkNoYW5nZVNsaWRlID0gdHJ1ZTsKICAgIC8qKgogICAgICogRGVmYXVsdCBTbGlkZXIgc2V0dGluZyBvYmplY3QgKEBzZWUgU2xpZGVyKQogICAgICoKICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dAogICAgICovCiAgICB0aGlzLmRlZmF1bHRzID0gbnVsbDsKICAgIC8qKgogICAgICogTmF2aWdhdGlvbiBvYmplY3QgKEBzZWUgTmF2aWdhdGlvbikKICAgICAqCiAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQKICAgICAqLwogICAgdGhpcy5uYXZpZ2F0aW9uID0gbnVsbDsKICAgIC8qKgogICAgICogU2xpZGVyIG9iamVjdCB0aGF0IHRoaXMgY29udGV4dCBpcyBhdHRhY2hlZCB0by4KICAgICAqCiAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQKICAgICAqLwogICAgdGhpcy5vd25lciA9IG51bGw7CiAgICAvKioKICAgICAqIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIGNoYW5nZSBvZiBhIHNsaWRlIGNhbiBvciBjYW4gbm90IGJlIHNjaGVkdWxlZC4KICAgICAqCiAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQKICAgICAqLwogICAgdGhpcy5wcmV2ZW50U2NoZWR1bGluZyA9IGZhbHNlOwogICAgLyoqCiAgICAgKiBTbGlkZXIgc2V0dGluZyBvYmplY3QKICAgICAqCiAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQKICAgICAqLwogICAgdGhpcy5zZXR0aW5ncyA9IG51bGw7CiAgICAvKioKICAgICAqIEluc3RhbmNlIG9mIFRpbWVyIGNsYXNzIChAc2VlIFRpbWVyKSB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgaG93IG11Y2gKICAgICAqIHRpbWUgaXMgbGVmdCB0byBjaGFuZ2UgdGhlIHNsaWRlLgogICAgICoKICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dAogICAgICovCiAgICB0aGlzLnNsaWRlVGltZXIgPSBuZXcgVGltZXIoKTsKICAgIC8qKgogICAgICogSW5zdGFuY2Ugb2YgVGltZUluZGljYXRvciBjbGFzcyAoQHNlZSBUaW1lSW5kaWNhdG9yKQogICAgICoKICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dAogICAgICovCiAgICB0aGlzLnRpbWVJbmRpY2F0b3IgPSBudWxsOwogICAgLyoqCiAgICAgKiBUaW1lcnMgYXJyYXkuCiAgICAgKgogICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0CiAgICAgKi8KICAgIHRoaXMudGltZXJzID0gW107CiAgICAvKioKICAgICAqIExhc3QgdGltZW91dCBpZGVudGlmaWVyLgogICAgICoKICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dAogICAgICovCiAgICB0aGlzLnRpbWVvdXRJZCA9IG51bGw7CiAgICAvKioKICAgICAqIFRyYW5zaXRpb24gKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uKSB1c2VkIHdoaWxlIGNoYW5naW5nIHNsaWRlcwogICAgICoKICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dAogICAgICovCiAgICB0aGlzLnRyYW5zaXRpb24gPSBudWxsOwogICAgLyoqCiAgICAgKiBUcmFuc2l0aW9uIHNldHRpbmdzIG9iamVjdCAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb25TZXR0aW5ncykKICAgICAqCiAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQKICAgICAqLwogICAgdGhpcy50cmFuc2l0aW9uU2V0dGluZ3MgPQogICAgICBuZXcgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uU2V0dGluZ3MoKTsKICAgIC8qKgogICAgICogalF1ZXJ5IG9iamVjdCB0aGF0IGNvbnRhaW5zIGFsbCBzbGlkZXMKICAgICAqCiAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQKICAgICAqLwogICAgdGhpcy4kc2xpZGVzID0gbnVsbDsKICAgIC8qKgogICAgICogalF1ZXJ5IG9iamVjdCB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50IHRoYXQgd3JhcHMgc2xpZGVzCiAgICAgKgogICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0CiAgICAgKi8KICAgIHRoaXMuJHdyYXBwZXIgPSBudWxsOwogICAgLyoqCiAgICAgKiBSZWZlcmVuY2UgdG8gbWV0aG9kIHRoYXQgc2hvdWxkIGNoYW5nZSBjdXJyZW50IHNsaWRlCiAgICAgKgogICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0CiAgICAgKi8KICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlID0gbnVsbDsKICAgIC8qKgogICAgICogUmVmZXJlbmNlIHRvIG1ldGhvZCB0aGF0IHNob3VsZCByZXR1cm4galF1ZXJ5IG9iamVjdCB3aXRoIGN1cnJlbnQgc2xpZGUKICAgICAqCiAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQKICAgICAqLwogICAgdGhpcy5nZXRDdXJyZW50U2xpZGUgPSBudWxsOwoKICAgIHRoaXMudGltZXJzLnB1c2godGhpcy5zbGlkZVRpbWVyKTsKICB9CiAgLyoqCiAgICogZW5kIG9mIFNsaWRlckNvbnRleHQgY2xhc3MKICAgKi8KCiAgLyoqCiAgICogU2xpZGVyIGNsYXNzIG1hbmFnZXMgY2hhbmdpbmcgb2Ygc2xpZGVzLgogICAqCiAgICogT3B0aW9ucyBvYmplY3Q6CiAgICogewogICAqICAgICAnbmF2aWdhdGlvbic6IE9iamVjdCB2YWx1ZSwgLy9uYXZpZ2F0aW9uIHNldHRpbmdzIG9iamVjdAogICAqICAgICAndGltZW91dCc6IE51bWJlciB2YWx1ZSwgLy90aW1lIGJldHdlZW4gc2xpZGVzIGNoYW5naW5nCiAgICogICAgICd0cmFuc2l0aW9uJzogU3RyaW5nIHZhbHVlLCAvL25hbWUgb2YgdHJhbnNpdGlvbiBjbGFzcyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24pCiAgICogICAgICdpc1BhdXNlRW5hYmxlZCc6IEJvb2xlYW4gdmFsdWUsIC8vZmxhZyB0aGF0IGRldGVybWluZXMgaWYgcGF1c2UgZmVhdHVyZSBpcyBlbmFibGVkCiAgICogICAgICd0aW1lSW5kaWNhdG9yJzogewogICAqICAgICAgICAgJ2lzRW5hYmxlZCc6IEJvb2xlYW4gdmFsdWUsIC8vZmxhZyB0aGF0IGRldGVybWluZXMgaWYgdGltZSBpbmRpY2F0b3IgaXMgZW5hYmxlZAogICAqICAgICAgICAgJ3NlbGVjdG9yJzogU3RyaW5nIHZhbHVlLCAvL3NlbGVjdG9yIG9mIHRpbWUgaW5kaWNhdG9yIGh0bWwgZWxlbWVudAogICAqICAgICAgICAgJ3ZpZXcnOiBTdHJpbmcgdmFsdWUsIC8vbmFtZSBvZiB2aWV3IGNsYXNzIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVmlldwogICAqICAgICAgICAgJ29wdGlvbnMnOiBPYmplY3QgdmFsdWUgLy9vYmplY3Qgd2l0aCBvcHRpb25zIHRoYXQgd2lsbCBiZSBwYXNzZWQgdG8gYSB0aW1lIGluZGljYXRvciB2aWV3CiAgICogICAgIH0KICAgKiB9CiAgICogQGNvbnN0cnVjdG9yCiAgICogQHBhcmFtIHtPYmplY3R9ICQgICAgIHRoZSBqUXVlcnkgb2JqZWN0CiAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGluc3RhbmNlIG9mIFNsaWRlckNvbnRleHQgY2xhc3M7IG11c3QgYmUgc2VwYXJhdGUgZm9yIGVhY2ggaW5zdGFuY2UgKEBzZWUgU2xpZGVyQ29udGV4dCkKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgICBTbGlkZXIgb3B0aW9ucyBvYmplY3QKICAgKi8KICBmdW5jdGlvbiBTbGlkZXIoJCwgY29udGV4dCwgb3B0aW9ucykgewogICAgdmFyIGRlZmF1bHRzID0gewogICAgICBuYXZpZ2F0aW9uOiB7fSwKICAgICAgdGltZW91dDogMTAwMDAsCiAgICAgIHRyYW5zaXRpb246ICJCYXNpY1RyYW5zaXRpb24iLAogICAgICBpc1BhdXNlRW5hYmxlZDogdHJ1ZSwKICAgICAgdGltZUluZGljYXRvcjogewogICAgICAgIGlzRW5hYmxlZDogZmFsc2UsCiAgICAgICAgc2VsZWN0b3I6IG51bGwsCiAgICAgICAgdmlldzogIlZpZXciLAogICAgICAgIG9wdGlvbnM6IHt9LAogICAgICB9LAogICAgfTsKCiAgICAvKioKICAgICAqIEluc3RhbmNlIG9mIFNsaWRlckNvbnRleHQgY2xhc3MgKEBzZWUgU2xpZGVyQ29udGV4dCkKICAgICAqCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24KICAgICAqLwogICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDsKCiAgICBjb250ZXh0Lm93bmVyID0gdGhpczsKICAgIGNvbnRleHQuZGVmYXVsdHMgPSBkZWZhdWx0czsKICAgIGNvbnRleHQuc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOwogICAgY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MuJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsKICB9CgogIC8qKgogICAqIEV4ZWN1dGVzIG1ldGhvZCB3aXRoIGdpdmVuIG1ldGhvZE5hbWUgb24gZWFjaCBUaW1lciBpbiBjb250ZXh0LnRpbWVycyAoQHNlZSBUaW1lcikKICAgKgogICAqIEBtZW1iZXIgU2xpZGVyCiAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZE5hbWUgICBuYW1lIG9mIGEgbWV0aG9kIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBvbiB0aW1lcnMKICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0CiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5leGVjdXRlT25UaW1lcnMgPSBmdW5jdGlvbiAobWV0aG9kTmFtZSwgY29udGV4dCkgewogICAgdmFyIGkgPSBudWxsLAogICAgICB0aW1lciA9IG51bGwsCiAgICAgIHRpbWVycyA9IGNvbnRleHQudGltZXJzOwoKICAgIGZvciAoaSA9IDA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgdGltZXIgPSB0aW1lcnNbaV07CiAgICAgIGlmICh0eXBlb2YgdGltZXJbbWV0aG9kTmFtZV0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB0aW1lclttZXRob2ROYW1lXSgpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRGVzY2hlZHVsZXMgY2hhbmdlIG9mIGEgc2xpZGUsIGJ5IGNsZWFyaW5nIHRpbWVvdXQgcHJldmlvdXNseSBzZXQgYnkgc2V0VGltZW91dCgpIGZ1bmN0aW9uLgogICAqCiAgICogQG1lbWJlciBTbGlkZXIKICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0CiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5kZXNjaGVkdWxlU2xpZGUgPSBmdW5jdGlvbiAoY29udGV4dCkgewogICAgaWYgKGNvbnRleHQudGltZW91dElkICE9PSBudWxsKSB7CiAgICAgIGNsZWFyVGltZW91dChjb250ZXh0LnRpbWVvdXRJZCk7CiAgICAgIGNvbnRleHQudGltZW91dElkID0gbnVsbDsKICAgIH0KICB9OwoKICAvKioKICAgKiBTY2hlZHVsZXMgY2hhbmdlIG9mIGEgc2xpZGUsIGJ5IHNldHRpbmcgdGltZW91dCAodXNpbmcgc2V0VGltZW91dCgpIGZ1bmN0aW9uKSBpZiBpdCBjYW4uCiAgICogSWYgY2Fubm90LCBpdCB0cmllcyBhZ2FpbiBhZnRlciBzaG9ydCBwZXJpb2Qgb2YgdGltZS4KICAgKgogICAqIEBtZW1iZXIgU2xpZGVyCiAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dAogICAqLwogIFNsaWRlci5wcm90b3R5cGUuc2NoZWR1bGVTbGlkZSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7CiAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyOwoKICAgIG93bmVyLmRlc2NoZWR1bGVTbGlkZShjb250ZXh0KTsKCiAgICBpZiAoIWNvbnRleHQucHJldmVudFNjaGVkdWxpbmcgJiYgY29udGV4dC4kc2xpZGVzLmxlbmd0aCA+IDEpIHsKICAgICAgb3duZXIuZXhlY3V0ZU9uVGltZXJzKCJzZXQiLCBjb250ZXh0KTsKCiAgICAgIGlmIChjb250ZXh0LmNhbkNoYW5nZVNsaWRlKSB7CiAgICAgICAgaWYgKGNvbnRleHQudGltZUluZGljYXRvciAhPT0gbnVsbCkgewogICAgICAgICAgY29udGV4dC50aW1lSW5kaWNhdG9yLnBsYXkoKTsKICAgICAgICB9CiAgICAgICAgY29udGV4dC50aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG93bmVyLmNoYW5nZUN1cnJlbnRTbGlkZUJ5KDEsIGNvbnRleHQpOwogICAgICAgIH0sIGNvbnRleHQuc2V0dGluZ3MudGltZW91dCAtIGNvbnRleHQuc2xpZGVUaW1lci5lbGFwc2VkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG93bmVyLnNjaGVkdWxlU2xpZGUoY29udGV4dCk7CiAgICAgICAgfSwgMTAwKTsKICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIENoYW5nZXMgY3VycmVudCBzbGlkZSBieSBvZmZzZXQgcGVyZm9ybWluZyBjb250ZXh0LnRyYW5zaXRpb24KICAgKiBBbnkgb2Zmc2V0IHZhbHVlIGlzIHNhdmUgKGlmIGl0IGlzIGFuIGludGVnZXIpLgogICAqCiAgICogQG1lbWJlciBTbGlkZXIKICAgKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0ICAgIHRoZSBvZmZzZXQgdG8gYW4gaW5kZXggb2YgYSBuZXcgc2xpZGUKICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0CiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5jaGFuZ2VDdXJyZW50U2xpZGVCeSA9IGZ1bmN0aW9uIChvZmZzZXQsIGNvbnRleHQpIHsKICAgIHZhciBzZXR0aW5ncyA9IGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLAogICAgICAkY3VycmVudFNsaWRlID0gY29udGV4dC5nZXRDdXJyZW50U2xpZGUoKSwKICAgICAgJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsKCiAgICBpZiAob2Zmc2V0ICUgJHNsaWRlcy5sZW5ndGggIT09IDApIHsKICAgICAgY29udGV4dC5jYW5DaGFuZ2VTbGlkZSA9IGZhbHNlOwoKICAgICAgc2V0dGluZ3Mub2Zmc2V0ID0gb2Zmc2V0OwogICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlID0gJGN1cnJlbnRTbGlkZTsKICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZSA9ICRzbGlkZXMuZXEoCiAgICAgICAgKCRjdXJyZW50U2xpZGUuaW5kZXgoKSArIG9mZnNldCkgJSAkc2xpZGVzLmxlbmd0aAogICAgICApOwoKICAgICAgY29udGV4dC5jaGFuZ2VDdXJyZW50U2xpZGUoc2V0dGluZ3MuJG5leHRTbGlkZSk7CiAgICAgIGNvbnRleHQudHJhbnNpdGlvbi5wZXJmb3JtKGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLCBvZmZzZXQpOwogICAgICBjb250ZXh0Lm93bmVyLmV4ZWN1dGVPblRpbWVycygicmVzZXQiLCBjb250ZXh0KTsKICAgIH0KCiAgICB2YXIgJGNhcm91c2VsID0gJChjb250ZXh0LiR3cmFwcGVyKS5wYXJlbnRzKCIuY2Fyb3VzZWwiKTsKICAgICRjYXJvdXNlbC50cmlnZ2VyKCJzbGlkZS1jaGFuZ2VkIik7CiAgfTsKCiAgLyoqCiAgICogU3RhcnRzIGF1dG9tYXRpYyBzbGlkZSBjaGFuZ2luZwogICAqCiAgICogQG1lbWJlciBTbGlkZXIKICAgKi8KICBTbGlkZXIucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZXhlY3V0ZU9uVGltZXJzKCJyZXNldCIsIHRoaXMuY29udGV4dCk7CiAgICB0aGlzLnNjaGVkdWxlU2xpZGUodGhpcy5jb250ZXh0KTsKICB9OwoKICAvKioKICAgKiBDYW5jZWwgdGhlIGRlZmF1bHQgYWN0aW9uIG9mIGV2ZW50IGFuZCBjaGFuZ2VzIHNsaWRlcyBtYW51YWxseS4KICAgKgogICAqIEBtZW1iZXIgU2xpZGVyCiAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50ICAgICB0aGUgZXZlbnQKICAgKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0ICAgIHRoZSBvZmZzZXQgdG8gYW4gaW5kZXggb2YgYSBuZXcgc2xpZGUKICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0CiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5vbkNoYW5nZUN1cnJlbnRTbGlkZSA9IGZ1bmN0aW9uIChldmVudCwgb2Zmc2V0LCBjb250ZXh0KSB7CiAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyOwoKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBpZiAoY29udGV4dC5jYW5DaGFuZ2VTbGlkZSkgewogICAgICBvd25lci5kZXNjaGVkdWxlU2xpZGUoY29udGV4dCk7CiAgICAgIG93bmVyLmNoYW5nZUN1cnJlbnRTbGlkZUJ5KG9mZnNldCwgY29udGV4dCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU2VsZWN0cyBuYXZpZ2F0aW9uIGl0ZW0gd2l0aCBnaXZlbiBpbmRleC4KICAgKgogICAqIEBtZW1iZXIgU2xpZGVyCiAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4ICAgICB0aGUgaW5kZXggb2YgbmF2aWdhdGlvbiBpdGVtCiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5zZWxlY3ROYXZpZ2F0aW9uSXRlbSA9IGZ1bmN0aW9uIChpbmRleCkgewogICAgdGhpcy5jb250ZXh0Lm5hdmlnYXRpb24uc2VsZWN0SXRlbShpbmRleCk7CiAgfTsKICAvKioKICAgKiBlbmQgb2YgU2xpZGVyIGNsYXNzCiAgICovCgogIC8qKgogICAqIFNsaWRlckluaXRpYWxpemVyIG9iamVjdCBzZXRzIHVwIGluc3RhbmNlcyBvZiBTbGlkZXIgY2xhc3MKICAgKi8KICBTbGlkZXJJbml0aWFsaXplciA9IChmdW5jdGlvbiAoJCkgewogICAgdmFyIERJUkVDVElPTiA9IHsKICAgICAgUFJFVjogLTEsCiAgICAgIE5FWFQ6IDEsCiAgICB9OwoKICAgIC8qKgogICAgICogQXR0YWNoZXMgZXZlbnRzIHRvIG5hdmlnYXRpb24gaXRlbXMuCiAgICAgKgogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGF0dGFjaE5hdmlnYXRpb25FdmVudHMoY29udGV4dCkgewogICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyLAogICAgICAgICRuYXZMaW5rcyA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgiLm5hdi1pdGVtcyIpLAogICAgICAgICRwcmV2SXRlbVR4dCA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgiLnByZXYtdGV4dCIpLAogICAgICAgICRuZXh0SXRlbVR4dCA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgiLm5leHQtdGV4dCIpLAogICAgICAgICRjYXJvdXNlbCA9IGNvbnRleHQuJHdyYXBwZXIucGFyZW50cygiLmNhcm91c2VsIik7CgogICAgICBjb250ZXh0Lm5hdmlnYXRpb24uJGl0ZW1zLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgdmFyICRzbGlkZSA9IGNvbnRleHQuJHNsaWRlcy5lcShpbmRleCk7CgogICAgICAgICQodGhpcykuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZSgKICAgICAgICAgICAgZXZlbnQsCiAgICAgICAgICAgICRzbGlkZS5pbmRleCgpIC0gY29udGV4dC5nZXRDdXJyZW50U2xpZGUoKS5pbmRleCgpLAogICAgICAgICAgICBjb250ZXh0CiAgICAgICAgICApOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgICRwcmV2SXRlbVR4dC5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBzd2l0Y2hTbGlkZShldmVudCwgY29udGV4dCwgRElSRUNUSU9OLlBSRVYpOwogICAgICB9KTsKCiAgICAgICRuZXh0SXRlbVR4dC5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBzd2l0Y2hTbGlkZShldmVudCwgY29udGV4dCwgRElSRUNUSU9OLk5FWFQpOwogICAgICB9KTsKCiAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kcHJldkl0ZW0uY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgc3dpdGNoU2xpZGUoZXZlbnQsIGNvbnRleHQsIERJUkVDVElPTi5QUkVWKTsKICAgICAgfSk7CgogICAgICBjb250ZXh0Lm5hdmlnYXRpb24uJG5leHRJdGVtLmNsaWNrKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHN3aXRjaFNsaWRlKGV2ZW50LCBjb250ZXh0LCBESVJFQ1RJT04uTkVYVCk7CiAgICAgIH0pOwoKICAgICAgJG5hdkxpbmtzLm9uKCJrZXlkb3duIiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgc3dpdGNoIChldmVudC5rZXlDb2RlKSB7CiAgICAgICAgICBjYXNlIDM3OiAvL0xldGYgYXJyb3cKICAgICAgICAgICAgc3dpdGNoU2xpZGUoZXZlbnQsIGNvbnRleHQsIERJUkVDVElPTi5QUkVWKTsKICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuYWN0aXZlIikuZm9jdXMoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM5OiAvL1JpZ2h0IGFycm93CiAgICAgICAgICAgIHN3aXRjaFNsaWRlKGV2ZW50LCBjb250ZXh0LCBESVJFQ1RJT04uTkVYVCk7CiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiLmFjdGl2ZSIpLmZvY3VzKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxMzogLy9FbnRlcgogICAgICAgICAgICBmb2N1c0ZpcnN0Rm9jdXNhYmxlRWxlbWVudChvd25lci5jb250ZXh0LmdldEN1cnJlbnRTbGlkZSgpKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgJGNhcm91c2VsLm9uKCJzbGlkZS1jaGFuZ2VkIiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgdmFyICRhY3RpdmVMaW5rID0gJG5hdkxpbmtzLmZpbmQoIi5hY3RpdmUiKTsKICAgICAgICAkYWN0aXZlTGluay5hdHRyKCJ0YWJpbmRleCIsICIwIik7CgogICAgICAgIGlmICgkbmF2TGlua3MuZmluZChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5sZW5ndGgpIHsKICAgICAgICAgICRhY3RpdmVMaW5rLmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTsKICAgICAgICB9CgogICAgICAgICRuYXZMaW5rcy5maW5kKCI+ZGl2Iikubm90KCIuYWN0aXZlIikuYXR0cigidGFiaW5kZXgiLCAiLTEiKTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTd2l0Y2hlcyBzbGlkZXMgYmFjayBhbmQgZm9yZXdhcmQKICAgICAqCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudCAgICAgICAgICAgICAgYW4gZXZlbnQgdGhhdCBjYXVzZWQgc3dpdGNoIHNsaWRlIGFjdGlvbgogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQogICAgICogQHBhcmFtIHtudW1iZXJ9IGRpcmVjdGlvbiAgICAgICAgIHN3aXRjaCBzbGlkZSBkaXJlY3Rpb24uIC0xIC0gc3dpdGNoIHRvIHByZXYgc2xpZGUuIDEgLSBzd2l0Y2ggdG8gdGhlIG5leHQgc2xpZGUKICAgICAqLwogICAgZnVuY3Rpb24gc3dpdGNoU2xpZGUoZXZlbnQsIGNvbnRleHQsIGRpcmVjdGlvbikgewogICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyLAogICAgICAgIG5hdkxpbmtzJCA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgiLm5hdi1pdGVtcyIpOwoKICAgICAgbmF2TGlua3MkLmZpbmQoIi5hY3RpdmUiKS5hdHRyKCJ0YWJpbmRleCIsICItMSIpOwogICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgZGlyZWN0aW9uLCBjb250ZXh0KTsKICAgICAgbmF2TGlua3MkLmZpbmQoIi5hY3RpdmUiKS5hdHRyKCJ0YWJpbmRleCIsICIwIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBGb2N1cyB0aGUgZmlyc3QgZm9jdXNhYmxlIGVsZW1lbnQgaW5zaWRlIGNvbnRhaW5lci4KICAgICAqCiAgICAgKiBAcGFyYW0ge0NvbnRhaW5lcn0gY29udGFpbmVyICBhIGNvbnRhaW5lciBlbGVtZW50IHdoZXJlIHRoZSBmaXJzdCBmb2N1c2FibGUgZWxlbWVudCB3aWxsIGJlIGZvY3VzZWQKICAgICAqLwogICAgZnVuY3Rpb24gZm9jdXNGaXJzdEZvY3VzYWJsZUVsZW1lbnQoY29udGFpbmVyKSB7CiAgICAgIHZhciBmb2N1c2FibGVFbGVtZW50c1N0cmluZyA9CiAgICAgICAgJ2FbaHJlZl0sIGFyZWFbaHJlZl0sIGlucHV0Om5vdChbZGlzYWJsZWRdKSwgc2VsZWN0Om5vdChbZGlzYWJsZWRdKSwgdGV4dGFyZWE6bm90KFtkaXNhYmxlZF0pLCBidXR0b246bm90KFtkaXNhYmxlZF0pLCBpZnJhbWUsIG9iamVjdCwgZW1iZWQsIFt0YWJpbmRleD0iMCJdLCBbY29udGVudGVkaXRhYmxlXSc7CgogICAgICAvLyBGaW5kcyBhbGwgZm9jdXNhYmxlIGNoaWxkcmVuCiAgICAgIHZhciBmb2N1c2FibGVFbGVtZW50cyA9IGNvbnRhaW5lci5maW5kKGZvY3VzYWJsZUVsZW1lbnRzU3RyaW5nKTsKCiAgICAgIC8vIElmIHRoZXJlIGFyZSBmb2N1c2FibGUgZWxlbWVudHMgLSBzZWxlY3QgdGhlIGZpcnN0IG9uZS4KICAgICAgaWYgKGZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCAhPT0gMCkgewogICAgICAgIHZhciBmaXJzdFRhYlN0b3AgPSBmb2N1c2FibGVFbGVtZW50c1swXTsKCiAgICAgICAgLy8gRm9jdXMgZmlyc3QKICAgICAgICBmaXJzdFRhYlN0b3AuZm9jdXMoKTsKICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoZXMgcGF1c2UgZXZlbnQgdG8gbmF2aWdhdGlvbiB3cmFwcGVyLgogICAgICoKICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQogICAgICovCiAgICBmdW5jdGlvbiBhdHRhY2hQYXVzZUV2ZW50KGNvbnRleHQpIHsKICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lciwKICAgICAgICAkZWxlbWVudCA9IGNvbnRleHQuJHdyYXBwZXIsCiAgICAgICAgJG5hdkxpbmtzID0gJGVsZW1lbnQuZmluZCgiLm5hdiBhIik7CgogICAgICB2YXIgY2FsbGJhY2tNb3VzZWVudGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnRleHQucHJldmVudFNjaGVkdWxpbmcgPSB0cnVlOwogICAgICAgIG93bmVyLmRlc2NoZWR1bGVTbGlkZShjb250ZXh0KTsKCiAgICAgICAgb3duZXIuZXhlY3V0ZU9uVGltZXJzKCJ1cGRhdGUiLCBjb250ZXh0KTsKICAgICAgICBpZiAoY29udGV4dC50aW1lSW5kaWNhdG9yICE9PSBudWxsKSB7CiAgICAgICAgICBjb250ZXh0LnRpbWVJbmRpY2F0b3IucGF1c2UoKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICAkZWxlbWVudC5tb3VzZWVudGVyKGNhbGxiYWNrTW91c2VlbnRlcik7CiAgICAgICRuYXZMaW5rcy5vbigiZm9jdXMiLCBjYWxsYmFja01vdXNlZW50ZXIpOwoKICAgICAgdmFyIGNhbGxiYWNrTW91c2VMZWF2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nID0gZmFsc2U7CiAgICAgICAgb3duZXIuc2NoZWR1bGVTbGlkZShjb250ZXh0KTsKICAgICAgfTsKCiAgICAgICRlbGVtZW50Lm1vdXNlbGVhdmUoY2FsbGJhY2tNb3VzZUxlYXZlKTsKICAgICAgJG5hdkxpbmtzLm9uKCJibHVyIiwgY2FsbGJhY2tNb3VzZUxlYXZlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGltZSBpbmRpY2F0b3IgdmlldwogICAgICoKICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVJbmRpY2F0b3IoY29udGV4dCkgewogICAgICB2YXIgc2V0dGluZ3MgPSBjb250ZXh0LnNldHRpbmdzLAogICAgICAgIHRpbWVJbmRpY2F0b3IgPSBudWxsLAogICAgICAgIFZpZXdDb25zdHJ1Y3RvciA9CiAgICAgICAgICBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzW3NldHRpbmdzLnRpbWVJbmRpY2F0b3Iudmlld10sCiAgICAgICAgdmlldyA9IG51bGw7CgogICAgICBpZiAoVmlld0NvbnN0cnVjdG9yICE9PSBudWxsKSB7CiAgICAgICAgdmlldyA9IG5ldyBWaWV3Q29uc3RydWN0b3IoCiAgICAgICAgICBzZXR0aW5ncy50aW1lSW5kaWNhdG9yLnNlbGVjdG9yLAogICAgICAgICAgc2V0dGluZ3MudGltZUluZGljYXRvci5vcHRpb25zCiAgICAgICAgKTsKICAgICAgICB0aW1lSW5kaWNhdG9yID0gbmV3IFRpbWVJbmRpY2F0b3IoJCwgdmlldywgc2V0dGluZ3MudGltZW91dCk7CiAgICAgICAgY29udGV4dC50aW1lSW5kaWNhdG9yID0gdGltZUluZGljYXRvcjsKICAgICAgICBjb250ZXh0LnRpbWVycy5wdXNoKHRpbWVJbmRpY2F0b3IpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBdHRhY2hlcyBldmVudHMgdG8gbmF2aWdhdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZU5hdmlnYXRpb24oY29udGV4dCkgewogICAgICBjb250ZXh0LnNldHRpbmdzLm5hdmlnYXRpb24uc2xpZGVzQ291bnQgPSBjb250ZXh0LiRzbGlkZXMubGVuZ3RoOwogICAgICBjb250ZXh0Lm5hdmlnYXRpb24gPSBuZXcgTmF2aWdhdGlvbigKICAgICAgICAkLAogICAgICAgIGNvbnRleHQuJHdyYXBwZXIsCiAgICAgICAgY29udGV4dC5zZXR0aW5ncy5uYXZpZ2F0aW9uCiAgICAgICk7CgogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBhdHRhY2hOYXZpZ2F0aW9uRXZlbnRzKGNvbnRleHQpOwogICAgICB9LCAxMDAwKTsKCiAgICAgIGlmIChjb250ZXh0LnNldHRpbmdzLmlzUGF1c2VFbmFibGVkKSB7CiAgICAgICAgYXR0YWNoUGF1c2VFdmVudChjb250ZXh0KTsKICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZXMgdHJhbnNpdGlvbiBmb3IgYSBnaXZlbiBjb250ZXh0LgogICAgICoKICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQogICAgICovCiAgICBmdW5jdGlvbiBpbml0aWFsaXplVHJhbnNpdGlvbihjb250ZXh0KSB7CiAgICAgIHZhciBUcmFuc2l0aW9uQ29uc3RydWN0b3IgPSBudWxsLAogICAgICAgIG93bmVyID0gY29udGV4dC5vd25lcjsKCiAgICAgIGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLmNhbGxiYWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnRleHQuY2FuQ2hhbmdlU2xpZGUgPSB0cnVlOwoKICAgICAgICBpZiAoY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZykgewogICAgICAgICAgb3duZXIuZXhlY3V0ZU9uVGltZXJzKCJyZXNldCIsIGNvbnRleHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvd25lci5zY2hlZHVsZVNsaWRlKGNvbnRleHQpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9CiAgICAgICAgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9uc1tjb250ZXh0LnNldHRpbmdzLnRyYW5zaXRpb25dOwogICAgICBpZiAoCiAgICAgICAgVHJhbnNpdGlvbkNvbnN0cnVjdG9yID09PSBudWxsIHx8CiAgICAgICAgVHJhbnNpdGlvbkNvbnN0cnVjdG9yID09PSB1bmRlZmluZWQKICAgICAgKSB7CiAgICAgICAgVHJhbnNpdGlvbkNvbnN0cnVjdG9yID0KICAgICAgICAgIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnNbY29udGV4dC5kZWZhdWx0cy50cmFuc2l0aW9uXTsKICAgICAgfQogICAgICBjb250ZXh0LnRyYW5zaXRpb24gPSBuZXcgVHJhbnNpdGlvbkNvbnN0cnVjdG9yKCk7CiAgICAgIGNvbnRleHQudHJhbnNpdGlvbi5pbml0KGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAvKioKICAgICAgICogSW5pdGlhbGl6ZXMgU2xpZGVyIG9iamVjdCB3aXRoIGEgZ2l2ZW4gY29udGV4dC4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlCiAgICAgICAqLwogICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoY29udGV4dCkgewogICAgICAgIGluaXRpYWxpemVOYXZpZ2F0aW9uKGNvbnRleHQpOwogICAgICAgIGluaXRpYWxpemVUcmFuc2l0aW9uKGNvbnRleHQpOwoKICAgICAgICBpZiAoY29udGV4dC5zZXR0aW5ncy50aW1lSW5kaWNhdG9yLmlzRW5hYmxlZCkgewogICAgICAgICAgY3JlYXRlSW5kaWNhdG9yKGNvbnRleHQpOwogICAgICAgIH0KICAgICAgfSwKICAgIH07CiAgfSkoJCk7CiAgLyoqCiAgICogZW5kIG9mIFNsaWRlckluaXRpYWxpemVyCiAgICovCgogIC8qKgogICAqIENhcm91c2VsIGNsYXNzIGRpc3BsYXlzIG9uZSBzbGlkZSAoc29tZSBjb250ZW50KSBhdCB0aGUgdGltZS4KICAgKiBJdHMgYmVoYXZpb3IgZGVwZW5kcyBvbiBzZXR0aW5ncyAocGFzc2VkIHRvIGluaXQoKSBtZXRob2QpLgogICAqIEZvciBtb3JlIGRldGFpbHMgQHNlZSBTbGlkZXIsIEBzZWUgU2xpZGVySW5pdGlhbGl6ZXIsIEBzZWUgTmF2aWdhdGlvbiwKICAgKiBAc2VlIE5hdmlnYXRpb25CdWlsZGVyLCBAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbiwKICAgKiBAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVmlldwogICAqCiAgICogQGNvbnN0cnVjdG9yCiAgICovCiAgZnVuY3Rpb24gQ2Fyb3VzZWwoKSB7CiAgICB2YXIgY29udGV4dCA9IHRoaXM7CgogICAgLyoqCiAgICAgKiBJbnN0YW5jZSBvZiBhIFNsaWRlciBjbGFzcyAoQHNlZSBTbGlkZXIpLgogICAgICoKICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwKICAgICAqLwogICAgdGhpcy5zbGlkZXIgPSBudWxsOwogICAgLyoqCiAgICAgKiBEaXNwbGF5ZWQgc2xpZGUgKGpRdWVyeSBvYmplY3QpLgogICAgICoKICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwKICAgICAqLwogICAgdGhpcy4kY3VycmVudFNsaWRlID0gbnVsbDsKICAgIC8qKgogICAgICogQWxsIHNsaWRlcyAoalF1ZXJ5IG9iamVjdCkuCiAgICAgKgogICAgICogQG1lbWJlciBDYXJvdXNlbAogICAgICovCiAgICB0aGlzLiRzbGlkZXMgPSBudWxsOwoKICAgIC8qKgogICAgICogQ2hhbmdlcyBjdXJyZW50IHNsaWRlIHRvIGEgJG5ld1NsaWRlLgogICAgICoKICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwKICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkbmV3U2xpZGUgIHRoZSBuZXcgc2xpZGUgKGpRdWVyeSkgb2JqZWN0LgogICAgICovCiAgICB0aGlzLmNoYW5nZUN1cnJlbnRTbGlkZSA9IGZ1bmN0aW9uICgkbmV3U2xpZGUpIHsKICAgICAgY29udGV4dC4kY3VycmVudFNsaWRlID0gJG5ld1NsaWRlOwogICAgICBjb250ZXh0LnNsaWRlci5zZWxlY3ROYXZpZ2F0aW9uSXRlbSgkbmV3U2xpZGUuaW5kZXgoKSk7CiAgICB9OwoKICAgIC8qKgogICAgICogUmV0dXJucyBjdXJyZW50IHNsaWRlLgogICAgICoKICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwKICAgICAqIEByZXR1cm4gY3VycmVudCBzbGlkZSAoalF1ZXJ5KSBvYmplY3QuCiAgICAgKiBAdHlwZSBPYmplY3QKICAgICAqLwogICAgdGhpcy5nZXRDdXJyZW50U2xpZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBjb250ZXh0LiRjdXJyZW50U2xpZGU7CiAgICB9OwoKICAgIHRoaXMuZGF0YSA9IHt9OwogIH0KCiAgLyoqCiAgICogUmVzZXRzIHRoZSBjYXJvdXNlbC4KICAgKgogICAqIEBtZW1iZXIgQ2Fyb3VzZWwKICAgKi8KICBDYXJvdXNlbC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLiRzbGlkZXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICQodGhpcykuaGlkZSgpOwogICAgfSk7CgogICAgdGhpcy5jaGFuZ2VDdXJyZW50U2xpZGUodGhpcy4kc2xpZGVzLmZpcnN0KCkpOwogICAgdGhpcy4kY3VycmVudFNsaWRlLnNob3coKTsKICB9OwoKICAvKioKICAgKiBJbml0aWFsaXplcyB0aGUgY2Fyb3VzZWwuCiAgICogV3JhcHMgY2Fyb3VzZWwgY29udGVudCB3aXRoIDxkaXYgY2xhc3M9IndyYXBwZXIiIC8+IGVsZW1lbnQsCiAgICogc2VsZWN0cyBzbGlkZXMgKDxsaSAvPiBlbGVtZW50cykgZnJvbSA8dWwgY2xhc3M9InNsaWRlcyIgLz4gZWxlbWVudCwKICAgKiBpbml0aWFsaXplcyBTbGlkZXIgY2xhc3MgaW5zdGFuY2UsIHJlc2V0cyB0aGUgY2Fyb3VzZWwsIGFuZCBzdGFydHMgYXV0b21hdGljIHNsaWRlcyBjaGFuZ2luZy4KICAgKgogICAqIEBtZW1iZXIgQ2Fyb3VzZWwKICAgKiBAcGFyYW0ge09iamVjdH0gJGNvbnRhaW5lciAgICAgalF1ZXJ5IG9iamVjdCB3aXRoIGEgbWFpbiBodG1sIGVsZW1lbnQgb2YgdGhlIGNhcm91c2VsCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICAgIGNhcm91c2VsIG9wdGlvbnMgb2JqZWN0CiAgICovCiAgQ2Fyb3VzZWwucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoJGNvbnRhaW5lciwgb3B0aW9ucykgewogICAgdmFyICR3cmFwcGVyID0gJCgnLndyYXBwZXInKS5sZW5ndGggPyAkKCcud3JhcHBlcicpIDogJCgiPGRpdi8+IiwgewogICAgICAgIGNsYXNzOiAid3JhcHBlciIsCiAgICAgIH0pLAogICAgICBzbGlkZXJDb250ZXh0ID0gbnVsbDsKCiAgICBpZiAoISQoJy53cmFwcGVyJykubGVuZ3RoKSB7CiAgICAgICR3cmFwcGVyLmFwcGVuZCgkY29udGFpbmVyLmNoaWxkcmVuKCkuZGV0YWNoKCkpOwogICAgICAkY29udGFpbmVyLmFwcGVuZCgkd3JhcHBlcik7CiAgICB9CiAgICAKICAgIHRoaXMuJHNsaWRlcyA9ICR3cmFwcGVyLmZpbmQoIi5zbGlkZXMgbGkuc2xpZGUiKTsKCiAgICBzbGlkZXJDb250ZXh0ID0gbmV3IFNsaWRlckNvbnRleHQoKTsKICAgIHNsaWRlckNvbnRleHQuY2hhbmdlQ3VycmVudFNsaWRlID0gdGhpcy5jaGFuZ2VDdXJyZW50U2xpZGU7CiAgICBzbGlkZXJDb250ZXh0LmdldEN1cnJlbnRTbGlkZSA9IHRoaXMuZ2V0Q3VycmVudFNsaWRlOwogICAgc2xpZGVyQ29udGV4dC4kc2xpZGVzID0gdGhpcy4kc2xpZGVzOwogICAgc2xpZGVyQ29udGV4dC4kd3JhcHBlciA9ICR3cmFwcGVyOwoKICAgIHRoaXMuc2xpZGVyID0gbmV3IFNsaWRlcigkLCBzbGlkZXJDb250ZXh0LCBvcHRpb25zKTsKICAgIFNsaWRlckluaXRpYWxpemVyLmluaXRpYWxpemUoc2xpZGVyQ29udGV4dCk7CgogICAgdGhpcy5yZXNldCgpOwogICAgdGhpcy5zbGlkZXIucnVuKCk7CiAgfTsKICAvKioKICAgKiBlbmQgb2YgQ2Fyb3VzZWwgY2xhc3MKICAgKi8KCiAgLyogQ2Fyb3VzZWwgdG91Y2ggc3VwcG9ydCAqLwogIENhcm91c2VsLnByb3RvdHlwZS5zd2lwZVNsaWRlID0gZnVuY3Rpb24gKCkgewogICAgdmFyICR3cmFwcGVyID0gdGhpcy5zbGlkZXIuY29udGV4dC4kd3JhcHBlciwKICAgICAgc3dpcGVyID0gbmV3IFN3aXBlcigkd3JhcHBlclswXSk7CgogICAgc3dpcGVyLm9uU3dpcGVMZWZ0KChlKSA9PgogICAgICB0aGlzLnNsaWRlci5jb250ZXh0Lm93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGUsIDEsIHRoaXMuc2xpZGVyLmNvbnRleHQpCiAgICApOwogICAgc3dpcGVyLm9uU3dpcGVSaWdodCgoZSkgPT4KICAgICAgdGhpcy5zbGlkZXIuY29udGV4dC5vd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShlLCAtMSwgdGhpcy5zbGlkZXIuY29udGV4dCkKICAgICk7CiAgfTsKCiAgQ2Fyb3VzZWwucHJvdG90eXBlLm1heFNsaWRlSW5mb0hlaWdodCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBtYXhIZWlnaHQgPSAwLAogICAgICBzbGlkZUluZm8gPQogICAgICAgIHRoaXMuJHNsaWRlc1swXSAmJiB0aGlzLiRzbGlkZXNbMF0ucXVlcnlTZWxlY3RvcigiLnNsaWRlLWluZm8iKTsKCiAgICBpZiAoc2xpZGVJbmZvKSB7CiAgICAgIG1heEhlaWdodCA9IHNsaWRlSW5mby5vZmZzZXRIZWlnaHQ7CiAgICB9CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRoaXMuJHNsaWRlcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc2xpZGVJbmZvID0gdGhpcy4kc2xpZGVzW2ldLnF1ZXJ5U2VsZWN0b3IoIi5zbGlkZS1pbmZvIik7CgogICAgICBpZiAoIXNsaWRlSW5mbykgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICB2YXIgY3VyclNsaWRlSW5mb0hlaWdodCA9IHNsaWRlSW5mby5vZmZzZXRIZWlnaHQ7CgogICAgICBpZiAobWF4SGVpZ2h0IDwgY3VyclNsaWRlSW5mb0hlaWdodCkgewogICAgICAgIG1heEhlaWdodCA9IGN1cnJTbGlkZUluZm9IZWlnaHQ7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtYXhIZWlnaHQ7CiAgfTsKCiAgQ2Fyb3VzZWwucHJvdG90eXBlLnJlc2l6ZVdyYXBwZXIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2xpZGVJbmZvSGVpZ2h0ID0gdGhpcy5tYXhTbGlkZUluZm9IZWlnaHQoKSwKICAgICAgd3JhcHBlciA9IHRoaXMuc2xpZGVyLmNvbnRleHQuJHdyYXBwZXI7CiAgICB3cmFwcGVyLmZpbmQoIi5zbGlkZS1pbmZvIikuY3NzKHsKICAgICAgIm1pbi1oZWlnaHQiOiBzbGlkZUluZm9IZWlnaHQsCiAgICB9KTsKICB9OwoKICBwdWIuaW5pdEluc3RhbmNlID0gZnVuY3Rpb24gKGNvbXBvbmVudCkgewogICAgY29uc3QgZGVmYXVsdFByb3BlcnRpZXMgPSB7CiAgICAgICJ0aW1lb3V0IjogMjE0NzQ4MzY0NywKICAgICAgImlzUGF1c2VFbmFibGVkIjogdHJ1ZSwKICAgICAgInRyYW5zaXRpb24iOiAiQmFzaWNUcmFuc2l0aW9uIiwKICB9OwogICAgdmFyIHByb3BlcnRpZXMgPSBjb21wb25lbnQuZGF0YSgicHJvcGVydGllcyIpIHx8IGRlZmF1bHRQcm9wZXJ0aWVzLAogICAgICBjb21wb25lbnQgPSBjb21wb25lbnQuZmluZCgiLmNhcm91c2VsLWlubmVyIiksCiAgICAgIGlkID0gY29tcG9uZW50LmF0dHIoImRhdGEtaWQiKSwKICAgICAgc2VsZiA9IGNvbXBvbmVudC5lcSgwKSwKICAgICAgcXVlcnlTbGlkZUluZGV4ID0gcGFyc2VJbnQoCiAgICAgICAgWEEucXVlcnlTdHJpbmcuZ2V0UXVlcnlQYXJhbSgKICAgICAgICAgIGNvbXBvbmVudC5jbG9zZXN0KCIuY29tcG9uZW50LmNhcm91c2VsIikuYXR0cigiaWQiKSB8fCAiY2Fyb3VzZWwiCiAgICAgICAgKQogICAgICApLAogICAgICB2YWxpZFF1ZXJ5UGFyYW0gPQogICAgICAgIHR5cGVvZiBxdWVyeVNsaWRlSW5kZXggIT09ICJ1bmRlZmluZWQiICYmCiAgICAgICAgIWlzTmFOKHF1ZXJ5U2xpZGVJbmRleCkgJiYKICAgICAgICBxdWVyeVNsaWRlSW5kZXggPCBjb21wb25lbnQuZmluZCgiLnN4YS1udW1iZXJzIikubGVuZ3RoLAogICAgICBjb250ZXh0LAogICAgICBzZXR0aW5ncywKICAgICAgJGN1cnJlbnRTbGlkZSwKICAgICAgJHNsaWRlczsKCiAgICBpZiAocHJvcGVydGllcykgewogICAgICBpZiAoIXByb3BlcnRpZXMubmF2aWdhdGlvbikgewogICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbiA9IHsKICAgICAgICAgIGl0ZW06IHt9LAogICAgICAgICAgcHJldkl0ZW06IHt9LAogICAgICAgICAgbmV4dEl0ZW06IHt9LAogICAgICAgICAgaXNFbmFibGVkOiB2YWxpZFF1ZXJ5UGFyYW0gPyBmYWxzZSA6IHRydWUsCiAgICAgICAgfTsKICAgICAgfQogICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24uaXRlbS5zZWxlY3RvciA9ICJbZGF0YS1pZD0nIiArIGlkICsgIiddIC5uYXYtaXRlbXMiOyAvL3Byb3BlcnRpZXMubmF2aWdhdGlvbi5pdGVtLnNlbGVjdG9yOwogICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24ucHJldkl0ZW0uc2VsZWN0b3IgPSAiIyIgKyBpZCArICIgLm5hdiI7CiAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbi5uZXh0SXRlbS5zZWxlY3RvciA9ICIjIiArIGlkICsgIiAubmF2IjsKCiAgICAgIHZhciBjYXJvdXNlbCA9IG5ldyBDYXJvdXNlbCgkKTsKICAgICAgY2Fyb3VzZWwuaW5pdChjb21wb25lbnQsIHByb3BlcnRpZXMpOwoKICAgICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgewogICAgICAgIGNhcm91c2VsLnJlc2l6ZVdyYXBwZXIoKTsKICAgICAgfSk7CgogICAgICBpZiAodmFsaWRRdWVyeVBhcmFtKSB7CiAgICAgICAgKGNvbnRleHQgPSBjYXJvdXNlbC5zbGlkZXIuY29udGV4dCksCiAgICAgICAgICAoc2V0dGluZ3MgPSBjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncyksCiAgICAgICAgICAoJGN1cnJlbnRTbGlkZSA9IGNvbnRleHQuZ2V0Q3VycmVudFNsaWRlKCkpLAogICAgICAgICAgKCRzbGlkZXMgPSBjb250ZXh0LiRzbGlkZXMpOwoKICAgICAgICBjb250ZXh0LmNhbkNoYW5nZVNsaWRlID0gZmFsc2U7CiAgICAgICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZSA9ICRjdXJyZW50U2xpZGU7CiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZSA9ICQoJHNsaWRlc1txdWVyeVNsaWRlSW5kZXhdKTsKCiAgICAgICAgY29udGV4dC5jaGFuZ2VDdXJyZW50U2xpZGUoc2V0dGluZ3MuJG5leHRTbGlkZSk7CiAgICAgICAgY29udGV4dC50cmFuc2l0aW9uLnBlcmZvcm0oY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MpOwogICAgICAgIGNvbnRleHQub3duZXIuZXhlY3V0ZU9uVGltZXJzKCJyZXNldCIsIGNvbnRleHQpOwoKICAgICAgICBjb250ZXh0Lm5hdmlnYXRpb24ucHJlcGFyZUl0ZW1zKAogICAgICAgICAgcHJvcGVydGllcy5uYXZpZ2F0aW9uLml0ZW0sCiAgICAgICAgICAkc2xpZGVzLmxlbmd0aCwKICAgICAgICAgICQoY29udGV4dC4kd3JhcHBlcikKICAgICAgICApOwogICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi5zZWxlY3RJdGVtKHF1ZXJ5U2xpZGVJbmRleCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2Fyb3VzZWwuc3dpcGVTbGlkZSgpOwogICAgICB9CiAgICB9CiAgfTsKCiAgcHViLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAkKCIuY2Fyb3VzZWwiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgcHViLmluaXRJbnN0YW5jZSgkKHRoaXMpKTsKICAgIH0pOwogIH07CgogIHJldHVybiBwdWI7Cn0pKGpRdWVyeSk7Ci8qKgogKiBlbmQgb2YgWEEuY29tcG9uZW50LmNhcm91c2VscyBtb2R1bGUuCiAqLwoKWEEucmVnaXN0ZXIoImNhcm91c2VscyIsIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMpOwoKWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucyA9IChmdW5jdGlvbiAoKSB7CiAgdmFyIHB1YiA9IHt9OwoKICAvKioKICAgKiBUcmFuc2l0aW9uU2V0dGluZ3MgY2xhc3MgY29udGFpbnMgZGF0YSBuZWVkZWQgZm9yIGNoYW5naW5nIHNsaWRlcwogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIFRyYW5zaXRpb25TZXR0aW5ncygpIHt9CiAgLyoqCiAgICogQ3VycmVudCBzbGlkZSAoY3VycmVudGx5IGRpc3BsYXllZCkgalF1ZXJ5IG9iamVjdAogICAqCiAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MKICAgKi8KICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRjdXJyZW50U2xpZGUgPSBudWxsOwogIC8qKgogICAqIE5leHQgc2xpZGUgalF1ZXJ5IG9iamVjdAogICAqCiAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MKICAgKi8KICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRuZXh0U2xpZGUgPSBudWxsOwogIC8qKgogICAqIEFsbCBzbGlkZXMgKGpRdWVyeSBvYmplY3QpCiAgICoKICAgKiBAbWVtYmVyIFRyYW5zaXRpb25TZXR0aW5ncwogICAqLwogIFRyYW5zaXRpb25TZXR0aW5ncy5wcm90b3R5cGUuJHNsaWRlcyA9IG51bGw7CiAgLyoqCiAgICogT2Zmc2V0IGJldHdlZW4gJGN1cnJlbnRTbGlkZSBhbmQgJG5leHRTbGlkZQogICAqCiAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MKICAgKi8KICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLm9mZnNldCA9IDA7CiAgLyoqCiAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBtdXN0IGJlIGNhbGxlZCBhZnRlciBhbmltYXRpb24uCiAgICoKICAgKiBAbWVtYmVyIFRyYW5zaXRpb25TZXR0aW5ncwogICAqLwogIFRyYW5zaXRpb25TZXR0aW5ncy5wcm90b3R5cGUuY2FsbGJhY2sgPSBudWxsOwogIC8qKgogICAqIGVuZCBvZiBUcmFuc2l0aW9uU2V0dGluZ3MgY2xhc3MKICAgKi8KICBwdWIuVHJhbnNpdGlvblNldHRpbmdzID0gVHJhbnNpdGlvblNldHRpbmdzOwoKICAvKioKICAgKiBUcmFuc2l0aW9uIGNsYXNzIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgdHJhbnNpdGlvbnMuCiAgICoKICAgKiBJbXBvcnRhbnQ6IHNldHRpbmdzLmNhbGxiYWNrKCkgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSBoYXZlIHRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIGV4ZWN1dGlvbiB0aGUgcGVyZm9ybSgpIG1ldGhvZC4KICAgKgogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIFRyYW5zaXRpb24oKSB7fQogIFRyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsKICAvKioKICAgKiBJbml0aWFsaXplcyBhIHRyYW5zaXRpb24gd2l0aCBnaXZlbiBzZXR0aW5ncyAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpLgogICAqCiAgICogQG1lbWJlciBUcmFuc2l0aW9uCiAgICogQHBhcmFtIHtUcmFuc2l0aW9uU2V0dGluZ3N9IHNldHRpbmdzICB0cmFuc2l0aW9uIHNldHRpbmdzCiAgICovCiAgLyogZXNsaW50LWRpc2FibGUgKi8KICBUcmFuc2l0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7CiAgICAvL2ltcGxlbWVudGF0aW9uIHVzaW5nIHNldHRpbmdzCiAgfTsKICAvKiBlc2xpbnQtZW5hYmxlICovCiAgLyoqCiAgICogUmV0dXJucyBhIGZhY3RvciBhc3NvY2lhdGVkIHdpdGggc2V0dGluZ3Mub2Zmc2V0IChAc2VlIFRyYW5zaXRpb25TZXR0aW5ncykgdGhhdAogICAqIGNhbiBiZSB1c2VmdWxsIGZvciBzb21lIGFuaW1hdGlvbnMuCiAgICoKICAgKiBAbWVtYmVyIFRyYW5zaXRpb24KICAgKiBAcGFyYW0ge1RyYW5zaXRpb25TZXR0aW5nc30gc2V0dGluZ3MgIHRyYW5zaXRpb24gc2V0dGluZ3MKICAgKiBAcmV0dXJuIFRoZSBmYWN0b3I7IDEgaWYgb2Zmc2V0IGlzIGhpZ2hlciB0aGFuIDAsIC0xIG90aGVyd2lzZQogICAqIEB0eXBlIE51bWJlcgogICAqLwogIFRyYW5zaXRpb24ucHJvdG90eXBlLmZhY3RvciA9IGZ1bmN0aW9uIChzZXR0aW5ncykgewogICAgcmV0dXJuIHNldHRpbmdzLm9mZnNldCA+IDAgPyAxIDogLTE7CiAgfTsKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgdXNlZCBieSBjYXJvdXNlbHMgdG8gY2hhbmdlIHNsaWRlcy4KICAgKgogICAqIEltcG9ydGFudDogc2V0dGluZ3MuY2FsbGJhY2soKSAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpIGhhdmUgdG8gYmUgY2FsbGVkIGF0IHRoZSBlbmQgb2YgdGhpcyBtZXRob2QgZXhlY3V0aW9uLgogICAqCiAgICogQG1lbWJlciBUcmFuc2l0aW9uCiAgICogQHBhcmFtIHtUcmFuc2l0aW9uU2V0dGluZ3N9IHNldHRpbmdzICB0cmFuc2l0aW9uIHNldHRpbmdzCiAgICovCiAgVHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uIChzZXR0aW5ncykgewogICAgc2V0dGluZ3MuY2FsbGJhY2soKTsKICB9OwogIC8qKgogICAqIEVuZCBvZiBUcmFuc2l0aW9uIGNsYXNzCiAgICovCiAgcHViLlRyYW5zaXRpb24gPSBUcmFuc2l0aW9uOwoKICAvKioKICAgKiBCYXNpY1RyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgd2l0aG91dCBhbnkgYW5pbWF0aW9uLgogICAqIERvIG5vdCByZW1vdmUgdGhpcyBjbGFzcywgYmVjYXVzZSBjYXJvdXNlbHMgdXNlIGl0IGJ5IGRlZmF1bHQsCiAgICogaWYgcmVxdWVzdGVkIHRyYW5zaXRpb24gY2Fubm90IGJlIGZvdW5kLgogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIEJhc2ljVHJhbnNpdGlvbigpIHt9CiAgQmFzaWNUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7CiAgQmFzaWNUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gQmFzaWNUcmFuc2l0aW9uOwogIC8qKgogICAqIEBtZW1iZXIgQmFzaWNUcmFuc2l0aW9uCiAgICovCiAgQmFzaWNUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7CiAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsKICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOwoKICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7CiAgfTsKICAvKioKICAgKiBFbmQgb2YgQmFzaWNUcmFuc2l0aW9uIGNsYXNzCiAgICovCiAgcHViLkJhc2ljVHJhbnNpdGlvbiA9IEJhc2ljVHJhbnNpdGlvbjsKCiAgLyoqCiAgICogRmFkZUluVHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyBieSBmYWRpbmcgaW4gbmV3IHNsaWRlLgogICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgZWZmZWN0IGlzIG5vdCB1c2VkLgogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIEZhZGVJblRyYW5zaXRpb24oKSB7fQogIEZhZGVJblRyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsKICBGYWRlSW5UcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gRmFkZUluVHJhbnNpdGlvbjsKICAvKioKICAgKiBAbWVtYmVyIEZhZGVJblRyYW5zaXRpb24KICAgKi8KICBGYWRlSW5UcmFuc2l0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkgewogICAgLypzZXR0aW5ncy4kc2xpZGVzLmNzcyh7CiAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsCiAgICAgICAgICd0b3AnOiAnMHB4JywKICAgICAgICAgJ2xlZnQnOiAnMHB4JwogICAgICAgICB9KTsqLwogIH07CiAgLyoqCiAgICogQG1lbWJlciBGYWRlSW5UcmFuc2l0aW9uCiAgICovCiAgRmFkZUluVHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uIChzZXR0aW5ncykgewogICAgdmFyIHpJbmRleEF0dHJpYiA9ICJ6LWluZGV4IiwKICAgICAgJHBhcmVudCA9IHNldHRpbmdzLiRzbGlkZXMucGFyZW50KCksCiAgICAgICRuZXh0U2xpZGUgPSBzZXR0aW5ncy4kbmV4dFNsaWRlOwoKICAgICRwYXJlbnQuY3NzKHpJbmRleEF0dHJpYiwgMCk7CiAgICAkbmV4dFNsaWRlLmNzcyh6SW5kZXhBdHRyaWIsIDEpOwogICAgc2V0dGluZ3MuJHNsaWRlcy5jc3MoewogICAgICBwb3NpdGlvbjogInJlbGF0aXZlIiwKICAgIH0pOwoKICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsKICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgIHRvcDogIjAiLAogICAgICBib3R0b206ICIwIiwKICAgICAgbGVmdDogIjAiLAogICAgICByaWdodDogIjAiLAogICAgfSk7CgogICAgJG5leHRTbGlkZS5mYWRlSW4oZnVuY3Rpb24gKCkgewogICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsKCiAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsKICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIiwKICAgICAgICBsZWZ0OiAiMCIsCiAgICAgICAgdHJhbnNmb3JtOiAibm9uZSIsCiAgICAgIH0pOwoKICAgICAgJG5leHRTbGlkZS5jc3MoekluZGV4QXR0cmliLCAiIik7CiAgICAgICRwYXJlbnQuY3NzKHpJbmRleEF0dHJpYiwgIiIpOwoKICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsKICAgIH0pOwogIH07CiAgLyoqCiAgICogRW5kIG9mIEZhZGVJblRyYW5zaXRpb24gY2xhc3MKICAgKi8KICBwdWIuRmFkZUluVHJhbnNpdGlvbiA9IEZhZGVJblRyYW5zaXRpb247CgogIC8qKgogICAqIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyBieSBzbGlkaW5nIHRoZW0gaG9yaXpvbnRhbGx5LgogICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgZWZmZWN0IGlzIG5vdCB1c2VkLgogICAqIElmIG9mZnNldCAoZGlmZmVyZW5jZSBiZXR3ZWVuIGluZGV4IG9mIGN1cnJlbnRseSBkaXNwbGF5ZWQgc2xpZGUgYW5kIGluZGV4IG9mIHNsaWRlIHRoYXQgd2lsbCBiZSBzaG93bikKICAgKiBpcyBncmVhdGVyIHRoYW4gMCwgc2xpZGVzIGFyZSBzbGlkaW5nIHRvIHRoZSBsZWZ0LiBPdGhlcndpc2UgKG9mZnNldCBpcyBsb3dlciB0aGFuIDApLCBzbGlkZXMgYXJlIHNsaWRpbmcKICAgKiB0byB0aGUgcmlnaHQuCiAgICogV2hlbiBzbGlkZSBjaGFuZ2UgaXMgcmFpc2VkIGF1dG9tYXRpY2FsbHksIHNsaWRlcyBhcmUgYWx3YXlzIHNsaWRpbmcgdG8gcmlnaHQgKG9mZnNldCA9PSAxKS4KICAgKiBJZiB1c2VyIHJhaXNlcyBzbGlkZXMgY2hhbmdlLCBzbGlkZXMgYXJlIHNsaWRpbmc6CiAgICogLSB0byBsZWZ0LCBpZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIDAgKHNsaWRlIHdpdGggaGlnaGVyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3MgJ25leHQnIG5hdmlnYXRpb24gaXRlbSksCiAgICogLSB0byByaWdodCwgaWYgb2Zmc2V0IGlzIGxvd2VyIHRoYW4gMCAoc2xpZGUgd2l0aCBsb3dlciBpbmRleCB3aWxsIGJlIHNob3duIG9yIHVzZXIgY2xpY2tzICdwcmV2JyBuYXZpZ2F0aW9uIGl0ZW0pLgogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbigpIHt9CiAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7CiAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uOwogIC8qKgogICAqIEBtZW1iZXIgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uCiAgICovCiAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5vbkFuaW1hdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24gKAogICAgc2V0dGluZ3MsCiAgICAkcGFyZW50CiAgKSB7CiAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsKICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsKICAgICAgdG9wOiAiIiwKICAgICAgYm90dG9tOiAiIiwKICAgICAgbGVmdDogIiIsCiAgICAgIHBvc2l0aW9uOiAiIiwKICAgICAgd2lkdGg6ICIiLAogICAgfSk7CgogICAgJHBhcmVudC5jc3MoewogICAgICBsZWZ0OiAiIiwKICAgIH0pOwoKICAgICRwYXJlbnQuY3NzKCJtYXJnaW4tbGVmdCIsICIiKTsKCiAgICBzZXR0aW5ncy5jYWxsYmFjaygpOwogIH07CiAgLyoqCiAgICogQG1lbWJlciBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24KICAgKi8KICBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbiAoc2V0dGluZ3MsIG9mZnNldCkgewogICAgdmFyIGZhY3RvciA9IHRoaXMuZmFjdG9yKHNldHRpbmdzKSwKICAgICAgb25BbmltYXRpb25Db21wbGV0ZSA9IHRoaXMub25BbmltYXRpb25Db21wbGV0ZSwKICAgICAgd2lkdGggPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlLndpZHRoKCksCiAgICAgICRwYXJlbnQgPSBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpOwoKICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsKICAgICAgdG9wOiAiMCIsCiAgICAgIGJvdHRvbTogIjAiLAogICAgICBsZWZ0OiAiMTAwJSIsCiAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICB3aWR0aDogIjEwMCUiLAogICAgfSk7CiAgICBpZiAob2Zmc2V0ID4gMCkgewogICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7CiAgICAgICAgbGVmdDogIjEwMCUiLAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsKICAgICAgICBsZWZ0OiAiLTEwMCUiLAogICAgICB9KTsKICAgIH0KICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOwogICAgJHBhcmVudC5hbmltYXRlKAogICAgICB7CiAgICAgICAgbGVmdDogLWZhY3RvciAqIHdpZHRoICsgInB4IiwKICAgICAgfSwKICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUoc2V0dGluZ3MsICRwYXJlbnQpOwogICAgICB9CiAgICApOwogIH07CiAgLyoqCiAgICogRW5kIG9mIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiBjbGFzcwogICAqLwogIHB1Yi5TbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gPSBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb247CgogIC8qKgogICAqIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgYnkgc2xpZGluZyB0aGVtIHZlcnRpY2FsbHkuCiAgICogVGhpcyBjbGFzcyBjYW4gYmUgcmVtb3ZlZCBpZiB0aGlzIGVmZmVjdCBpcyBub3QgdXNlZC4KICAgKiBJZiBvZmZzZXQgKGRpZmZlcmVuY2UgYmV0d2VlbiBpbmRleCBvZiBjdXJyZW50bHkgZGlzcGxheWVkIHNsaWRlIGFuZCBpbmRleCBvZiBuZXh0IHNsaWRlKQogICAqIGlzIGdyZWF0ZXIgdGhhbiAwLCBzbGlkZXMgYXJlIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duLiBPdGhlcndpc2UgKG9mZnNldCBpcyBsb3dlciB0aGFuIDApLCBzbGlkZXMgYXJlIHNsaWRpbmcKICAgKiBmcm9tIGRvd24gdG8gdXAuCiAgICogV2hlbiBzbGlkZSBjaGFuZ2UgaXMgcmFpc2VkIGF1dG9tYXRpY2FsbHksIHNsaWRlcyBhcmUgYWx3YXlzIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duIChvZmZzZXQgPT0gMSkuCiAgICogSWYgdXNlciByYWlzZXMgc2xpZGVzIGNoYW5nZSwgc2xpZGVzIGFyZSBzbGlkaW5nOgogICAqIC0gZnJvbSB1cCB0byBkb3duLCBpZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIDAgKHNsaWRlIHdpdGggaGlnaGVyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3MgJ25leHQnIG5hdmlnYXRpb24gaXRlbSksCiAgICogLSBmcm9tIGRvd24gdG8gdXAsIGlmIG9mZnNldCBpcyBsb3dlciB0aGFuIDAgKHNsaWRlIHdpdGggbG93ZXIgaW5kZXggd2lsbCBiZSBzaG93biBvciB1c2VyIGNsaWNrcyAncHJldicgbmF2aWdhdGlvbiBpdGVtKS4KICAgKiBAY29uc3RydWN0b3IKICAgKi8KICBmdW5jdGlvbiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uKCkge30KICBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7CiAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IFNsaWRlVmVydGljYWxseVRyYW5zaXRpb247CiAgLyoqCiAgICogQG1lbWJlciBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uCiAgICovCiAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUub25BbmltYXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uICgKICAgIHNldHRpbmdzLAogICAgJHBhcmVudAogICkgewogICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oaWRlKCk7CiAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7CiAgICAgIHRvcDogIiIsCiAgICAgIGJvdHRvbTogIiIsCiAgICAgIGxlZnQ6ICIiLAogICAgICByaWdodDogIiIsCiAgICAgIHBvc2l0aW9uOiAiIiwKICAgICAgd2lkdGg6ICIiLAogICAgfSk7CgogICAgJHBhcmVudC5jc3MoInRvcCIsICIiKTsKICAgICRwYXJlbnQuY3NzKCJtYXJnaW4tdG9wIiwgIiIpOwoKICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7CiAgfTsKICAvKioKICAgKiBAbWVtYmVyIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24KICAgKi8KICBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24gKHNldHRpbmdzLCBvZmZzZXQpIHsKICAgIHZhciBmYWN0b3IgPSB0aGlzLmZhY3RvcihzZXR0aW5ncyksCiAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUgPSB0aGlzLm9uQW5pbWF0aW9uQ29tcGxldGUsCiAgICAgIGhlaWdodCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGVpZ2h0KCksCiAgICAgICRwYXJlbnQgPSBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpOwoKICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsKICAgICAgbGVmdDogIjAiLAogICAgICByaWdodDogIjAiLAogICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgd2lkdGg6ICIxMDAlIiwKICAgIH0pOwogICAgaWYgKG9mZnNldCA+IDApIHsKICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3MoewogICAgICAgIHRvcDogIi0xMDAlIiwKICAgICAgICBib3R0b206ICIxMDAlIiwKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7CiAgICAgICAgdG9wOiAiMTAwJSIsCiAgICAgICAgYm90dG9tOiAiLTEwMCUiLAogICAgICB9KTsKICAgIH0KICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOwoKICAgICRwYXJlbnQuYW5pbWF0ZSgKICAgICAgewogICAgICAgIHRvcDogZmFjdG9yICogaGVpZ2h0LAogICAgICB9LAogICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZShzZXR0aW5ncywgJHBhcmVudCk7CiAgICAgIH0KICAgICk7CiAgfTsKICAvKioKICAgKiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIGNsYXNzCiAgICovCiAgcHViLlNsaWRlVmVydGljYWxseVRyYW5zaXRpb24gPSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uOwoKICByZXR1cm4gcHViOwp9KShqUXVlcnkpOwovKioKICogZW5kIG9mIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgbW9kdWxlLgogKi8KCi8qKgogKiBYQUNvbnRleHQKICoKICogWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cyBtb2R1bGUuCiAqCiAqIEV4cG9zZXMgVmlldyBjbGFzcywgd2hpY2ggaXMgYSBiYXNlIGNsYXNzIG9mIGFsbCAndGltZSBpbmRpY2F0b3InIHZpZXdzIHVzZWQgYnkgY2Fyb3VzZWxzIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMsIEBzZWUgVmlldykuCiAqIEFsc28gZXhwb3NlcyBpbXBsZW1lbnRhdGlvbiBvZiB0aGVzZSAndGltZSBpbmRpY2F0b3InIHZpZXdzOgogKiAtIFByb2dyZXNzQmFyVmlldyAtIHNob3dzIHRoZSBwcm9ncmVzcyBvZiB0aW1lIHdpdGggYSBwcm9ncmVzcyBiYXIsCiAqIC0gUm90YXRvclZpZXcgLSBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSB3aXRoIHRoZSBmaWxsaW5nIHVwIHJpbmcuCiAqIENhcm91c2VsIHRha2VzIHRoZSBjbGFzcyBjb25zdHJ1Y3RvciBieSBuYW1lIGZyb20gdGhpcyBtb2R1bGUgKGl0IGlzIGdpdmVuIGluIG9wdGlvbnMgb2JqZWN0IG9mIGNhcm91c2VsOyBAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMpLgogKiBJZiB0aGVyZSBpcyBhIG5lZWQgdG8gaW1wbGVtZW50IHRoZSBuZXcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3LCBjcmVhdGUgYSBuZXcgY2xhc3MKICogYnkgaW5oZXJpdGluZyBmcm9tIFZpZXcgY2xhc3MgYW5kIGFkZCBpdCB0byB0aGlzIG1vZHVsZS4gRHVyaW5nIGltcGxlbWVudGF0aW9uIG9mIGEgbmV3ICd0aW1lIGluZGljYXRvcicKICogdmlldyB0aGUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JzVmlldy5Ub29scyBuYW1lc3BhY2UuIEl0IGNvbnRhaW5zOgogKiAtIGlzQ3NzU3VwcG9ydGVkKHByb3BzKSBmdW5jdGlvbiwgd2hpY2ggY2hlY2tzIGlmIGFueSBvZiBDU1MgcHJvcGVydGllcyBpcyBzdXBwb3J0ZWQgKHByb3BzIC0gYXJyYXkgb2YgcHJvcGVydGllcyksCiAqIC0gaXNUcmFuc2Zvcm1TdXBwb3J0ZWQoKSBmdW5jdGlvbiwgd2hpY2ggY2hlY2tzIGlmIENTUyAzICd0cmFuc2Zvcm0nIGlzIHN1cHBvcnRlZC4KICoKICogRXhhbXBsZSB2aWV3IGltcGxlbWVudGF0aW9uIChvcGFjaXR5IGluY3JlYXNlcyB3aXRoIGEgcHJvZ3Jlc3Mgb2YgdGhlIHRpbWUpOgogKiAoZnVuY3Rpb24oKSB7CiAqICAgICB2YXIgVmlldyA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVmlldzsKICoKICogICAgIGZ1bmN0aW9uIFNhbXBsZVZpZXcgKHNlbGVjdG9yLCBvcHRpb25zKSB7CiAqICAgICAgICAgLy9iYXNlIGNvbnN0cnVjdG9yIGhhdmUgdG8gYmUgY2FsbGVkCiAqICAgICAgICAgVmlldy5jYWxsKHRoaXMsIHNlbGVjdG9yKTsKICogICAgIH0KICoKICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlID0gbmV3IFZpZXcoKTsKICogICAgIFNhbXBsZVZpZXcuY29uc3RydWN0b3IgPSBTYW1wbGVWaWV3OwogKgogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICh0aW1lb3V0KSB7CiAqICAgICAgICAgLy9iYXNlIG1ldGhvZCBoYXZlIHRvIGJlIGNhbGxlZAogKiAgICAgICAgIFZpZXcucHJvdG90eXBlLmluaXQuY2FsbCh0aGlzLCB0aW1lb3V0KTsKICoKICogICAgICAgICAvL2luaXRpYWxpemF0aW9uIGNvZGUgLSBub3QgbmVlZGVkIGluIHRoaXMgZXhhbXBsZQogKiAgICAgfTsKICoKICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewogKiAgICAgICAgIC8vYmFzZSBtZXRob2QgaGF2ZSB0byBiZSBjYWxsZWQKICogICAgICAgICBWaWV3LnByb3RvdHlwZS5yZXNldC5jYWxsKHRoaXMpOwogKgogKiAgICAgICAgIC8vcmVzZXRpbmcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3CiAqICAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7CiAqICAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmNzcygnb3BhY2l0eScsIDApOwogKiAgICAgfTsKICoKICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkgewogKiAgICAgICAgIC8vc3RvcGluZyAndGltZSBpbmRpY2F0b3InIHZpZXcgYW5pbWF0aW9uCiAqICAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7CiAqICAgICB9OwogKgogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uICgpIHsKICogICAgICAgICAvL3N0YXJ0aW5nL3Jlc3VtaW5nICd0aW1lIGluZGljYXRvcicgdmlldyBhbmltYXRpb24KICogICAgICAgICB0aGlzLiRpbmRpY2F0b3IuYW5pbWF0ZSh7CiAqICAgICAgICAgICAgICdvcGFjaXR5JzogMQogKiAgICAgICAgIH0sIHRoaXMudGltZW91dCAtIHRoaXMudGltZUVsYXBzZWQsICdsaW5lYXInKTsKICogICAgIH07CiAqCiAqICAgICBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlNhbXBsZVZpZXcgPSBTYW1wbGVWaWV3OwogKiB9KCkpOwogKgogKi8KWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cyA9IChmdW5jdGlvbiAoJCkgewogIHZhciBwdWIgPSB7fSwKICAgIHN1cHBvcnRFbGVtZW50U3R5bGUgPSBudWxsOwoKICAvKioKICAgKiBDaGVja3MgaWYgdGhlIENTUyBwcm9wZXJ0aWVzIGFyZSBzdXBwb3J0ZWQuCiAgICoKICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyAgICAgYXJyYXkgb2YgcHJvcGVydGllcyB0byBiZSBjaGVja2VkCiAgICogQHJldHVybiB0cnVlIGlmIGFueSBvZiBDU1MgcHJvcGVydGllcyBpcyBzdXBwb3J0ZWQsIGZhbHNlIG90aGVyd2lzZQogICAqIEB0eXBlIEJvb2xlYW4KICAgKi8KICBmdW5jdGlvbiBpc0Nzc1N1cHBvcnRlZChwcm9wcykgewogICAgdmFyIGksCiAgICAgIGlzU3VwcG9ydGVkID0gZmFsc2U7CgogICAgaWYgKHN1cHBvcnRFbGVtZW50U3R5bGUgPT09IG51bGwpIHsKICAgICAgc3VwcG9ydEVsZW1lbnRTdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN1cHBvcnRFbGVtZW50Iikuc3R5bGU7CiAgICB9CgogICAgZm9yIChpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChzdXBwb3J0RWxlbWVudFN0eWxlW3Byb3BzW2ldXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaXNTdXBwb3J0ZWQgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGlzU3VwcG9ydGVkOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIENTUyAzICd0cmFuc2Zvcm0nIGlzIHN1cHBvcnRlZC4KICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiBDU1MgMyAndHJhbnNmb3JtJyBpcyBzdXBwb3J0ZWQsIGZhbHNlIG90aGVyd2lzZQogICAqIEB0eXBlIEJvb2xlYW4KICAgKi8KICBmdW5jdGlvbiBpc1RyYW5zZm9ybVN1cHBvcnRlZCgpIHsKICAgIHJldHVybiBpc0Nzc1N1cHBvcnRlZChbCiAgICAgICJ0cmFuc2Zvcm1Qcm9wZXJ0eSIsCiAgICAgICJXZWJraXRUcmFuc2Zvcm0iLAogICAgICAiTW96VHJhbnNmb3JtIiwKICAgICAgIk9UcmFuc2Zvcm0iLAogICAgICAibXNUcmFuc2Zvcm0iLAogICAgXSk7CiAgfQoKICAvKioKICAgICAqIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVG9vbHMgbmFtZXNwYWNlCiAgICAgKgogICAgIFRoaXMgbmFtZXNwYWNlIGNhbiBiZSByZW1vdmVkIGlmIFJvdGF0b3JWaWV3IGNsYXNzIGlzIG5vdCB1c2VkIChAc2VlIFJvdGF0b3JWaWV3KQogICAgICovCiAgcHViLlRvb2xzID0ge307CiAgcHViLlRvb2xzLmlzQ3NzU3VwcG9ydGVkID0gaXNDc3NTdXBwb3J0ZWQ7CiAgcHViLlRvb2xzLmlzVHJhbnNmb3JtU3VwcG9ydGVkID0gaXNUcmFuc2Zvcm1TdXBwb3J0ZWQ7CiAgLyoqCiAgICogRW5kIG9mIG5hbWVzcGFjZQogICAqLwoKICAvKioKICAgKiBWaWV3IGNsYXNzIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3cwogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBhIHNlbGVjdG9yIHVzZWQgZm9yIHNlYXJjaGluZwogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgVmlldyBvcHRpb25zIG9iamVjdAogICAqLwogIC8qIGVzbGludC1kaXNhYmxlICovCiAgZnVuY3Rpb24gVmlldyhzZWxlY3Rvciwgb3B0aW9ucykgewogICAgLyoqCiAgICAgKiBBIGpRdWVyeSBvYmplY3QgY29udGFpbmluZyBlbGVtZW50IHRoYXQgd2lsbCBiZSBhbmltYXRlZCB0byBzaG93IHRpbWUgcHJvZ3Jlc3MuCiAgICAgKgogICAgICogQG1lbWJlciBWaWV3CiAgICAgKi8KCiAgICB0aGlzLiRpbmRpY2F0b3IgPSAkKHNlbGVjdG9yKTsKICB9CiAgLyogZXNsaW50LWVuYWJsZSAqLwogIC8qKgogICAqIEluaXRpYWxpemVzIHRoZSB2aWV3LgogICAqCiAgICogQG1lbWJlciBWaWV3aW9uCiAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgICBhIHRpbWVvdXQgdG8gdGhlIGVuZCBvZiB3aG9sZSBpbmRpY2F0b3IgYW5pbWF0aW9uCiAgICovCiAgVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICh0aW1lb3V0KSB7CiAgICB0aGlzLnRpbWVFbGFwc2VkID0gMDsKICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7CiAgfTsKICAvKioKICAgKiBSZXNldHMgdGhlIHZpZXcKICAgKgogICAqIEBtZW1iZXIgVmlldwogICAqLwogIFZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy50aW1lRWxhcHNlZCA9IDA7CiAgfTsKICAvKioKICAgKiBTdGFydHMvUmVuZXdzIHRoZSB2aWV3IGFuaW1hdGlvbi4KICAgKgogICAqIEBtZW1iZXIgVmlldwogICAqLwogIFZpZXcucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoKSB7fTsKICAvKioKICAgKiBQYXVzZXMgdGhlIHZpZXcgYW5pbWF0aW9uLgogICAqCiAgICogQG1lbWJlciBWaWV3CiAgICovCiAgVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7fTsKICAvKioKICAgKiBVcGRhdGVzIHRoZSB0aW1lIHRoYXQgZWxhcHNlZCBzaW5jZSBhbmltYXRpb24gYmVnYW4uCiAgICoKICAgKiBAbWVtYmVyIFZpZXcKICAgKi8KICBWaWV3LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAodGltZUVsYXBzZWQpIHsKICAgIHRoaXMudGltZUVsYXBzZWQgPSB0aW1lRWxhcHNlZDsKICB9OwogIC8qKgogICAqIGVuZCBvZiBWaWV3IGNsYXNzCiAgICovCiAgcHViLlZpZXcgPSBWaWV3OwoKICAvKioKICAgKiBQcm9ncmVzc0JhclZpZXcgY2xhc3MgcHJvdmlkZXMgYSBsb2dpYyBmb3IgYW5pbWF0ZSBhICd0aW1lIGluZGljYXRvcicsCiAgICogdGhhdCBsb29rcyBsaWtlIHByb2dyZXNzIGJhci4KICAgKgogICAqIE9wdGlvbnMgb2JqZWN0OgogICAqIHsKICAgKiAgICAgJ29wYWNpdHknOiBOdW1iZXIgdmFsdWUgLy9iZXR3ZWVuIDAgYW5kIDE7IGRlZmF1bHQgaXMgMC44CiAgICogfQogICAqCiAgICogVGhpcyBjbGFzcyBjYW4gYmUgcmVtb3ZlZCBpZiB0aGlzIGtpbmQgb2YgdmlldyBpcyBub3QgdXNlZC4KICAgKgogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBhIHNlbGVjdG9yIHVzZWQgZm9yIHNlYXJjaGluZwogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgVmlldyBvcHRpb25zIG9iamVjdAogICAqLwogIGZ1bmN0aW9uIFByb2dyZXNzQmFyVmlldyhzZWxlY3Rvciwgb3B0aW9ucykgewogICAgVmlldy5jYWxsKHRoaXMsIHNlbGVjdG9yKTsKCiAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgIG9wYWNpdHk6IDAuOCwKICAgIH07CgogICAgdGhpcy5zZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7CgogICAgdGhpcy4kY29udGFpbmVyID0gdGhpcy4kaW5kaWNhdG9yOwogICAgdGhpcy4kaW5kaWNhdG9yID0gdGhpcy4kaW5kaWNhdG9yLmZpbmQoImRpdiIpOwogIH0KICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlID0gbmV3IFZpZXcoKTsKICBQcm9ncmVzc0JhclZpZXcuY29uc3RydWN0b3IgPSBQcm9ncmVzc0JhclZpZXc7CiAgLyoqCiAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcKICAgKi8KICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAodGltZW91dCkgewogICAgVmlldy5wcm90b3R5cGUuaW5pdC5jYWxsKHRoaXMsIHRpbWVvdXQpOwoKICAgIHZhciBvcGFjaXR5ID0gdGhpcy5zZXR0aW5ncy5vcGFjaXR5OwogICAgdGhpcy4kY29udGFpbmVyLmNzcygib3BhY2l0eSIsIG9wYWNpdHkpOwogICAgdGhpcy4kaW5kaWNhdG9yLmNzcygib3BhY2l0eSIsIG9wYWNpdHkpOwogIH07CiAgLyoqCiAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcKICAgKi8KICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewogICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsKCiAgICB0aGlzLiRpbmRpY2F0b3Iuc3RvcCh0cnVlKTsKICAgIHRoaXMuJGluZGljYXRvci5jc3MoIndpZHRoIiwgIjBweCIpOwogIH07CiAgLyoqCiAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcKICAgKi8KICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7CiAgfTsKICAvKioKICAgKiBAbWVtYmVyIFByb2dyZXNzQmFyVmlldwogICAqLwogIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuJGluZGljYXRvci5hbmltYXRlKAogICAgICB7CiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgfSwKICAgICAgdGhpcy50aW1lb3V0IC0gdGhpcy50aW1lRWxhcHNlZCwKICAgICAgImxpbmVhciIKICAgICk7CiAgfTsKICAvKioKICAgKiBlbmQgb2YgUHJvZ3Jlc3NCYXJWaWV3IGNsYXNzCiAgICovCiAgcHViLlByb2dyZXNzQmFyVmlldyA9IFByb2dyZXNzQmFyVmlldzsKCiAgLyoqCiAgICogUm90YXRvclZpZXcgY2xhc3MgcHJvdmlkZXMgYSBsb2dpYyBmb3IgYW5pbWF0ZSBhICd0aW1lIGluZGljYXRvcicsCiAgICogdGhhdCBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSB3aXRoIHRoZSBmaWxsaW5nIHVwIHJpbmcKICAgKgogICAqIE9wdGlvbnMgb2JqZWN0OgogICAqIHsKICAgKiAgICAgJ29wYWNpdHknOiBOdW1iZXIgdmFsdWUgLy9iZXR3ZWVuIDAgYW5kIDE7IGRlZmF1bHQgaXMgMC41CiAgICogfQogICAqCiAgICogVGhpcyBjbGFzcyBjYW4gYmUgcmVtb3ZlZCBpZiB0aGlzIGtpbmQgb2YgdmlldyBpcyBub3QgdXNlZC4KICAgKgogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBhIHNlbGVjdG9yIHVzZWQgZm9yIHNlYXJjaGluZwogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgVmlldyBvcHRpb25zIG9iamVjdAogICAqLwogIGZ1bmN0aW9uIFJvdGF0b3JWaWV3KHNlbGVjdG9yLCBvcHRpb25zKSB7CiAgICBWaWV3LmNhbGwodGhpcywgc2VsZWN0b3IpOwoKICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgb3BhY2l0eTogMC41LAogICAgfTsKCiAgICB0aGlzLnNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsKICAgIHRoaXMuJG1hc2sgPSB0aGlzLiRpbmRpY2F0b3IuZmluZCgic3Bhbi5tYXNrIikuZmlyc3QoKTsKICAgIHRoaXMuJHJvdGF0b3IgPSB0aGlzLiRpbmRpY2F0b3IuZmluZCgic3Bhbi5yb3RhdG9yIikuZmlyc3QoKTsKCiAgICBmdW5jdGlvbiByb3RhdGVDc3MoZGVnKSB7CiAgICAgIHZhciB2YWx1ZSA9ICJyb3RhdGUoIiArIGRlZyArICJkZWcpIjsKCiAgICAgIHJldHVybiB7CiAgICAgICAgIi13ZWJraXQtdHJhbnNmb3JtIjogdmFsdWUsCiAgICAgICAgIi1tb3otdHJhbnNmb3JtIjogdmFsdWUsCiAgICAgICAgIi1vLXRyYW5zZm9ybSI6IHZhbHVlLAogICAgICAgICItbXMtdHJhbnNmb3JtIjogdmFsdWUsCiAgICAgICAgdHJhbnNmb3JtOiB2YWx1ZSwKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbmltYXRlUm90YXRvcigkcm90YXRvciwgb3B0aW9ucykgewogICAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgICBmb250U2l6ZTogIjE4MHB4IiwKICAgICAgICAgIGFuaW1hdGVPcHRpb25zOiB7CiAgICAgICAgICAgIHN0ZXA6IGZ1bmN0aW9uIChub3cpIHsKICAgICAgICAgICAgICAkcm90YXRvci5jc3Mocm90YXRlQ3NzKG5vdykpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBlYXNpbmc6ICJsaW5lYXIiLAogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsKCiAgICAgICRyb3RhdG9yLmFuaW1hdGUoCiAgICAgICAgewogICAgICAgICAgImZvbnQtc2l6ZSI6IHNldHRpbmdzLmZvbnRTaXplLAogICAgICAgIH0sCiAgICAgICAgc2V0dGluZ3MuYW5pbWF0ZU9wdGlvbnMKICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwaGFzZVR3b0FuaW1hdGlvbigkbWFzaywgJHJvdGF0b3IsIGR1cmF0aW9uKSB7CiAgICAgICRyb3RhdG9yLmFkZENsYXNzKCJoYWxmIik7CiAgICAgICRtYXNrLmFkZENsYXNzKCJoYWxmIik7CgogICAgICBhbmltYXRlUm90YXRvcigkcm90YXRvciwgewogICAgICAgIGZvbnRTaXplOiAiMzYwcHgiLAogICAgICAgIGFuaW1hdGVPcHRpb25zOiB7CiAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sCiAgICAgICAgfSwKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gcGhhc2VPbmVBbmltYXRpb24oJG1hc2ssICRyb3RhdG9yLCBkdXJhdGlvbiwgcGhhc2VUd29EdXJhdGlvbikgewogICAgICBhbmltYXRlUm90YXRvcigkcm90YXRvciwgewogICAgICAgIGFuaW1hdGVPcHRpb25zOiB7CiAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sCiAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBwaGFzZVR3b0FuaW1hdGlvbigkbWFzaywgJHJvdGF0b3IsIHBoYXNlVHdvRHVyYXRpb24pOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICB9KTsKICAgIH0KCiAgICB0aGlzLnJlc2V0Q3NzID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLiRyb3RhdG9yLnJlbW92ZUNsYXNzKCJoYWxmIik7CiAgICAgIHRoaXMuJHJvdGF0b3IuY3NzKHJvdGF0ZUNzcygwKSk7CiAgICAgIHRoaXMuJHJvdGF0b3IuY3NzKCJmb250LXNpemUiLCAiMHB4Iik7CgogICAgICB0aGlzLiRtYXNrLnJlbW92ZUNsYXNzKCJoYWxmIik7CiAgICB9OwoKICAgIHRoaXMucGxheVBoYXNlT25lID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLnRpbWVvdXQgLyAyIC0gdGhpcy50aW1lRWxhcHNlZDsKICAgICAgcGhhc2VPbmVBbmltYXRpb24odGhpcy4kbWFzaywgdGhpcy4kcm90YXRvciwgZHVyYXRpb24sIHRoaXMudGltZW91dCAvIDIpOwogICAgfTsKCiAgICB0aGlzLnBsYXlQaGFzZVR3byA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGR1cmF0aW9uID0gdGhpcy50aW1lb3V0IC0gdGhpcy50aW1lRWxhcHNlZDsKICAgICAgcGhhc2VUd29BbmltYXRpb24odGhpcy4kbWFzaywgdGhpcy4kcm90YXRvciwgZHVyYXRpb24pOwogICAgfTsKICB9CiAgUm90YXRvclZpZXcucHJvdG90eXBlID0gbmV3IFZpZXcoKTsKICBSb3RhdG9yVmlldy5jb25zdHJ1Y3RvciA9IFJvdGF0b3JWaWV3OwogIC8qKgogICAqIEBtZW1iZXIgUm90YXRvclZpZXcKICAgKi8KICBSb3RhdG9yVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICh0aW1lb3V0KSB7CiAgICBWaWV3LnByb3RvdHlwZS5pbml0LmNhbGwodGhpcywgdGltZW91dCk7CgogICAgaWYgKGlzVHJhbnNmb3JtU3VwcG9ydGVkKCkpIHsKICAgICAgdGhpcy4kaW5kaWNhdG9yLnNob3coKTsKICAgICAgdGhpcy4kbWFzay5jc3MoIm9wYWNpdHkiLCB0aGlzLnNldHRpbmdzLm9wYWNpdHkpOwogICAgfQogIH07CiAgLyoqCiAgICogQG1lbWJlciBSb3RhdG9yVmlldwogICAqLwogIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHsKICAgIFZpZXcucHJvdG90eXBlLnJlc2V0LmNhbGwodGhpcyk7CgogICAgdGhpcy4kcm90YXRvci5zdG9wKHRydWUpOwogICAgdGhpcy5yZXNldENzcygpOwogIH07CiAgLyoqCiAgICogQG1lbWJlciBSb3RhdG9yVmlldwogICAqLwogIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuJHJvdGF0b3Iuc3RvcCh0cnVlKTsKICB9OwogIC8qKgogICAqIEBtZW1iZXIgUm90YXRvclZpZXcKICAgKi8KICBSb3RhdG9yVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBwaGFzZSA9IHRoaXMucGxheVBoYXNlT25lOwogICAgaWYgKHRoaXMudGltZUVsYXBzZWQgPj0gdGhpcy50aW1lb3V0IC8gMikgewogICAgICBwaGFzZSA9IHRoaXMucGxheVBoYXNlVHdvOwogICAgfQoKICAgIHBoYXNlLmNhbGwodGhpcyk7CiAgfTsKICAvKioKICAgKiBlbmQgb2YgUm90YXRvclZpZXcgY2xhc3MKICAgKi8KICBwdWIuUm90YXRvclZpZXcgPSBSb3RhdG9yVmlldzsKCiAgcmV0dXJuIHB1YjsKfSkoalF1ZXJ5KTsKLyoqCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzIG1vZHVsZS4KICovCg==
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 55636
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20180226T092340Z
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "d63831a6-30d6-49f0-b7b5-8de09178517a"
