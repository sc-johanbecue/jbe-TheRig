---
ID: "fbbe5143-27e9-41e2-953a-3b2774715414"
Parent: "0ce66648-1912-4e35-b478-706615a5dde5"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: /sitecore/media library/Base Themes/Variants/Scripts/variantswitcher
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/FBBE514327E941E2953A3B2774715414.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "fbbe5143-27e9-41e2-953a-3b2774715414"
  Value: aWYgKHR5cGVvZiAoJHhhKSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICR4YS52YXJpYW50c3dpdGNoZXIgPSAoZnVuY3Rpb24gKCQpIHsKICAgICAgICB2YXIgcHViID0ge307CiAgICAgICAgCiAgICAgICAgdmFyIGJ1aWxkVmFyaWFudEh0bWwgPSBmdW5jdGlvbiAodmFyaWFudCwgY3VycmVudFZhcmlhbnQpIHsKICAgICAgICAgICAgdmFyIGltZywgZGl2LCB2YXJpYW50SXRlbTsKCiAgICAgICAgICAgIGlmICh2YXJpYW50LlRodW1ibmFpbCAhPT0gIiIpIHsKICAgICAgICAgICAgICAgIHZhcmlhbnRJdGVtID0gJCgiPGxpIGRhdGEtaWQ9JyIgKyB2YXJpYW50LklEICsgIicgY2xhc3M9J3ZhcmlhbnQtY29udGFpbmVyJz48L2xpPiIpOwogICAgICAgICAgICAgICAgaW1nV3JhcHBlciA9ICQoIjxkaXYgY2xhc3M9J2ltYWdlLXdyYXBwZXInPjxpbWcgZGF0YS1pZD0nIiArIHZhcmlhbnQuSUQgKyAiJyBjbGFzcz0ndmFyaWFudC10aHVtYm5haWwnIC8+PC9kaXY+Iik7CiAgICAgICAgICAgICAgICBpbWdXcmFwcGVyLmZpbmQoImltZyIpLmF0dHIoInNyYyIsIHZhcmlhbnQuVGh1bWJuYWlsKTsKICAgICAgICAgICAgICAgIGRpdiA9ICQoIjxkaXYgZGF0YS1pZD0nIiArIHZhcmlhbnQuSUQgKyAiJyBjbGFzcz0ndmFyaWFudC1uYW1lJz4iICsgdmFyaWFudC5EaXNwbGF5TmFtZSArICI8L2Rpdj4iKTsKICAgICAgICAgICAgICAgIHZhcmlhbnRJdGVtLmFwcGVuZChpbWdXcmFwcGVyKTsKICAgICAgICAgICAgICAgIHZhcmlhbnRJdGVtLmFwcGVuZChkaXYpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyaWFudEl0ZW0gPSAkKCI8bGkgZGF0YS1pZD0nIiArIHZhcmlhbnQuSUQgKyAiJz4iICsgdmFyaWFudC5EaXNwbGF5TmFtZSArICI8L2xpPiIpOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHZhcmlhbnQuSUQgPT0gY3VycmVudFZhcmlhbnQpIHsKICAgICAgICAgICAgICAgIHZhcmlhbnRJdGVtLmFkZENsYXNzKCJzZWxlY3RlZCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmFyaWFudEl0ZW07CiAgICAgICAgfQoKICAgICAgICB2YXIgaXNUaHVtYm5haWxFeGlzdCA9IGZ1bmN0aW9uKHZhcmlhbnRzKSB7CiAgICAgICAgICAgIHJldHVybiB2YXJpYW50cy5zb21lKGZ1bmN0aW9uKGVsZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLlRodW1ibmFpbC5sZW5ndGggPiAwOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBmaXhSZW5kZXJWYXJpYW50c0xpc3RIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzd2l0Y2hlclRvb2xiYXIgPSAkKCcuemctdmFyaWFudC1zd2l0Y2hlci10b29sYmFyJyksCiAgICAgICAgICAgICAgICBwb3NpdGlvbk1hbmFnZXIgPSBTaXRlY29yZS5QYWdlTW9kZXMuUG9zaXRpb25pbmdNYW5hZ2VyKCksCiAgICAgICAgICAgICAgICBzd2l0Y2hlciwKICAgICAgICAgICAgICAgIGNocm9tZU9mZnNldEJvdHRvbTsKCiAgICAgICAgICAgIGlmIChzd2l0Y2hlclRvb2xiYXIubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaGVyID0gc3dpdGNoZXJUb29sYmFyLmZpbmQoIi56Zy12YXJpYW50LXN3aXRjaGVyIik7CiAgICAgICAgICAgIGNocm9tZU9mZnNldEJvdHRvbSA9IHBvc2l0aW9uTWFuYWdlci52aWV3cG9ydFJlZ2lvbi5ib3R0b20gLSAoc3dpdGNoZXJUb29sYmFyLm9mZnNldCgpLnRvcCArIHN3aXRjaGVyVG9vbGJhci5oZWlnaHQoKSkgLSAzMDsKICAgICAgICAgICAgY2hyb21lT2Zmc2V0Qm90dG9tID0gY2hyb21lT2Zmc2V0Qm90dG9tIDwgMjAgPyAyMCA6IGNocm9tZU9mZnNldEJvdHRvbTsKICAgICAgICAgICAgc3dpdGNoZXIuZmluZCgnLnpnLXZhcmlhbnQtbGlzdCAuemctdmFyaWFudC1hdmFpbGFibGU+dWwnKS5jc3MoeyAnb3ZlcmZsb3cteSc6ICdhdXRvJywgJ21heC1oZWlnaHQnOiBNYXRoLmZsb29yKGNocm9tZU9mZnNldEJvdHRvbSkgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgdHJhbnNsYXRlRWxlbWVudCA9IGZ1bmN0aW9uIChodG1sRWxlbWVudCwgc2VsZWN0b3IsIHRleHRCZWZvcmUsIHRleHRBZnRlcikgewogICAgICAgICAgICBsZXQgaGVhZGVyID0gaHRtbEVsZW1lbnQuZmluZChzZWxlY3Rvcik7CiAgICAgICAgICAgIGxldCBoZWFkZXJUaXRsZSA9IGhlYWRlci50ZXh0KCkucmVwbGFjZSh0ZXh0QmVmb3JlLCB0ZXh0QWZ0ZXIpOwogICAgICAgICAgICBoZWFkZXIudGV4dChoZWFkZXJUaXRsZSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgdmFyaWFudFN3aXRjaGVyUGx1Z0luID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgb25TZWxlY3Rpb25VcGRhdGUsCiAgICAgICAgICAgICAgICBzd2l0Y2hlckNsYXNzID0gInpnLXZhcmlhbnQtc3dpdGNoZXIiLAogICAgICAgICAgICAgICAgc3dpdGNoZXJUb29sYmFyQ2xhc3MgPSAiemctdmFyaWFudC1zd2l0Y2hlci10b29sYmFyIiwKICAgICAgICAgICAgICAgIGV4cGFuZCwKICAgICAgICAgICAgICAgIGZyYW1lLAogICAgICAgICAgICAgICAgY29udHJvbHNEaXYsCiAgICAgICAgICAgICAgICBzaXRlTmFtZSA9IFhBLnF1ZXJ5U3RyaW5nLmdldFF1ZXJ5UGFyYW0oJ3NjX3NpdGUnKTsKCiAgICAgICAgICAgIG9uU2VsZWN0aW9uVXBkYXRlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gU2l0ZWNvcmUuUGFnZU1vZGVzLkNocm9tZU1hbmFnZXIuc2VsZWN0ZWRDaHJvbWUoKSwKICAgICAgICAgICAgICAgICAgICBzd2l0Y2hlckJveCA9ICQoIjxkaXY+IgogICAgICAgICAgICAgICAgICAgICAgICArICI8ZGl2IGNsYXNzPSd6Zy12YXJpYW50LWhlYWRlcic+VmFyaWFudDo8L2Rpdj4iCiAgICAgICAgICAgICAgICAgICAgICAgICsgIjxkaXYgY2xhc3M9J3pnLXZhcmlhbnQtbGlzdCc+IgogICAgICAgICAgICAgICAgICAgICAgICArICI8ZGl2IGNsYXNzPSd6Zy12YXJpYW50LWF2YWlsYWJsZSc+PHNwYW4gY2xhc3M9J3pnLXZhcmlhbnQtdGlwJz5TZWxlY3QgY29tcG9uZW50IHZhcmlhbnQ8L3NwYW4+PC9kaXY+IgogICAgICAgICAgICAgICAgICAgICAgICArICI8ZGl2IGNsYXNzPSd6Zy12YXJpYW50LXRvZ2dsZS1kcm9wZG93bic+PC9kaXY+IgogICAgICAgICAgICAgICAgICAgICAgICArICI8L2Rpdj4iCiAgICAgICAgICAgICAgICAgICAgICAgICsgIjwvZGl2PiIpLmFkZENsYXNzKHN3aXRjaGVyQ2xhc3MpOwogICAgICAgICAgICAgICAgc3dpdGNoZXJCb3guY3NzKCJkaXNwbGF5IiwgIm5vbmUiKTsKCiAgICAgICAgICAgICAgICAkKCIuIiArIHN3aXRjaGVyQ2xhc3MpLnJlbW92ZSgpOwoKICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZyYW1lID0gU2l0ZWNvcmUuUGFnZU1vZGVzLkNocm9tZU1hbmFnZXIuc2VsZWN0aW9uRnJhbWUoKTsKICAgICAgICAgICAgICAgIGNvbnRyb2xzRGl2ID0gJChmcmFtZS5jb250cm9scy5jb21tYW5kc1swXSk7CiAgICAgICAgICAgICAgICB0b29sYmFyID0gY29udHJvbHNEaXYucGFyZW50KCk7CiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWQua2V5KCkgIT0gInJlbmRlcmluZyIpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFyLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1kaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb250cm9sc0Rpdi5maW5kKCIuIiArIHN3aXRjaGVyQ2xhc3MpLmxlbmd0aCA9PSAwKSB7CS8vdHVybnMgb24gYW55IHRvb2xiYXIgd2hpY2ggaXMgbm90IHBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgICAgICAgY29udHJvbHNEaXYuYXBwZW5kKHN3aXRjaGVyQm94KTsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVuZGVyaW5nRGF0YSA9IEpTT04ucGFyc2Uoc2VsZWN0ZWQuX29wZW5pbmdNYXJrZXJbMF0uaW5uZXJIVE1MKSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkID0gU2l0ZWNvcmUuUGFnZU1vZGVzLlBhZ2VFZGl0b3IuaXRlbUlkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmluZ0lkID0gcmVuZGVyaW5nRGF0YS5jdXN0b20ucmVuZGVyaW5nSUQsCiAgICAgICAgICAgICAgICAgICAgICAgIGd1aWRQYXR0ZXJuID0gbmV3IFJlZ0V4cCgnXlswLTlhLWZBLUZdezMyfSQnLCAnaScpLAogICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21wYWdlSWQgPSByZW5kZXJpbmdEYXRhLmN1c3RvbS5wYWdlSWQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChjdXN0b21wYWdlSWQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbXBhZ2VJZCA9IGN1c3RvbXBhZ2VJZC5yZXBsYWNlKCJ7IiwgIiIpLnJlcGxhY2UoIn0iLCAiIikucmVwbGFjZSgvLS9naSwgIiIpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGN1c3RvbXBhZ2VJZCAmJiBndWlkUGF0dGVybi50ZXN0KGN1c3RvbXBhZ2VJZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkID0gY3VzdG9tcGFnZUlkOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9ICIvc3hhL3N3aXRjaGVyL2F2YWlsYWJsZS8iICsgcGFnZUlkICsgIi8iICsgcmVuZGVyaW5nSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2l0ZU5hbWUgIT09ICJ1bmRlZmluZWQiICYmIHNpdGVOYW1lICE9PSBudWxsICYmIHNpdGVOYW1lICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsICsgIj9zY19zaXRlPSIgKyBzaXRlTmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkLmdldCh1cmwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YXJpYW50cyA9ICQoIjx1bD48L3VsPiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJpbmcgPSBTaXRlY29yZS5MYXlvdXREZWZpbml0aW9uLmdldFJlbmRlcmluZyhzZWxlY3RlZC50eXBlLnVuaXF1ZUlkKCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50SXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhcmlhbnQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzVGh1bWJuYWlsRXhpc3QoZGF0YS52YXJpYW50cykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50cy5hZGRDbGFzcygiZmxleC10aHVtYiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFyaWFudCA9IHJlbmRlcmluZ1siQHBhciJdID8gcmVuZGVyaW5nWyJAcGFyIl0ubWF0Y2goLyhGaWVsZE5hbWVzPSkoey4qP318JTdCLio/JTdEKS8pIDogIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWYXJpYW50ICE9IG51bGwgJiYgY3VycmVudFZhcmlhbnQubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWYXJpYW50ID0gY3VycmVudFZhcmlhbnRbMl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmFyaWFudC5pbmRleE9mKCIlN0IiKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhcmlhbnQgPSBkZWNvZGVVUklDb21wb25lbnQoY3VycmVudFZhcmlhbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhcmlhbnQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS52YXJpYW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50SXRlbSA9IGJ1aWxkVmFyaWFudEh0bWwoZGF0YS52YXJpYW50c1tpXSwgY3VycmVudFZhcmlhbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50cy5hcHBlbmQodmFyaWFudEl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50SXRlbS5vbigiY2xpY2siLCBmdW5jdGlvbiAoYXJncykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsaWNrZWRWYXJpYW50ID0gJChhcmdzLnRhcmdldCkuZGF0YSgiaWQiKSA9PSBudWxsID8gJChhcmdzLnRhcmdldC5wYXJlbnROb2RlKSA6ICQoYXJncy50YXJnZXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnRJZCA9IGNsaWNrZWRWYXJpYW50LmRhdGEoImlkIiksLy8ucmVwbGFjZSgieyIsIiIpLnJlcGxhY2UoIn0iLCIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VJZCA9IFNpdGVjb3JlLkxheW91dERlZmluaXRpb24uZ2V0RGV2aWNlSUQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXRlY29yZUNocm9tZSA9IFNpdGVjb3JlLlBhZ2VNb2Rlcy5DaHJvbWVNYW5hZ2VyLnNlbGVjdGVkQ2hyb21lKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyaW5nVWlkID0gc2l0ZWNvcmVDaHJvbWUudHlwZS51bmlxdWVJZCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGlja2VkVmFyaWFudC5wYXJlbnRzKCIuZXhwYW5kZWQiKS5sZW5ndGggPj0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpdGVjb3JlLlBhZ2VNb2Rlcy5QYWdlRWRpdG9yLnBvc3RSZXF1ZXN0KCd3ZWJlZGl0OnN3aXRjaHZhcmlhbnQodmFyaWFudD0nICsgdmFyaWFudElkICsgJyxkZXZpY2VJZD0nICsgZGV2aWNlSWQgKyAnLHJlbmRlcmluZ1VpZD0nICsgcmVuZGVyaW5nVWlkICsgJyknLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiLiIgKyBzd2l0Y2hlckNsYXNzKS5yZW1vdmVDbGFzcygiZXhwYW5kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiLiIgKyBzd2l0Y2hlckNsYXNzKS50b2dnbGVDbGFzcygiZXhwYW5kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS52YXJpYW50cy5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoZXJCb3guZmluZCgiLnpnLXZhcmlhbnQtYXZhaWxhYmxlIikuYXBwZW5kKHZhcmlhbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlRWxlbWVudChzd2l0Y2hlckJveCwgIi56Zy12YXJpYW50LWhlYWRlciIsICdWYXJpYW50JywgZGF0YS50cmFuc2xhdGlvbnNbJ1ZhcmlhbnRTZWxlY3RvckhlYWRlclRpdGxlJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZUVsZW1lbnQoc3dpdGNoZXJCb3gsICIuemctdmFyaWFudC10aXAiLCAnU2VsZWN0IGNvbXBvbmVudCB2YXJpYW50JywgZGF0YS50cmFuc2xhdGlvbnNbJ1ZhcmlhbnRTZWxlY3RvckRyb3Bkb3duVGV4dCddKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hlckJveC5maW5kKCIuemctdmFyaWFudC10b2dnbGUtZHJvcGRvd24sLnpnLXZhcmlhbnQtdGlwIikub24oImNsaWNrIiwgZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpeFJlbmRlclZhcmlhbnRzTGlzdEhlaWdodCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiLiIgKyBzd2l0Y2hlckNsYXNzKS50b2dnbGVDbGFzcygiZXhwYW5kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoZXJCb3guc2hvdygzMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzd2l0Y2hlckggPSBzd2l0Y2hlckJveC5vdXRlckhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnRMaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnRMaXN0SGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnRzTnVtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZU9mZnNldEJvdHRvbTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3dpdGNoZXJIICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhci5hZGRDbGFzcyhzd2l0Y2hlclRvb2xiYXJDbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoZXJIICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNocm9tZSA9IFNpdGVjb3JlLlBhZ2VNb2Rlcy5DaHJvbWVNYW5hZ2VyLnNlbGVjdGVkQ2hyb21lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNocm9tZT09bnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbk1hbmFnZXIgPSBTaXRlY29yZS5QYWdlTW9kZXMuUG9zaXRpb25pbmdNYW5hZ2VyKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSB0b29sYmFyLmhlaWdodCgpICsgc3dpdGNoZXJILAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdG9vbGJhci53aWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Bvc2l0aW9uID0gcG9zaXRpb25NYW5hZ2VyLmdldEZpeGVkQ2hyb21lUmVsYXRpdmVFbGVtZW50UG9zaXRpb24oZGltLCBjaHJvbWUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXRlY29yZS5QYWdlTW9kZXMuQ2hyb21lTWFuYWdlci5zZWxlY3Rpb25GcmFtZSgpLmNvbnRyb2xzLmRpbWVuc2lvbnMgPSBkaW07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhci5hbmltYXRlKG5ld1Bvc2l0aW9uLCAiZmFzdCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnRMaXN0ID0gdG9vbGJhci5maW5kKCcuemctdmFyaWFudC1saXN0IGxpJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFudExpc3RIZWlnaHQgPSB2YXJpYW50TGlzdC5lcSgwKS5oZWlnaHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50c051bSA9IHZhcmlhbnRMaXN0Lmxlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lT2Zmc2V0Qm90dG9tID0gcG9zaXRpb25NYW5hZ2VyLnZpZXdwb3J0UmVnaW9uLmJvdHRvbSAtIChuZXdQb3NpdGlvbi50b3AgKyBkaW0uaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCh2YXJpYW50c051bSAqIHZhcmlhbnRMaXN0SGVpZ2h0KSArICh2YXJpYW50TGlzdEhlaWdodCAvIDIpKSA+IGNocm9tZU9mZnNldEJvdHRvbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFyLmZpbmQoJy56Zy12YXJpYW50LWxpc3QgLnpnLXZhcmlhbnQtYXZhaWxhYmxlPnVsJykuY3NzKHsgJ292ZXJmbG93LXknOiAnYXV0bycsICdtYXgtaGVpZ2h0JzogTWF0aC5mbG9vcigoY2hyb21lT2Zmc2V0Qm90dG9tIC8gdmFyaWFudExpc3RIZWlnaHQpIC0gMSkgKiB2YXJpYW50TGlzdEhlaWdodCArICdweCcgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIi4iICsgc3dpdGNoZXJUb29sYmFyQ2xhc3MpLnJlbW92ZUNsYXNzKHN3aXRjaGVyVG9vbGJhckNsYXNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZhaWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiW1ZhcmlhbnQgU3dpdGNoZXJdIEZhaWxlZCB0byBnZXQgYXZhaWxhYmxlIHZhcmlhbnRzIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy9maXggZm9yIGV4cG9ydGluZyBzaXRlIGluIEF1dGhvciBNb2RlCiAgICAgICAgICAgIGlmICghWEEuaGFzUGFnZU1vZGVzKCkpIHJldHVybjsKCgogICAgICAgICAgICAvL2JpbmRzIHRvIHNlbGVjdGlvbiBjaGFuZ2UgZXZlbnQsIGJ1dCBpdCdzIG5vdCBmaXJlZCB3aGVuIHlvdSBjbGljayAiZXhwYW5kIHNlbGVjdGlvbiIKICAgICAgICAgICAgb25TZWxlY3Rpb25VcGRhdGUudmFyaWFudFN3aXRjaGVyID0gdHJ1ZTsKICAgICAgICAgICAgU2l0ZWNvcmUuUGFnZU1vZGVzLkNocm9tZU1hbmFnZXIuc2VsZWN0aW9uQ2hhbmdlZC5fY2FsbGJhY2tzLnB1c2gob25TZWxlY3Rpb25VcGRhdGUpOwogICAgICAgICAgICAvL2FuZCBzbyBoZXJlJ3MgdGhlIGZpeDoKICAgICAgICAgICAgdmFyIF9vbGRFeHBhbmQgPSBTaXRlY29yZS5QYWdlTW9kZXMuQ2hyb21lQ29udHJvbHMucHJvdG90eXBlLnJlbmRlckV4cGFuZENvbW1hbmQ7CiAgICAgICAgICAgIG9kbEV4cGFuZCA9IF9vbGRFeHBhbmQ7CiAgICAgICAgICAgIGV4cGFuZCA9IGZ1bmN0aW9uICgpIHsJLy9pdCB3cmFwcyBTaXRlY29yZSdzIG1ldGhvZAogICAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOwogICAgICAgICAgICAgICAgb25TZWxlY3Rpb25VcGRhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybiBfb2xkRXhwYW5kLmNhbGwoY29udGV4dCk7IC8vIGFtIEkgZXZpbCAyIDpEPwogICAgICAgICAgICB9OwogICAgICAgICAgICBTaXRlY29yZS5QYWdlTW9kZXMuQ2hyb21lQ29udHJvbHMucHJvdG90eXBlLnJlbmRlckV4cGFuZENvbW1hbmQgPSBleHBhbmQ7CiAgICAgICAgfTsKCiAgICAgICAgcHViLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhcmlhbnRTd2l0Y2hlclBsdWdJbigpOwogICAgICAgIH07CgogICAgICAgIHB1Yi5yZW1vdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vU2l0ZWNvcmUuUGFnZU1vZGVzLkNocm9tZUNvbnRyb2xzLnByb3RvdHlwZS5yZW5kZXJFeHBhbmRDb21tYW5kID0gb2xkRXhwYW5kOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrc1tpXS5oYXNPd25Qcm9wZXJ0eSgidmFyaWFudFN3aXRjaGVyIikpIHsKICAgICAgICAgICAgICAgICAgICBTaXRlY29yZS5QYWdlTW9kZXMuQ2hyb21lTWFuYWdlci5zZWxlY3Rpb25DaGFuZ2VkLl9jYWxsYmFja3Muc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIHB1YjsKICAgIH0oJHhhKSk7CiAgICAkeGEudmFyaWFudHN3aXRjaGVyLmluaXQoKTsKfQo=
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 13184
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160509T092538Z
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "b75f2019-2520-40ed-9eac-7777a313cb61"
