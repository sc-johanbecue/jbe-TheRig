---
ID: "8f86f2e4-2faa-43b0-8bfb-418379caad5a"
Parent: "7a1ae0f3-a283-4e4d-b81a-8fc78dc00c3e"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Base Themes/Google Maps JS Connector/Scripts/google-maps-connector"
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/8F86F2E42FAA43B08BFB418379CAAD5A.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "8f86f2e4-2faa-43b0-8bfb-418379caad5a"
  Value: WEEuY29ubmVjdG9yLm1hcHNDb25uZWN0b3IgPSAoZnVuY3Rpb24gKCQsIGRvY3VtZW50KSB7DQoNCiAgICAidXNlIHN0cmljdCI7DQoNCiAgICB2YXIgYXBpID0ge30sDQogICAgICAgIG1hcHMgPSBbXSwNCiAgICAgICAgbWFya2VycyA9IFtdLA0KICAgICAgICBtYXAsDQogICAgICAgIGdldE1hcFR5cGUsDQogICAgICAgIGNyZWF0ZU1hcmtlciwNCiAgICAgICAgaW5mb1dpbmRvd3MgPSBbXSwNCiAgICAgICAgYWRkTWFya2VyLA0KICAgICAgICBjYWxsYmFja3MgPSBbXSwNCiAgICAgICAgYW5pbWF0aW9uVGltZW91dCwNCiAgICAgICAgbG9hZGluZyA9IGZhbHNlOw0KDQogICAgZ2V0TWFwVHlwZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7DQogICAgICAgIHN3aXRjaCAob3B0aW9ucy5tb2RlKSB7DQogICAgICAgICAgICBjYXNlICdSb2FkbWFwJzogew0KICAgICAgICAgICAgICAgIHJldHVybiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgJ1NhdGVsbGl0ZSc6IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZ29vZ2xlLm1hcHMuTWFwVHlwZUlkLlNBVEVMTElURTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgJ0h5YnJpZCc6ew0KICAgICAgICAgICAgICAgIHJldHVybiBnb29nbGUubWFwcy5NYXBUeXBlSWQuSFlCUklEOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICAgIHJldHVybiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICBjcmVhdGVNYXJrZXIgPSBmdW5jdGlvbihtYXBJZCwgZGF0YSkgew0KICAgICAgICB2YXIgbWFya2VyOw0KICAgICAgICBpZiAoZGF0YS5pY29uID09PSBudWxsKSB7DQogICAgICAgICAgICBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHsNCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhkYXRhLmxhdGl0dWRlLCBkYXRhLmxvbmdpdHVkZSksDQogICAgICAgICAgICAgICAgbWFwOiBtYXBzW21hcElkXSwNCiAgICAgICAgICAgICAgICB0aXRsZTogZGF0YS50aXRsZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHsNCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhkYXRhLmxhdGl0dWRlLCBkYXRhLmxvbmdpdHVkZSksDQogICAgICAgICAgICAgICAgbWFwOiBtYXBzW21hcElkXSwNCiAgICAgICAgICAgICAgICB0aXRsZTogZGF0YS50aXRsZSwNCiAgICAgICAgICAgICAgICBpY29uOiBkYXRhLmljb24NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGlmIChkYXRhLmxhdGl0dWRlID09PSAnJyAmJiBkYXRhLmxvbmdpdHVkZSA9PT0gJycpIHsNCiAgICAgICAgICAgIC8vaWYgbWFya2VyIGRvZXNuJ3QgaGF2ZSBjb29yZGluYXRlZCB0aGVuIGNyZWF0ZSBpdCBidXQgZG9lc24ndCBzaG93IGl0IG9uIHRoZSBtYXANCiAgICAgICAgICAgIG1hcmtlci5zZXRWaXNpYmxlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbWFya2VyOw0KICAgIH07DQoNCiAgICBhZGRNYXJrZXIgPSBmdW5jdGlvbihtYXBJZCwgbWFya2VyLCBkYXRhKSB7DQogICAgICAgIC8vc2F2ZSBQT0kgaWQgLSB0aGlzIHdpbGwgYmUgdXNlZCB3aGlsZSByZW1vdmluZyBkeW5hbWljIFBPSXMgZnJvbSB0aGUgbWFwDQogICAgICAgIG1hcmtlci5pZCA9IGRhdGEuaWQ7DQoNCiAgICAgICAgaWYgKG1hcmtlcnNbbWFwSWRdKSB7DQogICAgICAgICAgICBtYXJrZXJzW21hcElkXS5wdXNoKHsgbWFya2VyOiBtYXJrZXIsIHR5cGU6IGRhdGEudHlwZX0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbWFya2Vyc1ttYXBJZF0gPSBbXTsNCiAgICAgICAgICAgIG1hcmtlcnNbbWFwSWRdLnB1c2goeyBtYXJrZXI6IG1hcmtlciwgdHlwZTogZGF0YS50eXBlfSk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgYXBpLmxvYWRTY3JpcHQgPSBmdW5jdGlvbihrZXksIGNhbGxiYWNrKSB7DQogICAgICAgIC8vc2F2ZSBlYWNoIGNhbGxiYWNrIGFuZCBjYWxsIHRoZW0gYWxsIHdoZW4gc2NyaXB0IHdpbGwgYmUgbG9hZGVkIC0gcHJvdGVjdGlvbiBmb3IgbG9hZGluZyBtYXBzIHR3aWNlDQogICAgICAgIGNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTsNCg0KICAgICAgICBpZiAoIWxvYWRpbmcpIHsNCiAgICAgICAgICAgIGxvYWRpbmcgPSB0cnVlOw0KICAgICAgICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpLA0KICAgICAgICAgICAgICAgIHNyYyA9ICJodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/dj0zLmV4cCI7DQogICAgICAgICAgICBzY3JpcHQudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOw0KICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXkgIT09ICJ1bmRlZmluZWQiICYmIGtleSAhPT0gIiIpIHsNCiAgICAgICAgICAgICAgICBzcmMgKz0gIiZrZXk9IiArIGtleSArICImdj0zLmV4cCZzaWduZWRfaW49ZmFsc2UiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzcmMgKz0gIiZzaWduZWRfaW49ZmFsc2UiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3JjICs9ICImbGlicmFyaWVzPXBsYWNlcyZjYWxsYmFjaz1YQS5jb25uZWN0b3IubWFwc0Nvbm5lY3Rvci5zY3JpcHRzTG9hZGVkIjsNCiAgICAgICAgICAgIHNjcmlwdC5zcmMgPSBzcmM7DQogICAgICAgICAgICBzY3JpcHQub25sb2FkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJHb29nbGUgbG9hZGVyIGhhcyBiZWVuIGxvYWRlZCwgd2FpdGluZyBmb3IgbWFwcyBhcGkiKTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgYXBpLnNjcmlwdHNMb2FkZWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBpLCBsZW5ndGggPSBjYWxsYmFja3MubGVuZ3RoOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGNhbGxiYWNrc1tpXS5jYWxsKCk7DQogICAgICAgIH0NCiAgICAgICAgbG9hZGluZyA9IGZhbHNlOw0KICAgIH07DQoNCiAgICBhcGkuc2hvd01hcCA9IGZ1bmN0aW9uKG1hcElkLCBvcHRpb25zLCB2aWV3Qm91bmRzKSB7DQogICAgICAgIHZhciBtYXBPcHRpb25zLA0KICAgICAgICAgICAgbGlzdGVuZXIsDQogICAgICAgICAgICBpZGxlTGlzdGVuZXIsDQogICAgICAgICAgICBzY3JvbGx3aGVlbCA9IG9wdGlvbnMuZGlzYWJsZU1hcFpvb21PblNjcm9sbCAhPT0gIjEiLA0KICAgICAgICAgICAgbWFwRHJhZ2dpbmcgPSBvcHRpb25zLmRpc2FibGVNYXBTY3JvbGxpbmcgIT09ICIxIjsNCg0KICAgICAgICBpZiAodmlld0JvdW5kcyBpbnN0YW5jZW9mIEFycmF5KSB7DQogICAgICAgICAgICAgICAgbWFwT3B0aW9ucyA9IHsNCiAgICAgICAgICAgICAgICAgICAgem9vbTogb3B0aW9ucy56b29tLA0KICAgICAgICAgICAgICAgICAgICBzY3JvbGx3aGVlbDogc2Nyb2xsd2hlZWwsDQogICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogbWFwRHJhZ2dpbmcsDQogICAgICAgICAgICAgICAgICAgIGNlbnRlcjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2aWV3Qm91bmRzWzBdLCB2aWV3Qm91bmRzWzFdKSwNCiAgICAgICAgICAgICAgICAgICAgbWFwVHlwZUlkOiBnZXRNYXBUeXBlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9wdGlvbnMuY2FudmFzSWQpLCBtYXBPcHRpb25zKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBtYXBPcHRpb25zID0gew0KICAgICAgICAgICAgICAgICAgICBzY3JvbGx3aGVlbDogc2Nyb2xsd2hlZWwsDQogICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogbWFwRHJhZ2dpbmcsDQogICAgICAgICAgICAgICAgICAgIG1hcFR5cGVJZDogZ2V0TWFwVHlwZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLmNhbnZhc0lkKSwgbWFwT3B0aW9ucyk7DQogICAgICAgICAgICAgICAgbWFwLmZpdEJvdW5kcyh2aWV3Qm91bmRzKTsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5wb2lDb3VudCA8IDIpIHsNCiAgICAgICAgICAgICAgICAgICAgaWRsZUxpc3RlbmVyID0gZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAiaWRsZSIsIGZ1bmN0aW9uKCkgeyANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhtYXJrZXJzKS5sZW5ndGggPiAwICYmIG1hcmtlcnNbbWFwSWRdLmxlbmd0aCA8IDIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAuc2V0Wm9vbShvcHRpb25zLnpvb20pOyANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihpZGxlTGlzdGVuZXIpOyANCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbGlzdGVuZXIgPSBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICJ6b29tX2NoYW5nZWQiLCBmdW5jdGlvbihhLCBiLCBjLCBkKSB7IA0KICAgICAgICAgICAgdmFyIHpvb20gPSBtYXAuZ2V0Wm9vbSgpOw0KICAgICAgICAgICAgaWYgKHpvb20gPCAxKSB7DQogICAgICAgICAgICAgICAgbWFwLnNldFpvb20oMSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIG1hcHNbbWFwSWRdID0gbWFwOw0KICAgIH07DQoNCiAgICBhcGkucmVuZGVyUG9pID0gZnVuY3Rpb24obWFwSWQsIGRhdGEpIHsNCiAgICAgICAgdmFyIG1hcmtlciA9IGNyZWF0ZU1hcmtlcihtYXBJZCwgZGF0YSksDQogICAgICAgICAgICBrZXkgPSBtYXBJZCArICIjIiArIGRhdGEuaWQ7DQoNCiAgICAgICAgYWRkTWFya2VyKG1hcElkLCBtYXJrZXIsIGRhdGEpOw0KDQogICAgICAgIGlmIChkYXRhLmh0bWwgIT09ICIiICYmIGRhdGEuaHRtbCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgaW5mb1dpbmRvd3Nba2V5XSA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHsNCiAgICAgICAgICAgICAgICBjb250ZW50OiBkYXRhLmh0bWwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHR5cGVvZiBpbmZvV2luZG93c1trZXldICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgICAgICAgKGZ1bmN0aW9uKGN1cnJlbnRLZXksIG1hcmtlcikgew0KICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgImNsaWNrIiwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBpbmZvV2luZG93cykgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm9XaW5kb3dzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93c1trZXldLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaW5mb1dpbmRvd3NbY3VycmVudEtleV0ub3BlbihtYXBzW21hcElkXSwgbWFya2VyKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pKGtleSwgbWFya2VyKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICBhcGkucmVuZGVyRHluYW1pY1BvaSA9IGZ1bmN0aW9uKG1hcElkLCBkYXRhLCBnZXRQb2lDb250ZW50KSB7DQogICAgICAgIHZhciBtYXJrZXIgPSBjcmVhdGVNYXJrZXIobWFwSWQsIGRhdGEpOyAgICAgICAgICAgIA0KDQogICAgICAgIGFkZE1hcmtlcihtYXBJZCwgbWFya2VyLCBkYXRhKTsNCg0KICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICJjbGljayIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgKGdldFBvaUNvbnRlbnQpID09PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgICAgdmFyIHBvaUlkID0gZGF0YS5pZCwNCiAgICAgICAgICAgICAgICAgICAgcG9pVHlwZUlkID0gZGF0YS5wb2lUeXBlSWQsDQogICAgICAgICAgICAgICAgICAgIHBvaVZhcmlhbnRJZCA9IGRhdGEucG9pVmFyaWFudElkOw0KDQogICAgICAgICAgICAgICAgaWYgKHBvaVZhcmlhbnRJZCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBnZXRQb2lDb250ZW50KHBvaUlkLCBwb2lUeXBlSWQsIHBvaVZhcmlhbnRJZCwgZnVuY3Rpb24gKHJlc3VsdCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5mb1dpbmRvd3NbbWFwSWRdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93c1ttYXBJZF0uY2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93c1ttYXBJZF0gPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXN1bHQuSHRtbA0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgaW5mb1dpbmRvd3NbbWFwSWRdLm9wZW4obWFwc1ttYXBJZF0sIG1hcmtlcik7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH07DQoNCiAgICBhcGkuY2xlYXJNYXJrZXJzID0gZnVuY3Rpb24obWFwSWQpIHsNCiAgICAgICAgdmFyIG1hcE1hcmtlcnM7DQogICAgICAgIGlmIChtYXJrZXJzLmhhc093blByb3BlcnR5KG1hcElkKSkgew0KICAgICAgICAgICAgbWFwTWFya2VycyA9IG1hcmtlcnNbbWFwSWRdOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXBNYXJrZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKG1hcE1hcmtlcnNbaV0udHlwZSA9PT0gIkR5bmFtaWMiKSB7DQogICAgICAgICAgICAgICAgICAgIG1hcE1hcmtlcnNbaV0ubWFya2VyLnNldE1hcChudWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBtYXJrZXJzW21hcElkXSA9IG1hcE1hcmtlcnMuZmlsdGVyKGZ1bmN0aW9uIChtYXJrZXJEYXRhKSB7DQogICAgICAgICAgICAgICAgaWYgKG1hcmtlckRhdGEudHlwZSA9PT0gIlN0YXRpYyIgfHwgbWFya2VyRGF0YS50eXBlID09PSAiTXlMb2NhdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIGFwaS51cGRhdGVNYXBQb3NpdGlvbiA9IGZ1bmN0aW9uIChtYXBJZCkgew0KICAgICAgICB2YXIgbWFwID0gbWFwc1ttYXBJZF0sDQogICAgICAgICAgICBtYXJrZXIsDQogICAgICAgICAgICBtYXBNYXJrZXJzID0gW10sDQogICAgICAgICAgICBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCksDQogICAgICAgICAgICBpOw0KDQogICAgICAgIGlmIChtYXJrZXJzLmhhc093blByb3BlcnR5KG1hcElkKSkgew0KICAgICAgICAgICAgbWFwTWFya2VycyA9IG1hcmtlcnNbbWFwSWRdOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yIChpID0wOyBpIDwgbWFwTWFya2Vycy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgbWFya2VyID0gbWFwTWFya2Vyc1tpXS5tYXJrZXI7DQogICAgICAgICAgICBib3VuZHMuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcobWFya2VyLnBvc2l0aW9uLmxhdCgpLCBtYXJrZXIucG9zaXRpb24ubG5nKCkpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIG1hcC5maXRCb3VuZHMoYm91bmRzKTsNCiAgICB9Ow0KDQogICAgYXBpLmNlbnRlck1hcCA9IGZ1bmN0aW9uKG1hcElkLCBkYXRhLCBjZW50ZXJNYXAsIGFuaW1hdGUpIHsNCiAgICAgICAgdmFyIG1hcCA9IG1hcHNbbWFwSWRdLA0KICAgICAgICAgICAgbWFwTWFya2VycyA9IFtdLA0KICAgICAgICAgICAgYW5pbWF0ZWRNYXJrZXI7DQoNCiAgICAgICAgaWYgKGNlbnRlck1hcCkgew0KICAgICAgICAgICAgbWFwLnNldENlbnRlcihuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGRhdGEuY29vcmRpbmF0ZXNbMF0sIGRhdGEuY29vcmRpbmF0ZXNbMV0pKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhbmltYXRlKSB7DQogICAgICAgICAgICBpZiAobWFya2Vycy5oYXNPd25Qcm9wZXJ0eShtYXBJZCkpIHsNCiAgICAgICAgICAgICAgICBtYXBNYXJrZXJzID0gbWFya2Vyc1ttYXBJZF07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcE1hcmtlcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBtYXBNYXJrZXJzW2ldLm1hcmtlci5zZXRBbmltYXRpb24obnVsbCk7DQogICAgICAgICAgICAgICAgaWYgKG1hcE1hcmtlcnNbaV0ubWFya2VyLmlkID09PSBkYXRhLmlkKSB7DQogICAgICAgICAgICAgICAgICAgIGFuaW1hdGVkTWFya2VyID0gbWFwTWFya2Vyc1tpXS5tYXJrZXI7DQogICAgICAgICAgICAgICAgICAgIG1hcE1hcmtlcnNbaV0ubWFya2VyLnNldE1hcChudWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIGFuaW1hdGVkTWFya2VyICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgICAgICAgICAgIGFuaW1hdGVkTWFya2VyLnNldE1hcChtYXApOw0KICAgICAgICAgICAgICAgIGFuaW1hdGVkTWFya2VyLnNldEFuaW1hdGlvbihnb29nbGUubWFwcy5BbmltYXRpb24uQk9VTkNFKTsNCiAgICAgICAgICAgICAgICBhbmltYXRpb25UaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIGFuaW1hdGVkTWFya2VyLnNldE1hcChtYXApOw0KICAgICAgICAgICAgICAgIH0sIDIwMDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIGFwaS5nZXRDZW50cmFsUG9pbnQgPSBmdW5jdGlvbihwb2lzQ29vcmRzKSB7DQogICAgICAgIHZhciBpLA0KICAgICAgICAgICAgcG9pQ29vcmRzLA0KICAgICAgICAgICAgY291bnQgPSBwb2lzQ29vcmRzLmxlbmd0aCwNCiAgICAgICAgICAgIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTsNCg0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgICAgICAgcG9pQ29vcmRzID0gcG9pc0Nvb3Jkc1tpXTsNCiAgICAgICAgICAgIGlmIChwb2lDb29yZHMubGF0aXR1ZGUgIT09ICIiICYmIHBvaUNvb3Jkcy5sb25naXR1ZGUgIT09ICIiKSB7DQogICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHBvaUNvb3Jkcy5sYXRpdHVkZSwgcG9pQ29vcmRzLmxvbmdpdHVkZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBib3VuZHM7DQogICAgfTsNCg0KICAgIGFwaS5sb2NhdGlvbkF1dG9jb21wbGV0ZSA9IGZ1bmN0aW9uKHF1ZXJ5UGFyYW1zLCBzdWNjZXNzQ2FsbGJhY2ssIGZhaWxDYWxsYmFjayl7DQogICAgICAgIHZhciBhdXRvY29tcGxldGUgPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLkF1dG9jb21wbGV0ZVNlcnZpY2UoKSwNCiAgICAgICAgICAgIG1heFJlc3VsdHMgPSBxdWVyeVBhcmFtcy5tYXhSZXN1bHRzIDw9IDAgPyAxIDogcXVlcnlQYXJhbXMubWF4UmVzdWx0czsNCiAgICAgICAgICAgIGF1dG9jb21wbGV0ZS5nZXRRdWVyeVByZWRpY3Rpb25zKHtpbnB1dCA6IHF1ZXJ5UGFyYW1zLnRleHR9LCBmdW5jdGlvbihyZXN1bHRzKXsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHByZWRpY3Rpb25zID0gW10sIGxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0cyAhPSBudWxsICYmIHJlc3VsdHMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSByZXN1bHRzLmxlbmd0aCA+PSBtYXhSZXN1bHRzID8gbWF4UmVzdWx0cyA6IHJlc3VsdHMubGVuZ3RoOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZGljdGlvbnMucHVzaChfLmV4dGVuZChyZXN1bHRzW2ldLCB7dGV4dCA6IHJlc3VsdHNbaV0uZGVzY3JpcHRpb259KSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhwcmVkaWN0aW9ucyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmYWlsQ2FsbGJhY2soKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgfTsNCg0KICAgIGFwaS5hZGRyZXNzTG9va3VwID0gZnVuY3Rpb24gKHF1ZXJ5UGFyYW1zLCBzdWNjZXNzQ2FsbGJhY2ssIGZhaWxDYWxsYmFjaykgew0KICAgICAgICB2YXIgc2VhcmNoLA0KICAgICAgICAgICAgcXVlcnk7DQoNCiAgICAgICAgaWYocXVlcnlQYXJhbXMuaGFzT3duUHJvcGVydHkoInBsYWNlX2lkIikpeyAvL3BsYWNlcyBsb29rdXANCiAgICAgICAgICAgIHNlYXJjaCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuUGxhY2VzU2VydmljZSh0eXBlb2YgbWFwICE9PSAidW5kZWZpbmVkIiA/IG1hcCA6IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpKTsNCiAgICAgICAgICAgIHNlYXJjaC5nZXREZXRhaWxzKHsNCiAgICAgICAgICAgICAgICBwbGFjZUlkIDogcXVlcnlQYXJhbXNbInBsYWNlX2lkIl0NCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3VsdHMsc3RhdHVzKXsNCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09IGdvb2dsZS5tYXBzLnBsYWNlcy5QbGFjZXNTZXJ2aWNlU3RhdHVzLk9LKSB7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXN1bHRzKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHJlc3VsdHMuZ2VvbWV0cnkubG9jYXRpb24pICE9PSAidW5kZWZpbmVkIil7DQogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soW3Jlc3VsdHMuZ2VvbWV0cnkubG9jYXRpb24ubGF0KCkscmVzdWx0cy5nZW9tZXRyeS5sb2NhdGlvbi5sbmcoKV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGZhaWxDYWxsYmFjaygpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7IC8vc3RhbmRhcmQgbG9va3VwDQogICAgICAgICAgICBxdWVyeSA9IHsNCiAgICAgICAgICAgICAgICBhZGRyZXNzIDogcXVlcnlQYXJhbXMudGV4dA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHNlYXJjaCA9IG5ldyBnb29nbGUubWFwcy5HZW9jb2RlcigpOw0KICAgICAgICAgICAgc2VhcmNoLmdlb2NvZGUocXVlcnksIGZ1bmN0aW9uKHJlc3VsdHMsc3RhdHVzKXsNCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9LKSB7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXN1bHRzWzBdKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHJlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb24pICE9PSAidW5kZWZpbmVkIil7DQogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soW3Jlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb24ubGF0KCkscmVzdWx0c1swXS5nZW9tZXRyeS5sb2NhdGlvbi5sbmcoKV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGZhaWxDYWxsYmFjaygpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgYXBpLnVwZGF0ZU15UG9pTG9jYXRpb24gPSBmdW5jdGlvbihtYXBJZCwgY29vcmRpbmF0ZXMsIHpvb20pIHsNCiAgICAgICAgdmFyIG1hcCA9IG1hcHNbbWFwSWRdLA0KICAgICAgICAgICAgbWFwTWFya2VycyA9IFtdLA0KICAgICAgICAgICAgbXlMb2NhdGlvbk1hcmtlcjsNCg0KICAgICAgICBpZiAobWFya2Vycy5oYXNPd25Qcm9wZXJ0eShtYXBJZCkpIHsNCiAgICAgICAgICAgIG1hcE1hcmtlcnMgPSBtYXJrZXJzW21hcElkXTsNCiAgICAgICAgICAgIG15TG9jYXRpb25NYXJrZXIgPSBtYXBNYXJrZXJzLmZpbHRlcihmdW5jdGlvbiAobWFya2VyKSB7DQogICAgICAgICAgICAgICAgaWYgKG1hcmtlci50eXBlID09PSAiTXlMb2NhdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaWYgKG15TG9jYXRpb25NYXJrZXIubGVuZ3RoID4gMCkgeyAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBteUxvY2F0aW9uTWFya2VyWzBdLm1hcmtlci5zZXRQb3NpdGlvbihuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGNvb3JkaW5hdGVzWzBdLCBjb29yZGluYXRlc1sxXSkpOw0KICAgICAgICAgICAgICAgIG15TG9jYXRpb25NYXJrZXJbMF0ubWFya2VyLnNldFZpc2libGUodHJ1ZSk7ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTWFwUG9zaXRpb24obWFwSWQpOw0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygem9vbSAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICAgICAgbWFwLnNldFpvb20oem9vbSk7IA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICByZXR1cm4gYXBpOw0KDQp9KShqUXVlcnksIGRvY3VtZW50KTsNCg==
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 13258
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160517T105538Z
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "61c68268-77b3-48df-80a3-430c5f5f162b"
